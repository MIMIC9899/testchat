/*! For license information please see main.js.LICENSE.txt */
(()=>{var e={543:function(e,t,n){var r;e=n.nmd(e),function(){var i,s="Expected a function",o="__lodash_hash_undefined__",a="__lodash_placeholder__",c=32,u=128,l=1/0,h=9007199254740991,d=NaN,f=4294967295,p=[["ary",u],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",c],["partialRight",64],["rearg",256]],g="[object Arguments]",m="[object Array]",y="[object Boolean]",_="[object Date]",v="[object Error]",w="[object Function]",b="[object GeneratorFunction]",I="[object Map]",E="[object Number]",T="[object Object]",C="[object Promise]",k="[object RegExp]",S="[object Set]",x="[object String]",A="[object Symbol]",N="[object WeakMap]",R="[object ArrayBuffer]",P="[object DataView]",D="[object Float32Array]",O="[object Float64Array]",L="[object Int8Array]",M="[object Int16Array]",F="[object Int32Array]",U="[object Uint8Array]",V="[object Uint8ClampedArray]",j="[object Uint16Array]",q="[object Uint32Array]",$=/\b__p \+= '';/g,B=/\b(__p \+=) '' \+/g,z=/(__e\(.*?\)|\b__t\)) \+\n'';/g,W=/&(?:amp|lt|gt|quot|#39);/g,H=/[&<>"']/g,K=RegExp(W.source),G=RegExp(H.source),Q=/<%-([\s\S]+?)%>/g,Y=/<%([\s\S]+?)%>/g,X=/<%=([\s\S]+?)%>/g,J=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Z=/^\w*$/,ee=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,te=/[\\^$.*+?()[\]{}|]/g,ne=RegExp(te.source),re=/^\s+/,ie=/\s/,se=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,oe=/\{\n\/\* \[wrapped with (.+)\] \*/,ae=/,? & /,ce=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ue=/[()=,{}\[\]\/\s]/,le=/\\(\\)?/g,he=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,de=/\w*$/,fe=/^[-+]0x[0-9a-f]+$/i,pe=/^0b[01]+$/i,ge=/^\[object .+?Constructor\]$/,me=/^0o[0-7]+$/i,ye=/^(?:0|[1-9]\d*)$/,_e=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ve=/($^)/,we=/['\n\r\u2028\u2029\\]/g,be="\\ud800-\\udfff",Ie="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Ee="\\u2700-\\u27bf",Te="a-z\\xdf-\\xf6\\xf8-\\xff",Ce="A-Z\\xc0-\\xd6\\xd8-\\xde",ke="\\ufe0e\\ufe0f",Se="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",xe="["+be+"]",Ae="["+Se+"]",Ne="["+Ie+"]",Re="\\d+",Pe="["+Ee+"]",De="["+Te+"]",Oe="[^"+be+Se+Re+Ee+Te+Ce+"]",Le="\\ud83c[\\udffb-\\udfff]",Me="[^"+be+"]",Fe="(?:\\ud83c[\\udde6-\\uddff]){2}",Ue="[\\ud800-\\udbff][\\udc00-\\udfff]",Ve="["+Ce+"]",je="\\u200d",qe="(?:"+De+"|"+Oe+")",$e="(?:"+Ve+"|"+Oe+")",Be="(?:['’](?:d|ll|m|re|s|t|ve))?",ze="(?:['’](?:D|LL|M|RE|S|T|VE))?",We="(?:"+Ne+"|"+Le+")?",He="["+ke+"]?",Ke=He+We+"(?:"+je+"(?:"+[Me,Fe,Ue].join("|")+")"+He+We+")*",Ge="(?:"+[Pe,Fe,Ue].join("|")+")"+Ke,Qe="(?:"+[Me+Ne+"?",Ne,Fe,Ue,xe].join("|")+")",Ye=RegExp("['’]","g"),Xe=RegExp(Ne,"g"),Je=RegExp(Le+"(?="+Le+")|"+Qe+Ke,"g"),Ze=RegExp([Ve+"?"+De+"+"+Be+"(?="+[Ae,Ve,"$"].join("|")+")",$e+"+"+ze+"(?="+[Ae,Ve+qe,"$"].join("|")+")",Ve+"?"+qe+"+"+Be,Ve+"+"+ze,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Re,Ge].join("|"),"g"),et=RegExp("["+je+be+Ie+ke+"]"),tt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,nt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],rt=-1,it={};it[D]=it[O]=it[L]=it[M]=it[F]=it[U]=it[V]=it[j]=it[q]=!0,it[g]=it[m]=it[R]=it[y]=it[P]=it[_]=it[v]=it[w]=it[I]=it[E]=it[T]=it[k]=it[S]=it[x]=it[N]=!1;var st={};st[g]=st[m]=st[R]=st[P]=st[y]=st[_]=st[D]=st[O]=st[L]=st[M]=st[F]=st[I]=st[E]=st[T]=st[k]=st[S]=st[x]=st[A]=st[U]=st[V]=st[j]=st[q]=!0,st[v]=st[w]=st[N]=!1;var ot={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},at=parseFloat,ct=parseInt,ut="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,lt="object"==typeof self&&self&&self.Object===Object&&self,ht=ut||lt||Function("return this")(),dt=t&&!t.nodeType&&t,ft=dt&&e&&!e.nodeType&&e,pt=ft&&ft.exports===dt,gt=pt&&ut.process,mt=function(){try{return ft&&ft.require&&ft.require("util").types||gt&&gt.binding&&gt.binding("util")}catch(e){}}(),yt=mt&&mt.isArrayBuffer,_t=mt&&mt.isDate,vt=mt&&mt.isMap,wt=mt&&mt.isRegExp,bt=mt&&mt.isSet,It=mt&&mt.isTypedArray;function Et(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Tt(e,t,n,r){for(var i=-1,s=null==e?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function Ct(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function kt(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function St(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function xt(e,t){for(var n=-1,r=null==e?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function At(e,t){return!(null==e||!e.length)&&Vt(e,t,0)>-1}function Nt(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}function Rt(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function Pt(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function Dt(e,t,n,r){var i=-1,s=null==e?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function Ot(e,t,n,r){var i=null==e?0:e.length;for(r&&i&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}function Lt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var Mt=Bt("length");function Ft(e,t,n){var r;return n(e,function(e,n,i){if(t(e,n,i))return r=n,!1}),r}function Ut(e,t,n,r){for(var i=e.length,s=n+(r?1:-1);r?s--:++s<i;)if(t(e[s],s,e))return s;return-1}function Vt(e,t,n){return t==t?function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}(e,t,n):Ut(e,qt,n)}function jt(e,t,n,r){for(var i=n-1,s=e.length;++i<s;)if(r(e[i],t))return i;return-1}function qt(e){return e!=e}function $t(e,t){var n=null==e?0:e.length;return n?Ht(e,t)/n:d}function Bt(e){return function(t){return null==t?i:t[e]}}function zt(e){return function(t){return null==e?i:e[t]}}function Wt(e,t,n,r,i){return i(e,function(e,i,s){n=r?(r=!1,e):t(n,e,i,s)}),n}function Ht(e,t){for(var n,r=-1,s=e.length;++r<s;){var o=t(e[r]);o!==i&&(n=n===i?o:n+o)}return n}function Kt(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function Gt(e){return e?e.slice(0,dn(e)+1).replace(re,""):e}function Qt(e){return function(t){return e(t)}}function Yt(e,t){return Rt(t,function(t){return e[t]})}function Xt(e,t){return e.has(t)}function Jt(e,t){for(var n=-1,r=e.length;++n<r&&Vt(t,e[n],0)>-1;);return n}function Zt(e,t){for(var n=e.length;n--&&Vt(t,e[n],0)>-1;);return n}var en=zt({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),tn=zt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function nn(e){return"\\"+ot[e]}function rn(e){return et.test(e)}function sn(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function on(e,t){return function(n){return e(t(n))}}function an(e,t){for(var n=-1,r=e.length,i=0,s=[];++n<r;){var o=e[n];o!==t&&o!==a||(e[n]=a,s[i++]=n)}return s}function cn(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}function un(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=[e,e]}),n}function ln(e){return rn(e)?function(e){for(var t=Je.lastIndex=0;Je.test(e);)++t;return t}(e):Mt(e)}function hn(e){return rn(e)?function(e){return e.match(Je)||[]}(e):function(e){return e.split("")}(e)}function dn(e){for(var t=e.length;t--&&ie.test(e.charAt(t)););return t}var fn=zt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),pn=function e(t){var n,r=(t=null==t?ht:pn.defaults(ht.Object(),t,pn.pick(ht,nt))).Array,ie=t.Date,be=t.Error,Ie=t.Function,Ee=t.Math,Te=t.Object,Ce=t.RegExp,ke=t.String,Se=t.TypeError,xe=r.prototype,Ae=Ie.prototype,Ne=Te.prototype,Re=t["__core-js_shared__"],Pe=Ae.toString,De=Ne.hasOwnProperty,Oe=0,Le=(n=/[^.]+$/.exec(Re&&Re.keys&&Re.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",Me=Ne.toString,Fe=Pe.call(Te),Ue=ht._,Ve=Ce("^"+Pe.call(De).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),je=pt?t.Buffer:i,qe=t.Symbol,$e=t.Uint8Array,Be=je?je.allocUnsafe:i,ze=on(Te.getPrototypeOf,Te),We=Te.create,He=Ne.propertyIsEnumerable,Ke=xe.splice,Ge=qe?qe.isConcatSpreadable:i,Qe=qe?qe.iterator:i,Je=qe?qe.toStringTag:i,et=function(){try{var e=cs(Te,"defineProperty");return e({},"",{}),e}catch(e){}}(),ot=t.clearTimeout!==ht.clearTimeout&&t.clearTimeout,ut=ie&&ie.now!==ht.Date.now&&ie.now,lt=t.setTimeout!==ht.setTimeout&&t.setTimeout,dt=Ee.ceil,ft=Ee.floor,gt=Te.getOwnPropertySymbols,mt=je?je.isBuffer:i,Mt=t.isFinite,zt=xe.join,gn=on(Te.keys,Te),mn=Ee.max,yn=Ee.min,_n=ie.now,vn=t.parseInt,wn=Ee.random,bn=xe.reverse,In=cs(t,"DataView"),En=cs(t,"Map"),Tn=cs(t,"Promise"),Cn=cs(t,"Set"),kn=cs(t,"WeakMap"),Sn=cs(Te,"create"),xn=kn&&new kn,An={},Nn=Ms(In),Rn=Ms(En),Pn=Ms(Tn),Dn=Ms(Cn),On=Ms(kn),Ln=qe?qe.prototype:i,Mn=Ln?Ln.valueOf:i,Fn=Ln?Ln.toString:i;function Un(e){if(ea(e)&&!Bo(e)&&!(e instanceof $n)){if(e instanceof qn)return e;if(De.call(e,"__wrapped__"))return Fs(e)}return new qn(e)}var Vn=function(){function e(){}return function(t){if(!Zo(t))return{};if(We)return We(t);e.prototype=t;var n=new e;return e.prototype=i,n}}();function jn(){}function qn(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}function $n(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=f,this.__views__=[]}function Bn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function zn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Wn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Hn(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Wn;++t<n;)this.add(e[t])}function Kn(e){var t=this.__data__=new zn(e);this.size=t.size}function Gn(e,t){var n=Bo(e),r=!n&&$o(e),i=!n&&!r&&Ko(e),s=!n&&!r&&!i&&ca(e),o=n||r||i||s,a=o?Kt(e.length,ke):[],c=a.length;for(var u in e)!t&&!De.call(e,u)||o&&("length"==u||i&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||gs(u,c))||a.push(u);return a}function Qn(e){var t=e.length;return t?e[Wr(0,t-1)]:i}function Yn(e,t){return Rs(ki(e),sr(t,0,e.length))}function Xn(e){return Rs(ki(e))}function Jn(e,t,n){(n!==i&&!Vo(e[t],n)||n===i&&!(t in e))&&rr(e,t,n)}function Zn(e,t,n){var r=e[t];De.call(e,t)&&Vo(r,n)&&(n!==i||t in e)||rr(e,t,n)}function er(e,t){for(var n=e.length;n--;)if(Vo(e[n][0],t))return n;return-1}function tr(e,t,n,r){return lr(e,function(e,i,s){t(r,e,n(e),s)}),r}function nr(e,t){return e&&Si(t,Na(t),e)}function rr(e,t,n){"__proto__"==t&&et?et(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ir(e,t){for(var n=-1,s=t.length,o=r(s),a=null==e;++n<s;)o[n]=a?i:Ca(e,t[n]);return o}function sr(e,t,n){return e==e&&(n!==i&&(e=e<=n?e:n),t!==i&&(e=e>=t?e:t)),e}function or(e,t,n,r,s,o){var a,c=1&t,u=2&t,l=4&t;if(n&&(a=s?n(e,r,s,o):n(e)),a!==i)return a;if(!Zo(e))return e;var h=Bo(e);if(h){if(a=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&De.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!c)return ki(e,a)}else{var d=hs(e),f=d==w||d==b;if(Ko(e))return wi(e,c);if(d==T||d==g||f&&!s){if(a=u||f?{}:fs(e),!c)return u?function(e,t){return Si(e,ls(e),t)}(e,function(e,t){return e&&Si(t,Ra(t),e)}(a,e)):function(e,t){return Si(e,us(e),t)}(e,nr(a,e))}else{if(!st[d])return s?e:{};a=function(e,t,n){var r,i=e.constructor;switch(t){case R:return bi(e);case y:case _:return new i(+e);case P:return function(e,t){var n=t?bi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case D:case O:case L:case M:case F:case U:case V:case j:case q:return Ii(e,n);case I:return new i;case E:case x:return new i(e);case k:return function(e){var t=new e.constructor(e.source,de.exec(e));return t.lastIndex=e.lastIndex,t}(e);case S:return new i;case A:return r=e,Mn?Te(Mn.call(r)):{}}}(e,d,c)}}o||(o=new Kn);var p=o.get(e);if(p)return p;o.set(e,a),sa(e)?e.forEach(function(r){a.add(or(r,t,n,r,e,o))}):ta(e)&&e.forEach(function(r,i){a.set(i,or(r,t,n,i,e,o))});var m=h?i:(l?u?ts:es:u?Ra:Na)(e);return Ct(m||e,function(r,i){m&&(r=e[i=r]),Zn(a,i,or(r,t,n,i,e,o))}),a}function ar(e,t,n){var r=n.length;if(null==e)return!r;for(e=Te(e);r--;){var s=n[r],o=t[s],a=e[s];if(a===i&&!(s in e)||!o(a))return!1}return!0}function cr(e,t,n){if("function"!=typeof e)throw new Se(s);return Ss(function(){e.apply(i,n)},t)}function ur(e,t,n,r){var i=-1,s=At,o=!0,a=e.length,c=[],u=t.length;if(!a)return c;n&&(t=Rt(t,Qt(n))),r?(s=Nt,o=!1):t.length>=200&&(s=Xt,o=!1,t=new Hn(t));e:for(;++i<a;){var l=e[i],h=null==n?l:n(l);if(l=r||0!==l?l:0,o&&h==h){for(var d=u;d--;)if(t[d]===h)continue e;c.push(l)}else s(t,h,r)||c.push(l)}return c}Un.templateSettings={escape:Q,evaluate:Y,interpolate:X,variable:"",imports:{_:Un}},Un.prototype=jn.prototype,Un.prototype.constructor=Un,qn.prototype=Vn(jn.prototype),qn.prototype.constructor=qn,$n.prototype=Vn(jn.prototype),$n.prototype.constructor=$n,Bn.prototype.clear=function(){this.__data__=Sn?Sn(null):{},this.size=0},Bn.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Bn.prototype.get=function(e){var t=this.__data__;if(Sn){var n=t[e];return n===o?i:n}return De.call(t,e)?t[e]:i},Bn.prototype.has=function(e){var t=this.__data__;return Sn?t[e]!==i:De.call(t,e)},Bn.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Sn&&t===i?o:t,this},zn.prototype.clear=function(){this.__data__=[],this.size=0},zn.prototype.delete=function(e){var t=this.__data__,n=er(t,e);return!(n<0||(n==t.length-1?t.pop():Ke.call(t,n,1),--this.size,0))},zn.prototype.get=function(e){var t=this.__data__,n=er(t,e);return n<0?i:t[n][1]},zn.prototype.has=function(e){return er(this.__data__,e)>-1},zn.prototype.set=function(e,t){var n=this.__data__,r=er(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Wn.prototype.clear=function(){this.size=0,this.__data__={hash:new Bn,map:new(En||zn),string:new Bn}},Wn.prototype.delete=function(e){var t=os(this,e).delete(e);return this.size-=t?1:0,t},Wn.prototype.get=function(e){return os(this,e).get(e)},Wn.prototype.has=function(e){return os(this,e).has(e)},Wn.prototype.set=function(e,t){var n=os(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Hn.prototype.add=Hn.prototype.push=function(e){return this.__data__.set(e,o),this},Hn.prototype.has=function(e){return this.__data__.has(e)},Kn.prototype.clear=function(){this.__data__=new zn,this.size=0},Kn.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Kn.prototype.get=function(e){return this.__data__.get(e)},Kn.prototype.has=function(e){return this.__data__.has(e)},Kn.prototype.set=function(e,t){var n=this.__data__;if(n instanceof zn){var r=n.__data__;if(!En||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Wn(r)}return n.set(e,t),this.size=n.size,this};var lr=Ni(_r),hr=Ni(vr,!0);function dr(e,t){var n=!0;return lr(e,function(e,r,i){return n=!!t(e,r,i)}),n}function fr(e,t,n){for(var r=-1,s=e.length;++r<s;){var o=e[r],a=t(o);if(null!=a&&(c===i?a==a&&!aa(a):n(a,c)))var c=a,u=o}return u}function pr(e,t){var n=[];return lr(e,function(e,r,i){t(e,r,i)&&n.push(e)}),n}function gr(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=ps),i||(i=[]);++s<o;){var a=e[s];t>0&&n(a)?t>1?gr(a,t-1,n,r,i):Pt(i,a):r||(i[i.length]=a)}return i}var mr=Ri(),yr=Ri(!0);function _r(e,t){return e&&mr(e,t,Na)}function vr(e,t){return e&&yr(e,t,Na)}function wr(e,t){return xt(t,function(t){return Yo(e[t])})}function br(e,t){for(var n=0,r=(t=mi(t,e)).length;null!=e&&n<r;)e=e[Ls(t[n++])];return n&&n==r?e:i}function Ir(e,t,n){var r=t(e);return Bo(e)?r:Pt(r,n(e))}function Er(e){return null==e?e===i?"[object Undefined]":"[object Null]":Je&&Je in Te(e)?function(e){var t=De.call(e,Je),n=e[Je];try{e[Je]=i;var r=!0}catch(e){}var s=Me.call(e);return r&&(t?e[Je]=n:delete e[Je]),s}(e):function(e){return Me.call(e)}(e)}function Tr(e,t){return e>t}function Cr(e,t){return null!=e&&De.call(e,t)}function kr(e,t){return null!=e&&t in Te(e)}function Sr(e,t,n){for(var s=n?Nt:At,o=e[0].length,a=e.length,c=a,u=r(a),l=1/0,h=[];c--;){var d=e[c];c&&t&&(d=Rt(d,Qt(t))),l=yn(d.length,l),u[c]=!n&&(t||o>=120&&d.length>=120)?new Hn(c&&d):i}d=e[0];var f=-1,p=u[0];e:for(;++f<o&&h.length<l;){var g=d[f],m=t?t(g):g;if(g=n||0!==g?g:0,!(p?Xt(p,m):s(h,m,n))){for(c=a;--c;){var y=u[c];if(!(y?Xt(y,m):s(e[c],m,n)))continue e}p&&p.push(m),h.push(g)}}return h}function xr(e,t,n){var r=null==(e=Ts(e,t=mi(t,e)))?e:e[Ls(Gs(t))];return null==r?i:Et(r,e,n)}function Ar(e){return ea(e)&&Er(e)==g}function Nr(e,t,n,r,s){return e===t||(null==e||null==t||!ea(e)&&!ea(t)?e!=e&&t!=t:function(e,t,n,r,s,o){var a=Bo(e),c=Bo(t),u=a?m:hs(e),l=c?m:hs(t),h=(u=u==g?T:u)==T,d=(l=l==g?T:l)==T,f=u==l;if(f&&Ko(e)){if(!Ko(t))return!1;a=!0,h=!1}if(f&&!h)return o||(o=new Kn),a||ca(e)?Ji(e,t,n,r,s,o):function(e,t,n,r,i,s,o){switch(n){case P:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case R:return!(e.byteLength!=t.byteLength||!s(new $e(e),new $e(t)));case y:case _:case E:return Vo(+e,+t);case v:return e.name==t.name&&e.message==t.message;case k:case x:return e==t+"";case I:var a=sn;case S:var c=1&r;if(a||(a=cn),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;r|=2,o.set(e,t);var l=Ji(a(e),a(t),r,i,s,o);return o.delete(e),l;case A:if(Mn)return Mn.call(e)==Mn.call(t)}return!1}(e,t,u,n,r,s,o);if(!(1&n)){var p=h&&De.call(e,"__wrapped__"),w=d&&De.call(t,"__wrapped__");if(p||w){var b=p?e.value():e,C=w?t.value():t;return o||(o=new Kn),s(b,C,n,r,o)}}return!!f&&(o||(o=new Kn),function(e,t,n,r,s,o){var a=1&n,c=es(e),u=c.length;if(u!=es(t).length&&!a)return!1;for(var l=u;l--;){var h=c[l];if(!(a?h in t:De.call(t,h)))return!1}var d=o.get(e),f=o.get(t);if(d&&f)return d==t&&f==e;var p=!0;o.set(e,t),o.set(t,e);for(var g=a;++l<u;){var m=e[h=c[l]],y=t[h];if(r)var _=a?r(y,m,h,t,e,o):r(m,y,h,e,t,o);if(!(_===i?m===y||s(m,y,n,r,o):_)){p=!1;break}g||(g="constructor"==h)}if(p&&!g){var v=e.constructor,w=t.constructor;v==w||!("constructor"in e)||!("constructor"in t)||"function"==typeof v&&v instanceof v&&"function"==typeof w&&w instanceof w||(p=!1)}return o.delete(e),o.delete(t),p}(e,t,n,r,s,o))}(e,t,n,r,Nr,s))}function Rr(e,t,n,r){var s=n.length,o=s,a=!r;if(null==e)return!o;for(e=Te(e);s--;){var c=n[s];if(a&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++s<o;){var u=(c=n[s])[0],l=e[u],h=c[1];if(a&&c[2]){if(l===i&&!(u in e))return!1}else{var d=new Kn;if(r)var f=r(l,h,u,e,t,d);if(!(f===i?Nr(h,l,3,r,d):f))return!1}}return!0}function Pr(e){return!(!Zo(e)||(t=e,Le&&Le in t))&&(Yo(e)?Ve:ge).test(Ms(e));var t}function Dr(e){return"function"==typeof e?e:null==e?nc:"object"==typeof e?Bo(e)?Ur(e[0],e[1]):Fr(e):hc(e)}function Or(e){if(!ws(e))return gn(e);var t=[];for(var n in Te(e))De.call(e,n)&&"constructor"!=n&&t.push(n);return t}function Lr(e,t){return e<t}function Mr(e,t){var n=-1,i=Wo(e)?r(e.length):[];return lr(e,function(e,r,s){i[++n]=t(e,r,s)}),i}function Fr(e){var t=as(e);return 1==t.length&&t[0][2]?Is(t[0][0],t[0][1]):function(n){return n===e||Rr(n,e,t)}}function Ur(e,t){return ys(e)&&bs(t)?Is(Ls(e),t):function(n){var r=Ca(n,e);return r===i&&r===t?ka(n,e):Nr(t,r,3)}}function Vr(e,t,n,r,s){e!==t&&mr(t,function(o,a){if(s||(s=new Kn),Zo(o))!function(e,t,n,r,s,o,a){var c=Cs(e,n),u=Cs(t,n),l=a.get(u);if(l)Jn(e,n,l);else{var h=o?o(c,u,n+"",e,t,a):i,d=h===i;if(d){var f=Bo(u),p=!f&&Ko(u),g=!f&&!p&&ca(u);h=u,f||p||g?Bo(c)?h=c:Ho(c)?h=ki(c):p?(d=!1,h=wi(u,!0)):g?(d=!1,h=Ii(u,!0)):h=[]:ra(u)||$o(u)?(h=c,$o(c)?h=ma(c):Zo(c)&&!Yo(c)||(h=fs(u))):d=!1}d&&(a.set(u,h),s(h,u,r,o,a),a.delete(u)),Jn(e,n,h)}}(e,t,a,n,Vr,r,s);else{var c=r?r(Cs(e,a),o,a+"",e,t,s):i;c===i&&(c=o),Jn(e,a,c)}},Ra)}function jr(e,t){var n=e.length;if(n)return gs(t+=t<0?n:0,n)?e[t]:i}function qr(e,t,n){t=t.length?Rt(t,function(e){return Bo(e)?function(t){return br(t,1===e.length?e[0]:e)}:e}):[nc];var r=-1;t=Rt(t,Qt(ss()));var i=Mr(e,function(e,n,i){var s=Rt(t,function(t){return t(e)});return{criteria:s,index:++r,value:e}});return function(e){var t=e.length;for(e.sort(function(e,t){return function(e,t,n){for(var r=-1,i=e.criteria,s=t.criteria,o=i.length,a=n.length;++r<o;){var c=Ei(i[r],s[r]);if(c)return r>=a?c:c*("desc"==n[r]?-1:1)}return e.index-t.index}(e,t,n)});t--;)e[t]=e[t].value;return e}(i)}function $r(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=br(e,o);n(a,o)&&Yr(s,mi(o,e),a)}return s}function Br(e,t,n,r){var i=r?jt:Vt,s=-1,o=t.length,a=e;for(e===t&&(t=ki(t)),n&&(a=Rt(e,Qt(n)));++s<o;)for(var c=0,u=t[s],l=n?n(u):u;(c=i(a,l,c,r))>-1;)a!==e&&Ke.call(a,c,1),Ke.call(e,c,1);return e}function zr(e,t){for(var n=e?t.length:0,r=n-1;n--;){var i=t[n];if(n==r||i!==s){var s=i;gs(i)?Ke.call(e,i,1):ci(e,i)}}return e}function Wr(e,t){return e+ft(wn()*(t-e+1))}function Hr(e,t){var n="";if(!e||t<1||t>h)return n;do{t%2&&(n+=e),(t=ft(t/2))&&(e+=e)}while(t);return n}function Kr(e,t){return xs(Es(e,t,nc),e+"")}function Gr(e){return Qn(Va(e))}function Qr(e,t){var n=Va(e);return Rs(n,sr(t,0,n.length))}function Yr(e,t,n,r){if(!Zo(e))return e;for(var s=-1,o=(t=mi(t,e)).length,a=o-1,c=e;null!=c&&++s<o;){var u=Ls(t[s]),l=n;if("__proto__"===u||"constructor"===u||"prototype"===u)return e;if(s!=a){var h=c[u];(l=r?r(h,u,c):i)===i&&(l=Zo(h)?h:gs(t[s+1])?[]:{})}Zn(c,u,l),c=c[u]}return e}var Xr=xn?function(e,t){return xn.set(e,t),e}:nc,Jr=et?function(e,t){return et(e,"toString",{configurable:!0,enumerable:!1,value:Za(t),writable:!0})}:nc;function Zr(e){return Rs(Va(e))}function ei(e,t,n){var i=-1,s=e.length;t<0&&(t=-t>s?0:s+t),(n=n>s?s:n)<0&&(n+=s),s=t>n?0:n-t>>>0,t>>>=0;for(var o=r(s);++i<s;)o[i]=e[i+t];return o}function ti(e,t){var n;return lr(e,function(e,r,i){return!(n=t(e,r,i))}),!!n}function ni(e,t,n){var r=0,i=null==e?r:e.length;if("number"==typeof t&&t==t&&i<=2147483647){for(;r<i;){var s=r+i>>>1,o=e[s];null!==o&&!aa(o)&&(n?o<=t:o<t)?r=s+1:i=s}return i}return ri(e,t,nc,n)}function ri(e,t,n,r){var s=0,o=null==e?0:e.length;if(0===o)return 0;for(var a=(t=n(t))!=t,c=null===t,u=aa(t),l=t===i;s<o;){var h=ft((s+o)/2),d=n(e[h]),f=d!==i,p=null===d,g=d==d,m=aa(d);if(a)var y=r||g;else y=l?g&&(r||f):c?g&&f&&(r||!p):u?g&&f&&!p&&(r||!m):!p&&!m&&(r?d<=t:d<t);y?s=h+1:o=h}return yn(o,4294967294)}function ii(e,t){for(var n=-1,r=e.length,i=0,s=[];++n<r;){var o=e[n],a=t?t(o):o;if(!n||!Vo(a,c)){var c=a;s[i++]=0===o?0:o}}return s}function si(e){return"number"==typeof e?e:aa(e)?d:+e}function oi(e){if("string"==typeof e)return e;if(Bo(e))return Rt(e,oi)+"";if(aa(e))return Fn?Fn.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function ai(e,t,n){var r=-1,i=At,s=e.length,o=!0,a=[],c=a;if(n)o=!1,i=Nt;else if(s>=200){var u=t?null:Hi(e);if(u)return cn(u);o=!1,i=Xt,c=new Hn}else c=t?[]:a;e:for(;++r<s;){var l=e[r],h=t?t(l):l;if(l=n||0!==l?l:0,o&&h==h){for(var d=c.length;d--;)if(c[d]===h)continue e;t&&c.push(h),a.push(l)}else i(c,h,n)||(c!==a&&c.push(h),a.push(l))}return a}function ci(e,t){return null==(e=Ts(e,t=mi(t,e)))||delete e[Ls(Gs(t))]}function ui(e,t,n,r){return Yr(e,t,n(br(e,t)),r)}function li(e,t,n,r){for(var i=e.length,s=r?i:-1;(r?s--:++s<i)&&t(e[s],s,e););return n?ei(e,r?0:s,r?s+1:i):ei(e,r?s+1:0,r?i:s)}function hi(e,t){var n=e;return n instanceof $n&&(n=n.value()),Dt(t,function(e,t){return t.func.apply(t.thisArg,Pt([e],t.args))},n)}function di(e,t,n){var i=e.length;if(i<2)return i?ai(e[0]):[];for(var s=-1,o=r(i);++s<i;)for(var a=e[s],c=-1;++c<i;)c!=s&&(o[s]=ur(o[s]||a,e[c],t,n));return ai(gr(o,1),t,n)}function fi(e,t,n){for(var r=-1,s=e.length,o=t.length,a={};++r<s;){var c=r<o?t[r]:i;n(a,e[r],c)}return a}function pi(e){return Ho(e)?e:[]}function gi(e){return"function"==typeof e?e:nc}function mi(e,t){return Bo(e)?e:ys(e,t)?[e]:Os(ya(e))}var yi=Kr;function _i(e,t,n){var r=e.length;return n=n===i?r:n,!t&&n>=r?e:ei(e,t,n)}var vi=ot||function(e){return ht.clearTimeout(e)};function wi(e,t){if(t)return e.slice();var n=e.length,r=Be?Be(n):new e.constructor(n);return e.copy(r),r}function bi(e){var t=new e.constructor(e.byteLength);return new $e(t).set(new $e(e)),t}function Ii(e,t){var n=t?bi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Ei(e,t){if(e!==t){var n=e!==i,r=null===e,s=e==e,o=aa(e),a=t!==i,c=null===t,u=t==t,l=aa(t);if(!c&&!l&&!o&&e>t||o&&a&&u&&!c&&!l||r&&a&&u||!n&&u||!s)return 1;if(!r&&!o&&!l&&e<t||l&&n&&s&&!r&&!o||c&&n&&s||!a&&s||!u)return-1}return 0}function Ti(e,t,n,i){for(var s=-1,o=e.length,a=n.length,c=-1,u=t.length,l=mn(o-a,0),h=r(u+l),d=!i;++c<u;)h[c]=t[c];for(;++s<a;)(d||s<o)&&(h[n[s]]=e[s]);for(;l--;)h[c++]=e[s++];return h}function Ci(e,t,n,i){for(var s=-1,o=e.length,a=-1,c=n.length,u=-1,l=t.length,h=mn(o-c,0),d=r(h+l),f=!i;++s<h;)d[s]=e[s];for(var p=s;++u<l;)d[p+u]=t[u];for(;++a<c;)(f||s<o)&&(d[p+n[a]]=e[s++]);return d}function ki(e,t){var n=-1,i=e.length;for(t||(t=r(i));++n<i;)t[n]=e[n];return t}function Si(e,t,n,r){var s=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var c=t[o],u=r?r(n[c],e[c],c,n,e):i;u===i&&(u=e[c]),s?rr(n,c,u):Zn(n,c,u)}return n}function xi(e,t){return function(n,r){var i=Bo(n)?Tt:tr,s=t?t():{};return i(n,e,ss(r,2),s)}}function Ai(e){return Kr(function(t,n){var r=-1,s=n.length,o=s>1?n[s-1]:i,a=s>2?n[2]:i;for(o=e.length>3&&"function"==typeof o?(s--,o):i,a&&ms(n[0],n[1],a)&&(o=s<3?i:o,s=1),t=Te(t);++r<s;){var c=n[r];c&&e(t,c,r,o)}return t})}function Ni(e,t){return function(n,r){if(null==n)return n;if(!Wo(n))return e(n,r);for(var i=n.length,s=t?i:-1,o=Te(n);(t?s--:++s<i)&&!1!==r(o[s],s,o););return n}}function Ri(e){return function(t,n,r){for(var i=-1,s=Te(t),o=r(t),a=o.length;a--;){var c=o[e?a:++i];if(!1===n(s[c],c,s))break}return t}}function Pi(e){return function(t){var n=rn(t=ya(t))?hn(t):i,r=n?n[0]:t.charAt(0),s=n?_i(n,1).join(""):t.slice(1);return r[e]()+s}}function Di(e){return function(t){return Dt(Ya($a(t).replace(Ye,"")),e,"")}}function Oi(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Vn(e.prototype),r=e.apply(n,t);return Zo(r)?r:n}}function Li(e){return function(t,n,r){var s=Te(t);if(!Wo(t)){var o=ss(n,3);t=Na(t),n=function(e){return o(s[e],e,s)}}var a=e(t,n,r);return a>-1?s[o?t[a]:a]:i}}function Mi(e){return Zi(function(t){var n=t.length,r=n,o=qn.prototype.thru;for(e&&t.reverse();r--;){var a=t[r];if("function"!=typeof a)throw new Se(s);if(o&&!c&&"wrapper"==rs(a))var c=new qn([],!0)}for(r=c?r:n;++r<n;){var u=rs(a=t[r]),l="wrapper"==u?ns(a):i;c=l&&_s(l[0])&&424==l[1]&&!l[4].length&&1==l[9]?c[rs(l[0])].apply(c,l[3]):1==a.length&&_s(a)?c[u]():c.thru(a)}return function(){var e=arguments,r=e[0];if(c&&1==e.length&&Bo(r))return c.plant(r).value();for(var i=0,s=n?t[i].apply(this,e):r;++i<n;)s=t[i].call(this,s);return s}})}function Fi(e,t,n,s,o,a,c,l,h,d){var f=t&u,p=1&t,g=2&t,m=24&t,y=512&t,_=g?i:Oi(e);return function u(){for(var v=arguments.length,w=r(v),b=v;b--;)w[b]=arguments[b];if(m)var I=is(u),E=function(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r}(w,I);if(s&&(w=Ti(w,s,o,m)),a&&(w=Ci(w,a,c,m)),v-=E,m&&v<d){var T=an(w,I);return zi(e,t,Fi,u.placeholder,n,w,T,l,h,d-v)}var C=p?n:this,k=g?C[e]:e;return v=w.length,l?w=function(e,t){for(var n=e.length,r=yn(t.length,n),s=ki(e);r--;){var o=t[r];e[r]=gs(o,n)?s[o]:i}return e}(w,l):y&&v>1&&w.reverse(),f&&h<v&&(w.length=h),this&&this!==ht&&this instanceof u&&(k=_||Oi(k)),k.apply(C,w)}}function Ui(e,t){return function(n,r){return function(e,t,n,r){return _r(e,function(e,i,s){t(r,n(e),i,s)}),r}(n,e,t(r),{})}}function Vi(e,t){return function(n,r){var s;if(n===i&&r===i)return t;if(n!==i&&(s=n),r!==i){if(s===i)return r;"string"==typeof n||"string"==typeof r?(n=oi(n),r=oi(r)):(n=si(n),r=si(r)),s=e(n,r)}return s}}function ji(e){return Zi(function(t){return t=Rt(t,Qt(ss())),Kr(function(n){var r=this;return e(t,function(e){return Et(e,r,n)})})})}function qi(e,t){var n=(t=t===i?" ":oi(t)).length;if(n<2)return n?Hr(t,e):t;var r=Hr(t,dt(e/ln(t)));return rn(t)?_i(hn(r),0,e).join(""):r.slice(0,e)}function $i(e){return function(t,n,s){return s&&"number"!=typeof s&&ms(t,n,s)&&(n=s=i),t=da(t),n===i?(n=t,t=0):n=da(n),function(e,t,n,i){for(var s=-1,o=mn(dt((t-e)/(n||1)),0),a=r(o);o--;)a[i?o:++s]=e,e+=n;return a}(t,n,s=s===i?t<n?1:-1:da(s),e)}}function Bi(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=ga(t),n=ga(n)),e(t,n)}}function zi(e,t,n,r,s,o,a,u,l,h){var d=8&t;t|=d?c:64,4&(t&=~(d?64:c))||(t&=-4);var f=[e,t,s,d?o:i,d?a:i,d?i:o,d?i:a,u,l,h],p=n.apply(i,f);return _s(e)&&ks(p,f),p.placeholder=r,As(p,e,t)}function Wi(e){var t=Ee[e];return function(e,n){if(e=ga(e),(n=null==n?0:yn(fa(n),292))&&Mt(e)){var r=(ya(e)+"e").split("e");return+((r=(ya(t(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}var Hi=Cn&&1/cn(new Cn([,-0]))[1]==l?function(e){return new Cn(e)}:ac;function Ki(e){return function(t){var n=hs(t);return n==I?sn(t):n==S?un(t):function(e,t){return Rt(t,function(t){return[t,e[t]]})}(t,e(t))}}function Gi(e,t,n,o,l,h,d,f){var p=2&t;if(!p&&"function"!=typeof e)throw new Se(s);var g=o?o.length:0;if(g||(t&=-97,o=l=i),d=d===i?d:mn(fa(d),0),f=f===i?f:fa(f),g-=l?l.length:0,64&t){var m=o,y=l;o=l=i}var _=p?i:ns(e),v=[e,t,n,o,l,m,y,h,d,f];if(_&&function(e,t){var n=e[1],r=t[1],i=n|r,s=i<131,o=r==u&&8==n||r==u&&256==n&&e[7].length<=t[8]||384==r&&t[7].length<=t[8]&&8==n;if(!s&&!o)return e;1&r&&(e[2]=t[2],i|=1&n?0:4);var c=t[3];if(c){var l=e[3];e[3]=l?Ti(l,c,t[4]):c,e[4]=l?an(e[3],a):t[4]}(c=t[5])&&(l=e[5],e[5]=l?Ci(l,c,t[6]):c,e[6]=l?an(e[5],a):t[6]),(c=t[7])&&(e[7]=c),r&u&&(e[8]=null==e[8]?t[8]:yn(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i}(v,_),e=v[0],t=v[1],n=v[2],o=v[3],l=v[4],!(f=v[9]=v[9]===i?p?0:e.length:mn(v[9]-g,0))&&24&t&&(t&=-25),t&&1!=t)w=8==t||16==t?function(e,t,n){var s=Oi(e);return function o(){for(var a=arguments.length,c=r(a),u=a,l=is(o);u--;)c[u]=arguments[u];var h=a<3&&c[0]!==l&&c[a-1]!==l?[]:an(c,l);return(a-=h.length)<n?zi(e,t,Fi,o.placeholder,i,c,h,i,i,n-a):Et(this&&this!==ht&&this instanceof o?s:e,this,c)}}(e,t,f):t!=c&&33!=t||l.length?Fi.apply(i,v):function(e,t,n,i){var s=1&t,o=Oi(e);return function t(){for(var a=-1,c=arguments.length,u=-1,l=i.length,h=r(l+c),d=this&&this!==ht&&this instanceof t?o:e;++u<l;)h[u]=i[u];for(;c--;)h[u++]=arguments[++a];return Et(d,s?n:this,h)}}(e,t,n,o);else var w=function(e,t,n){var r=1&t,i=Oi(e);return function t(){return(this&&this!==ht&&this instanceof t?i:e).apply(r?n:this,arguments)}}(e,t,n);return As((_?Xr:ks)(w,v),e,t)}function Qi(e,t,n,r){return e===i||Vo(e,Ne[n])&&!De.call(r,n)?t:e}function Yi(e,t,n,r,s,o){return Zo(e)&&Zo(t)&&(o.set(t,e),Vr(e,t,i,Yi,o),o.delete(t)),e}function Xi(e){return ra(e)?i:e}function Ji(e,t,n,r,s,o){var a=1&n,c=e.length,u=t.length;if(c!=u&&!(a&&u>c))return!1;var l=o.get(e),h=o.get(t);if(l&&h)return l==t&&h==e;var d=-1,f=!0,p=2&n?new Hn:i;for(o.set(e,t),o.set(t,e);++d<c;){var g=e[d],m=t[d];if(r)var y=a?r(m,g,d,t,e,o):r(g,m,d,e,t,o);if(y!==i){if(y)continue;f=!1;break}if(p){if(!Lt(t,function(e,t){if(!Xt(p,t)&&(g===e||s(g,e,n,r,o)))return p.push(t)})){f=!1;break}}else if(g!==m&&!s(g,m,n,r,o)){f=!1;break}}return o.delete(e),o.delete(t),f}function Zi(e){return xs(Es(e,i,Bs),e+"")}function es(e){return Ir(e,Na,us)}function ts(e){return Ir(e,Ra,ls)}var ns=xn?function(e){return xn.get(e)}:ac;function rs(e){for(var t=e.name+"",n=An[t],r=De.call(An,t)?n.length:0;r--;){var i=n[r],s=i.func;if(null==s||s==e)return i.name}return t}function is(e){return(De.call(Un,"placeholder")?Un:e).placeholder}function ss(){var e=Un.iteratee||rc;return e=e===rc?Dr:e,arguments.length?e(arguments[0],arguments[1]):e}function os(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function as(e){for(var t=Na(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,bs(i)]}return t}function cs(e,t){var n=function(e,t){return null==e?i:e[t]}(e,t);return Pr(n)?n:i}var us=gt?function(e){return null==e?[]:(e=Te(e),xt(gt(e),function(t){return He.call(e,t)}))}:pc,ls=gt?function(e){for(var t=[];e;)Pt(t,us(e)),e=ze(e);return t}:pc,hs=Er;function ds(e,t,n){for(var r=-1,i=(t=mi(t,e)).length,s=!1;++r<i;){var o=Ls(t[r]);if(!(s=null!=e&&n(e,o)))break;e=e[o]}return s||++r!=i?s:!!(i=null==e?0:e.length)&&Jo(i)&&gs(o,i)&&(Bo(e)||$o(e))}function fs(e){return"function"!=typeof e.constructor||ws(e)?{}:Vn(ze(e))}function ps(e){return Bo(e)||$o(e)||!!(Ge&&e&&e[Ge])}function gs(e,t){var n=typeof e;return!!(t=null==t?h:t)&&("number"==n||"symbol"!=n&&ye.test(e))&&e>-1&&e%1==0&&e<t}function ms(e,t,n){if(!Zo(n))return!1;var r=typeof t;return!!("number"==r?Wo(n)&&gs(t,n.length):"string"==r&&t in n)&&Vo(n[t],e)}function ys(e,t){if(Bo(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!aa(e))||Z.test(e)||!J.test(e)||null!=t&&e in Te(t)}function _s(e){var t=rs(e),n=Un[t];if("function"!=typeof n||!(t in $n.prototype))return!1;if(e===n)return!0;var r=ns(n);return!!r&&e===r[0]}(In&&hs(new In(new ArrayBuffer(1)))!=P||En&&hs(new En)!=I||Tn&&hs(Tn.resolve())!=C||Cn&&hs(new Cn)!=S||kn&&hs(new kn)!=N)&&(hs=function(e){var t=Er(e),n=t==T?e.constructor:i,r=n?Ms(n):"";if(r)switch(r){case Nn:return P;case Rn:return I;case Pn:return C;case Dn:return S;case On:return N}return t});var vs=Re?Yo:gc;function ws(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Ne)}function bs(e){return e==e&&!Zo(e)}function Is(e,t){return function(n){return null!=n&&n[e]===t&&(t!==i||e in Te(n))}}function Es(e,t,n){return t=mn(t===i?e.length-1:t,0),function(){for(var i=arguments,s=-1,o=mn(i.length-t,0),a=r(o);++s<o;)a[s]=i[t+s];s=-1;for(var c=r(t+1);++s<t;)c[s]=i[s];return c[t]=n(a),Et(e,this,c)}}function Ts(e,t){return t.length<2?e:br(e,ei(t,0,-1))}function Cs(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var ks=Ns(Xr),Ss=lt||function(e,t){return ht.setTimeout(e,t)},xs=Ns(Jr);function As(e,t,n){var r=t+"";return xs(e,function(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(n>1?"& ":"")+t[r],t=t.join(n>2?", ":" "),e.replace(se,"{\n/* [wrapped with "+t+"] */\n")}(r,function(e,t){return Ct(p,function(n){var r="_."+n[0];t&n[1]&&!At(e,r)&&e.push(r)}),e.sort()}(function(e){var t=e.match(oe);return t?t[1].split(ae):[]}(r),n)))}function Ns(e){var t=0,n=0;return function(){var r=_n(),s=16-(r-n);if(n=r,s>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(i,arguments)}}function Rs(e,t){var n=-1,r=e.length,s=r-1;for(t=t===i?r:t;++n<t;){var o=Wr(n,s),a=e[o];e[o]=e[n],e[n]=a}return e.length=t,e}var Ps,Ds,Os=(Ps=Do(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ee,function(e,n,r,i){t.push(r?i.replace(le,"$1"):n||e)}),t},function(e){return 500===Ds.size&&Ds.clear(),e}),Ds=Ps.cache,Ps);function Ls(e){if("string"==typeof e||aa(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Ms(e){if(null!=e){try{return Pe.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Fs(e){if(e instanceof $n)return e.clone();var t=new qn(e.__wrapped__,e.__chain__);return t.__actions__=ki(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Us=Kr(function(e,t){return Ho(e)?ur(e,gr(t,1,Ho,!0)):[]}),Vs=Kr(function(e,t){var n=Gs(t);return Ho(n)&&(n=i),Ho(e)?ur(e,gr(t,1,Ho,!0),ss(n,2)):[]}),js=Kr(function(e,t){var n=Gs(t);return Ho(n)&&(n=i),Ho(e)?ur(e,gr(t,1,Ho,!0),i,n):[]});function qs(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:fa(n);return i<0&&(i=mn(r+i,0)),Ut(e,ss(t,3),i)}function $s(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var s=r-1;return n!==i&&(s=fa(n),s=n<0?mn(r+s,0):yn(s,r-1)),Ut(e,ss(t,3),s,!0)}function Bs(e){return null!=e&&e.length?gr(e,1):[]}function zs(e){return e&&e.length?e[0]:i}var Ws=Kr(function(e){var t=Rt(e,pi);return t.length&&t[0]===e[0]?Sr(t):[]}),Hs=Kr(function(e){var t=Gs(e),n=Rt(e,pi);return t===Gs(n)?t=i:n.pop(),n.length&&n[0]===e[0]?Sr(n,ss(t,2)):[]}),Ks=Kr(function(e){var t=Gs(e),n=Rt(e,pi);return(t="function"==typeof t?t:i)&&n.pop(),n.length&&n[0]===e[0]?Sr(n,i,t):[]});function Gs(e){var t=null==e?0:e.length;return t?e[t-1]:i}var Qs=Kr(Ys);function Ys(e,t){return e&&e.length&&t&&t.length?Br(e,t):e}var Xs=Zi(function(e,t){var n=null==e?0:e.length,r=ir(e,t);return zr(e,Rt(t,function(e){return gs(e,n)?+e:e}).sort(Ei)),r});function Js(e){return null==e?e:bn.call(e)}var Zs=Kr(function(e){return ai(gr(e,1,Ho,!0))}),eo=Kr(function(e){var t=Gs(e);return Ho(t)&&(t=i),ai(gr(e,1,Ho,!0),ss(t,2))}),to=Kr(function(e){var t=Gs(e);return t="function"==typeof t?t:i,ai(gr(e,1,Ho,!0),i,t)});function no(e){if(!e||!e.length)return[];var t=0;return e=xt(e,function(e){if(Ho(e))return t=mn(e.length,t),!0}),Kt(t,function(t){return Rt(e,Bt(t))})}function ro(e,t){if(!e||!e.length)return[];var n=no(e);return null==t?n:Rt(n,function(e){return Et(t,i,e)})}var io=Kr(function(e,t){return Ho(e)?ur(e,t):[]}),so=Kr(function(e){return di(xt(e,Ho))}),oo=Kr(function(e){var t=Gs(e);return Ho(t)&&(t=i),di(xt(e,Ho),ss(t,2))}),ao=Kr(function(e){var t=Gs(e);return t="function"==typeof t?t:i,di(xt(e,Ho),i,t)}),co=Kr(no),uo=Kr(function(e){var t=e.length,n=t>1?e[t-1]:i;return n="function"==typeof n?(e.pop(),n):i,ro(e,n)});function lo(e){var t=Un(e);return t.__chain__=!0,t}function ho(e,t){return t(e)}var fo=Zi(function(e){var t=e.length,n=t?e[0]:0,r=this.__wrapped__,s=function(t){return ir(t,e)};return!(t>1||this.__actions__.length)&&r instanceof $n&&gs(n)?((r=r.slice(n,+n+(t?1:0))).__actions__.push({func:ho,args:[s],thisArg:i}),new qn(r,this.__chain__).thru(function(e){return t&&!e.length&&e.push(i),e})):this.thru(s)}),po=xi(function(e,t,n){De.call(e,n)?++e[n]:rr(e,n,1)}),go=Li(qs),mo=Li($s);function yo(e,t){return(Bo(e)?Ct:lr)(e,ss(t,3))}function _o(e,t){return(Bo(e)?kt:hr)(e,ss(t,3))}var vo=xi(function(e,t,n){De.call(e,n)?e[n].push(t):rr(e,n,[t])}),wo=Kr(function(e,t,n){var i=-1,s="function"==typeof t,o=Wo(e)?r(e.length):[];return lr(e,function(e){o[++i]=s?Et(t,e,n):xr(e,t,n)}),o}),bo=xi(function(e,t,n){rr(e,n,t)});function Io(e,t){return(Bo(e)?Rt:Mr)(e,ss(t,3))}var Eo=xi(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]}),To=Kr(function(e,t){if(null==e)return[];var n=t.length;return n>1&&ms(e,t[0],t[1])?t=[]:n>2&&ms(t[0],t[1],t[2])&&(t=[t[0]]),qr(e,gr(t,1),[])}),Co=ut||function(){return ht.Date.now()};function ko(e,t,n){return t=n?i:t,t=e&&null==t?e.length:t,Gi(e,u,i,i,i,i,t)}function So(e,t){var n;if("function"!=typeof t)throw new Se(s);return e=fa(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=i),n}}var xo=Kr(function(e,t,n){var r=1;if(n.length){var i=an(n,is(xo));r|=c}return Gi(e,r,t,n,i)}),Ao=Kr(function(e,t,n){var r=3;if(n.length){var i=an(n,is(Ao));r|=c}return Gi(t,r,e,n,i)});function No(e,t,n){var r,o,a,c,u,l,h=0,d=!1,f=!1,p=!0;if("function"!=typeof e)throw new Se(s);function g(t){var n=r,s=o;return r=o=i,h=t,c=e.apply(s,n)}function m(e){var n=e-l;return l===i||n>=t||n<0||f&&e-h>=a}function y(){var e=Co();if(m(e))return _(e);u=Ss(y,function(e){var n=t-(e-l);return f?yn(n,a-(e-h)):n}(e))}function _(e){return u=i,p&&r?g(e):(r=o=i,c)}function v(){var e=Co(),n=m(e);if(r=arguments,o=this,l=e,n){if(u===i)return function(e){return h=e,u=Ss(y,t),d?g(e):c}(l);if(f)return vi(u),u=Ss(y,t),g(l)}return u===i&&(u=Ss(y,t)),c}return t=ga(t)||0,Zo(n)&&(d=!!n.leading,a=(f="maxWait"in n)?mn(ga(n.maxWait)||0,t):a,p="trailing"in n?!!n.trailing:p),v.cancel=function(){u!==i&&vi(u),h=0,r=l=o=u=i},v.flush=function(){return u===i?c:_(Co())},v}var Ro=Kr(function(e,t){return cr(e,1,t)}),Po=Kr(function(e,t,n){return cr(e,ga(t)||0,n)});function Do(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new Se(s);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Do.Cache||Wn),n}function Oo(e){if("function"!=typeof e)throw new Se(s);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Do.Cache=Wn;var Lo=yi(function(e,t){var n=(t=1==t.length&&Bo(t[0])?Rt(t[0],Qt(ss())):Rt(gr(t,1),Qt(ss()))).length;return Kr(function(r){for(var i=-1,s=yn(r.length,n);++i<s;)r[i]=t[i].call(this,r[i]);return Et(e,this,r)})}),Mo=Kr(function(e,t){var n=an(t,is(Mo));return Gi(e,c,i,t,n)}),Fo=Kr(function(e,t){var n=an(t,is(Fo));return Gi(e,64,i,t,n)}),Uo=Zi(function(e,t){return Gi(e,256,i,i,i,t)});function Vo(e,t){return e===t||e!=e&&t!=t}var jo=Bi(Tr),qo=Bi(function(e,t){return e>=t}),$o=Ar(function(){return arguments}())?Ar:function(e){return ea(e)&&De.call(e,"callee")&&!He.call(e,"callee")},Bo=r.isArray,zo=yt?Qt(yt):function(e){return ea(e)&&Er(e)==R};function Wo(e){return null!=e&&Jo(e.length)&&!Yo(e)}function Ho(e){return ea(e)&&Wo(e)}var Ko=mt||gc,Go=_t?Qt(_t):function(e){return ea(e)&&Er(e)==_};function Qo(e){if(!ea(e))return!1;var t=Er(e);return t==v||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!ra(e)}function Yo(e){if(!Zo(e))return!1;var t=Er(e);return t==w||t==b||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Xo(e){return"number"==typeof e&&e==fa(e)}function Jo(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=h}function Zo(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function ea(e){return null!=e&&"object"==typeof e}var ta=vt?Qt(vt):function(e){return ea(e)&&hs(e)==I};function na(e){return"number"==typeof e||ea(e)&&Er(e)==E}function ra(e){if(!ea(e)||Er(e)!=T)return!1;var t=ze(e);if(null===t)return!0;var n=De.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Pe.call(n)==Fe}var ia=wt?Qt(wt):function(e){return ea(e)&&Er(e)==k},sa=bt?Qt(bt):function(e){return ea(e)&&hs(e)==S};function oa(e){return"string"==typeof e||!Bo(e)&&ea(e)&&Er(e)==x}function aa(e){return"symbol"==typeof e||ea(e)&&Er(e)==A}var ca=It?Qt(It):function(e){return ea(e)&&Jo(e.length)&&!!it[Er(e)]},ua=Bi(Lr),la=Bi(function(e,t){return e<=t});function ha(e){if(!e)return[];if(Wo(e))return oa(e)?hn(e):ki(e);if(Qe&&e[Qe])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[Qe]());var t=hs(e);return(t==I?sn:t==S?cn:Va)(e)}function da(e){return e?(e=ga(e))===l||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function fa(e){var t=da(e),n=t%1;return t==t?n?t-n:t:0}function pa(e){return e?sr(fa(e),0,f):0}function ga(e){if("number"==typeof e)return e;if(aa(e))return d;if(Zo(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Zo(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Gt(e);var n=pe.test(e);return n||me.test(e)?ct(e.slice(2),n?2:8):fe.test(e)?d:+e}function ma(e){return Si(e,Ra(e))}function ya(e){return null==e?"":oi(e)}var _a=Ai(function(e,t){if(ws(t)||Wo(t))Si(t,Na(t),e);else for(var n in t)De.call(t,n)&&Zn(e,n,t[n])}),va=Ai(function(e,t){Si(t,Ra(t),e)}),wa=Ai(function(e,t,n,r){Si(t,Ra(t),e,r)}),ba=Ai(function(e,t,n,r){Si(t,Na(t),e,r)}),Ia=Zi(ir),Ea=Kr(function(e,t){e=Te(e);var n=-1,r=t.length,s=r>2?t[2]:i;for(s&&ms(t[0],t[1],s)&&(r=1);++n<r;)for(var o=t[n],a=Ra(o),c=-1,u=a.length;++c<u;){var l=a[c],h=e[l];(h===i||Vo(h,Ne[l])&&!De.call(e,l))&&(e[l]=o[l])}return e}),Ta=Kr(function(e){return e.push(i,Yi),Et(Da,i,e)});function Ca(e,t,n){var r=null==e?i:br(e,t);return r===i?n:r}function ka(e,t){return null!=e&&ds(e,t,kr)}var Sa=Ui(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Me.call(t)),e[t]=n},Za(nc)),xa=Ui(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Me.call(t)),De.call(e,t)?e[t].push(n):e[t]=[n]},ss),Aa=Kr(xr);function Na(e){return Wo(e)?Gn(e):Or(e)}function Ra(e){return Wo(e)?Gn(e,!0):function(e){if(!Zo(e))return function(e){var t=[];if(null!=e)for(var n in Te(e))t.push(n);return t}(e);var t=ws(e),n=[];for(var r in e)("constructor"!=r||!t&&De.call(e,r))&&n.push(r);return n}(e)}var Pa=Ai(function(e,t,n){Vr(e,t,n)}),Da=Ai(function(e,t,n,r){Vr(e,t,n,r)}),Oa=Zi(function(e,t){var n={};if(null==e)return n;var r=!1;t=Rt(t,function(t){return t=mi(t,e),r||(r=t.length>1),t}),Si(e,ts(e),n),r&&(n=or(n,7,Xi));for(var i=t.length;i--;)ci(n,t[i]);return n}),La=Zi(function(e,t){return null==e?{}:function(e,t){return $r(e,t,function(t,n){return ka(e,n)})}(e,t)});function Ma(e,t){if(null==e)return{};var n=Rt(ts(e),function(e){return[e]});return t=ss(t),$r(e,n,function(e,n){return t(e,n[0])})}var Fa=Ki(Na),Ua=Ki(Ra);function Va(e){return null==e?[]:Yt(e,Na(e))}var ja=Di(function(e,t,n){return t=t.toLowerCase(),e+(n?qa(t):t)});function qa(e){return Qa(ya(e).toLowerCase())}function $a(e){return(e=ya(e))&&e.replace(_e,en).replace(Xe,"")}var Ba=Di(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),za=Di(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),Wa=Pi("toLowerCase"),Ha=Di(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}),Ka=Di(function(e,t,n){return e+(n?" ":"")+Qa(t)}),Ga=Di(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Qa=Pi("toUpperCase");function Ya(e,t,n){return e=ya(e),(t=n?i:t)===i?function(e){return tt.test(e)}(e)?function(e){return e.match(Ze)||[]}(e):function(e){return e.match(ce)||[]}(e):e.match(t)||[]}var Xa=Kr(function(e,t){try{return Et(e,i,t)}catch(e){return Qo(e)?e:new be(e)}}),Ja=Zi(function(e,t){return Ct(t,function(t){t=Ls(t),rr(e,t,xo(e[t],e))}),e});function Za(e){return function(){return e}}var ec=Mi(),tc=Mi(!0);function nc(e){return e}function rc(e){return Dr("function"==typeof e?e:or(e,1))}var ic=Kr(function(e,t){return function(n){return xr(n,e,t)}}),sc=Kr(function(e,t){return function(n){return xr(e,n,t)}});function oc(e,t,n){var r=Na(t),i=wr(t,r);null!=n||Zo(t)&&(i.length||!r.length)||(n=t,t=e,e=this,i=wr(t,Na(t)));var s=!(Zo(n)&&"chain"in n&&!n.chain),o=Yo(e);return Ct(i,function(n){var r=t[n];e[n]=r,o&&(e.prototype[n]=function(){var t=this.__chain__;if(s||t){var n=e(this.__wrapped__);return(n.__actions__=ki(this.__actions__)).push({func:r,args:arguments,thisArg:e}),n.__chain__=t,n}return r.apply(e,Pt([this.value()],arguments))})}),e}function ac(){}var cc=ji(Rt),uc=ji(St),lc=ji(Lt);function hc(e){return ys(e)?Bt(Ls(e)):function(e){return function(t){return br(t,e)}}(e)}var dc=$i(),fc=$i(!0);function pc(){return[]}function gc(){return!1}var mc,yc=Vi(function(e,t){return e+t},0),_c=Wi("ceil"),vc=Vi(function(e,t){return e/t},1),wc=Wi("floor"),bc=Vi(function(e,t){return e*t},1),Ic=Wi("round"),Ec=Vi(function(e,t){return e-t},0);return Un.after=function(e,t){if("function"!=typeof t)throw new Se(s);return e=fa(e),function(){if(--e<1)return t.apply(this,arguments)}},Un.ary=ko,Un.assign=_a,Un.assignIn=va,Un.assignInWith=wa,Un.assignWith=ba,Un.at=Ia,Un.before=So,Un.bind=xo,Un.bindAll=Ja,Un.bindKey=Ao,Un.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Bo(e)?e:[e]},Un.chain=lo,Un.chunk=function(e,t,n){t=(n?ms(e,t,n):t===i)?1:mn(fa(t),0);var s=null==e?0:e.length;if(!s||t<1)return[];for(var o=0,a=0,c=r(dt(s/t));o<s;)c[a++]=ei(e,o,o+=t);return c},Un.compact=function(e){for(var t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i},Un.concat=function(){var e=arguments.length;if(!e)return[];for(var t=r(e-1),n=arguments[0],i=e;i--;)t[i-1]=arguments[i];return Pt(Bo(n)?ki(n):[n],gr(t,1))},Un.cond=function(e){var t=null==e?0:e.length,n=ss();return e=t?Rt(e,function(e){if("function"!=typeof e[1])throw new Se(s);return[n(e[0]),e[1]]}):[],Kr(function(n){for(var r=-1;++r<t;){var i=e[r];if(Et(i[0],this,n))return Et(i[1],this,n)}})},Un.conforms=function(e){return function(e){var t=Na(e);return function(n){return ar(n,e,t)}}(or(e,1))},Un.constant=Za,Un.countBy=po,Un.create=function(e,t){var n=Vn(e);return null==t?n:nr(n,t)},Un.curry=function e(t,n,r){var s=Gi(t,8,i,i,i,i,i,n=r?i:n);return s.placeholder=e.placeholder,s},Un.curryRight=function e(t,n,r){var s=Gi(t,16,i,i,i,i,i,n=r?i:n);return s.placeholder=e.placeholder,s},Un.debounce=No,Un.defaults=Ea,Un.defaultsDeep=Ta,Un.defer=Ro,Un.delay=Po,Un.difference=Us,Un.differenceBy=Vs,Un.differenceWith=js,Un.drop=function(e,t,n){var r=null==e?0:e.length;return r?ei(e,(t=n||t===i?1:fa(t))<0?0:t,r):[]},Un.dropRight=function(e,t,n){var r=null==e?0:e.length;return r?ei(e,0,(t=r-(t=n||t===i?1:fa(t)))<0?0:t):[]},Un.dropRightWhile=function(e,t){return e&&e.length?li(e,ss(t,3),!0,!0):[]},Un.dropWhile=function(e,t){return e&&e.length?li(e,ss(t,3),!0):[]},Un.fill=function(e,t,n,r){var s=null==e?0:e.length;return s?(n&&"number"!=typeof n&&ms(e,t,n)&&(n=0,r=s),function(e,t,n,r){var s=e.length;for((n=fa(n))<0&&(n=-n>s?0:s+n),(r=r===i||r>s?s:fa(r))<0&&(r+=s),r=n>r?0:pa(r);n<r;)e[n++]=t;return e}(e,t,n,r)):[]},Un.filter=function(e,t){return(Bo(e)?xt:pr)(e,ss(t,3))},Un.flatMap=function(e,t){return gr(Io(e,t),1)},Un.flatMapDeep=function(e,t){return gr(Io(e,t),l)},Un.flatMapDepth=function(e,t,n){return n=n===i?1:fa(n),gr(Io(e,t),n)},Un.flatten=Bs,Un.flattenDeep=function(e){return null!=e&&e.length?gr(e,l):[]},Un.flattenDepth=function(e,t){return null!=e&&e.length?gr(e,t=t===i?1:fa(t)):[]},Un.flip=function(e){return Gi(e,512)},Un.flow=ec,Un.flowRight=tc,Un.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},Un.functions=function(e){return null==e?[]:wr(e,Na(e))},Un.functionsIn=function(e){return null==e?[]:wr(e,Ra(e))},Un.groupBy=vo,Un.initial=function(e){return null!=e&&e.length?ei(e,0,-1):[]},Un.intersection=Ws,Un.intersectionBy=Hs,Un.intersectionWith=Ks,Un.invert=Sa,Un.invertBy=xa,Un.invokeMap=wo,Un.iteratee=rc,Un.keyBy=bo,Un.keys=Na,Un.keysIn=Ra,Un.map=Io,Un.mapKeys=function(e,t){var n={};return t=ss(t,3),_r(e,function(e,r,i){rr(n,t(e,r,i),e)}),n},Un.mapValues=function(e,t){var n={};return t=ss(t,3),_r(e,function(e,r,i){rr(n,r,t(e,r,i))}),n},Un.matches=function(e){return Fr(or(e,1))},Un.matchesProperty=function(e,t){return Ur(e,or(t,1))},Un.memoize=Do,Un.merge=Pa,Un.mergeWith=Da,Un.method=ic,Un.methodOf=sc,Un.mixin=oc,Un.negate=Oo,Un.nthArg=function(e){return e=fa(e),Kr(function(t){return jr(t,e)})},Un.omit=Oa,Un.omitBy=function(e,t){return Ma(e,Oo(ss(t)))},Un.once=function(e){return So(2,e)},Un.orderBy=function(e,t,n,r){return null==e?[]:(Bo(t)||(t=null==t?[]:[t]),Bo(n=r?i:n)||(n=null==n?[]:[n]),qr(e,t,n))},Un.over=cc,Un.overArgs=Lo,Un.overEvery=uc,Un.overSome=lc,Un.partial=Mo,Un.partialRight=Fo,Un.partition=Eo,Un.pick=La,Un.pickBy=Ma,Un.property=hc,Un.propertyOf=function(e){return function(t){return null==e?i:br(e,t)}},Un.pull=Qs,Un.pullAll=Ys,Un.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?Br(e,t,ss(n,2)):e},Un.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?Br(e,t,i,n):e},Un.pullAt=Xs,Un.range=dc,Un.rangeRight=fc,Un.rearg=Uo,Un.reject=function(e,t){return(Bo(e)?xt:pr)(e,Oo(ss(t,3)))},Un.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,i=[],s=e.length;for(t=ss(t,3);++r<s;){var o=e[r];t(o,r,e)&&(n.push(o),i.push(r))}return zr(e,i),n},Un.rest=function(e,t){if("function"!=typeof e)throw new Se(s);return Kr(e,t=t===i?t:fa(t))},Un.reverse=Js,Un.sampleSize=function(e,t,n){return t=(n?ms(e,t,n):t===i)?1:fa(t),(Bo(e)?Yn:Qr)(e,t)},Un.set=function(e,t,n){return null==e?e:Yr(e,t,n)},Un.setWith=function(e,t,n,r){return r="function"==typeof r?r:i,null==e?e:Yr(e,t,n,r)},Un.shuffle=function(e){return(Bo(e)?Xn:Zr)(e)},Un.slice=function(e,t,n){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&ms(e,t,n)?(t=0,n=r):(t=null==t?0:fa(t),n=n===i?r:fa(n)),ei(e,t,n)):[]},Un.sortBy=To,Un.sortedUniq=function(e){return e&&e.length?ii(e):[]},Un.sortedUniqBy=function(e,t){return e&&e.length?ii(e,ss(t,2)):[]},Un.split=function(e,t,n){return n&&"number"!=typeof n&&ms(e,t,n)&&(t=n=i),(n=n===i?f:n>>>0)?(e=ya(e))&&("string"==typeof t||null!=t&&!ia(t))&&!(t=oi(t))&&rn(e)?_i(hn(e),0,n):e.split(t,n):[]},Un.spread=function(e,t){if("function"!=typeof e)throw new Se(s);return t=null==t?0:mn(fa(t),0),Kr(function(n){var r=n[t],i=_i(n,0,t);return r&&Pt(i,r),Et(e,this,i)})},Un.tail=function(e){var t=null==e?0:e.length;return t?ei(e,1,t):[]},Un.take=function(e,t,n){return e&&e.length?ei(e,0,(t=n||t===i?1:fa(t))<0?0:t):[]},Un.takeRight=function(e,t,n){var r=null==e?0:e.length;return r?ei(e,(t=r-(t=n||t===i?1:fa(t)))<0?0:t,r):[]},Un.takeRightWhile=function(e,t){return e&&e.length?li(e,ss(t,3),!1,!0):[]},Un.takeWhile=function(e,t){return e&&e.length?li(e,ss(t,3)):[]},Un.tap=function(e,t){return t(e),e},Un.throttle=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new Se(s);return Zo(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),No(e,t,{leading:r,maxWait:t,trailing:i})},Un.thru=ho,Un.toArray=ha,Un.toPairs=Fa,Un.toPairsIn=Ua,Un.toPath=function(e){return Bo(e)?Rt(e,Ls):aa(e)?[e]:ki(Os(ya(e)))},Un.toPlainObject=ma,Un.transform=function(e,t,n){var r=Bo(e),i=r||Ko(e)||ca(e);if(t=ss(t,4),null==n){var s=e&&e.constructor;n=i?r?new s:[]:Zo(e)&&Yo(s)?Vn(ze(e)):{}}return(i?Ct:_r)(e,function(e,r,i){return t(n,e,r,i)}),n},Un.unary=function(e){return ko(e,1)},Un.union=Zs,Un.unionBy=eo,Un.unionWith=to,Un.uniq=function(e){return e&&e.length?ai(e):[]},Un.uniqBy=function(e,t){return e&&e.length?ai(e,ss(t,2)):[]},Un.uniqWith=function(e,t){return t="function"==typeof t?t:i,e&&e.length?ai(e,i,t):[]},Un.unset=function(e,t){return null==e||ci(e,t)},Un.unzip=no,Un.unzipWith=ro,Un.update=function(e,t,n){return null==e?e:ui(e,t,gi(n))},Un.updateWith=function(e,t,n,r){return r="function"==typeof r?r:i,null==e?e:ui(e,t,gi(n),r)},Un.values=Va,Un.valuesIn=function(e){return null==e?[]:Yt(e,Ra(e))},Un.without=io,Un.words=Ya,Un.wrap=function(e,t){return Mo(gi(t),e)},Un.xor=so,Un.xorBy=oo,Un.xorWith=ao,Un.zip=co,Un.zipObject=function(e,t){return fi(e||[],t||[],Zn)},Un.zipObjectDeep=function(e,t){return fi(e||[],t||[],Yr)},Un.zipWith=uo,Un.entries=Fa,Un.entriesIn=Ua,Un.extend=va,Un.extendWith=wa,oc(Un,Un),Un.add=yc,Un.attempt=Xa,Un.camelCase=ja,Un.capitalize=qa,Un.ceil=_c,Un.clamp=function(e,t,n){return n===i&&(n=t,t=i),n!==i&&(n=(n=ga(n))==n?n:0),t!==i&&(t=(t=ga(t))==t?t:0),sr(ga(e),t,n)},Un.clone=function(e){return or(e,4)},Un.cloneDeep=function(e){return or(e,5)},Un.cloneDeepWith=function(e,t){return or(e,5,t="function"==typeof t?t:i)},Un.cloneWith=function(e,t){return or(e,4,t="function"==typeof t?t:i)},Un.conformsTo=function(e,t){return null==t||ar(e,t,Na(t))},Un.deburr=$a,Un.defaultTo=function(e,t){return null==e||e!=e?t:e},Un.divide=vc,Un.endsWith=function(e,t,n){e=ya(e),t=oi(t);var r=e.length,s=n=n===i?r:sr(fa(n),0,r);return(n-=t.length)>=0&&e.slice(n,s)==t},Un.eq=Vo,Un.escape=function(e){return(e=ya(e))&&G.test(e)?e.replace(H,tn):e},Un.escapeRegExp=function(e){return(e=ya(e))&&ne.test(e)?e.replace(te,"\\$&"):e},Un.every=function(e,t,n){var r=Bo(e)?St:dr;return n&&ms(e,t,n)&&(t=i),r(e,ss(t,3))},Un.find=go,Un.findIndex=qs,Un.findKey=function(e,t){return Ft(e,ss(t,3),_r)},Un.findLast=mo,Un.findLastIndex=$s,Un.findLastKey=function(e,t){return Ft(e,ss(t,3),vr)},Un.floor=wc,Un.forEach=yo,Un.forEachRight=_o,Un.forIn=function(e,t){return null==e?e:mr(e,ss(t,3),Ra)},Un.forInRight=function(e,t){return null==e?e:yr(e,ss(t,3),Ra)},Un.forOwn=function(e,t){return e&&_r(e,ss(t,3))},Un.forOwnRight=function(e,t){return e&&vr(e,ss(t,3))},Un.get=Ca,Un.gt=jo,Un.gte=qo,Un.has=function(e,t){return null!=e&&ds(e,t,Cr)},Un.hasIn=ka,Un.head=zs,Un.identity=nc,Un.includes=function(e,t,n,r){e=Wo(e)?e:Va(e),n=n&&!r?fa(n):0;var i=e.length;return n<0&&(n=mn(i+n,0)),oa(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Vt(e,t,n)>-1},Un.indexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:fa(n);return i<0&&(i=mn(r+i,0)),Vt(e,t,i)},Un.inRange=function(e,t,n){return t=da(t),n===i?(n=t,t=0):n=da(n),function(e,t,n){return e>=yn(t,n)&&e<mn(t,n)}(e=ga(e),t,n)},Un.invoke=Aa,Un.isArguments=$o,Un.isArray=Bo,Un.isArrayBuffer=zo,Un.isArrayLike=Wo,Un.isArrayLikeObject=Ho,Un.isBoolean=function(e){return!0===e||!1===e||ea(e)&&Er(e)==y},Un.isBuffer=Ko,Un.isDate=Go,Un.isElement=function(e){return ea(e)&&1===e.nodeType&&!ra(e)},Un.isEmpty=function(e){if(null==e)return!0;if(Wo(e)&&(Bo(e)||"string"==typeof e||"function"==typeof e.splice||Ko(e)||ca(e)||$o(e)))return!e.length;var t=hs(e);if(t==I||t==S)return!e.size;if(ws(e))return!Or(e).length;for(var n in e)if(De.call(e,n))return!1;return!0},Un.isEqual=function(e,t){return Nr(e,t)},Un.isEqualWith=function(e,t,n){var r=(n="function"==typeof n?n:i)?n(e,t):i;return r===i?Nr(e,t,i,n):!!r},Un.isError=Qo,Un.isFinite=function(e){return"number"==typeof e&&Mt(e)},Un.isFunction=Yo,Un.isInteger=Xo,Un.isLength=Jo,Un.isMap=ta,Un.isMatch=function(e,t){return e===t||Rr(e,t,as(t))},Un.isMatchWith=function(e,t,n){return n="function"==typeof n?n:i,Rr(e,t,as(t),n)},Un.isNaN=function(e){return na(e)&&e!=+e},Un.isNative=function(e){if(vs(e))throw new be("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Pr(e)},Un.isNil=function(e){return null==e},Un.isNull=function(e){return null===e},Un.isNumber=na,Un.isObject=Zo,Un.isObjectLike=ea,Un.isPlainObject=ra,Un.isRegExp=ia,Un.isSafeInteger=function(e){return Xo(e)&&e>=-9007199254740991&&e<=h},Un.isSet=sa,Un.isString=oa,Un.isSymbol=aa,Un.isTypedArray=ca,Un.isUndefined=function(e){return e===i},Un.isWeakMap=function(e){return ea(e)&&hs(e)==N},Un.isWeakSet=function(e){return ea(e)&&"[object WeakSet]"==Er(e)},Un.join=function(e,t){return null==e?"":zt.call(e,t)},Un.kebabCase=Ba,Un.last=Gs,Un.lastIndexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var s=r;return n!==i&&(s=(s=fa(n))<0?mn(r+s,0):yn(s,r-1)),t==t?function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r}(e,t,s):Ut(e,qt,s,!0)},Un.lowerCase=za,Un.lowerFirst=Wa,Un.lt=ua,Un.lte=la,Un.max=function(e){return e&&e.length?fr(e,nc,Tr):i},Un.maxBy=function(e,t){return e&&e.length?fr(e,ss(t,2),Tr):i},Un.mean=function(e){return $t(e,nc)},Un.meanBy=function(e,t){return $t(e,ss(t,2))},Un.min=function(e){return e&&e.length?fr(e,nc,Lr):i},Un.minBy=function(e,t){return e&&e.length?fr(e,ss(t,2),Lr):i},Un.stubArray=pc,Un.stubFalse=gc,Un.stubObject=function(){return{}},Un.stubString=function(){return""},Un.stubTrue=function(){return!0},Un.multiply=bc,Un.nth=function(e,t){return e&&e.length?jr(e,fa(t)):i},Un.noConflict=function(){return ht._===this&&(ht._=Ue),this},Un.noop=ac,Un.now=Co,Un.pad=function(e,t,n){e=ya(e);var r=(t=fa(t))?ln(e):0;if(!t||r>=t)return e;var i=(t-r)/2;return qi(ft(i),n)+e+qi(dt(i),n)},Un.padEnd=function(e,t,n){e=ya(e);var r=(t=fa(t))?ln(e):0;return t&&r<t?e+qi(t-r,n):e},Un.padStart=function(e,t,n){e=ya(e);var r=(t=fa(t))?ln(e):0;return t&&r<t?qi(t-r,n)+e:e},Un.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),vn(ya(e).replace(re,""),t||0)},Un.random=function(e,t,n){if(n&&"boolean"!=typeof n&&ms(e,t,n)&&(t=n=i),n===i&&("boolean"==typeof t?(n=t,t=i):"boolean"==typeof e&&(n=e,e=i)),e===i&&t===i?(e=0,t=1):(e=da(e),t===i?(t=e,e=0):t=da(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var s=wn();return yn(e+s*(t-e+at("1e-"+((s+"").length-1))),t)}return Wr(e,t)},Un.reduce=function(e,t,n){var r=Bo(e)?Dt:Wt,i=arguments.length<3;return r(e,ss(t,4),n,i,lr)},Un.reduceRight=function(e,t,n){var r=Bo(e)?Ot:Wt,i=arguments.length<3;return r(e,ss(t,4),n,i,hr)},Un.repeat=function(e,t,n){return t=(n?ms(e,t,n):t===i)?1:fa(t),Hr(ya(e),t)},Un.replace=function(){var e=arguments,t=ya(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Un.result=function(e,t,n){var r=-1,s=(t=mi(t,e)).length;for(s||(s=1,e=i);++r<s;){var o=null==e?i:e[Ls(t[r])];o===i&&(r=s,o=n),e=Yo(o)?o.call(e):o}return e},Un.round=Ic,Un.runInContext=e,Un.sample=function(e){return(Bo(e)?Qn:Gr)(e)},Un.size=function(e){if(null==e)return 0;if(Wo(e))return oa(e)?ln(e):e.length;var t=hs(e);return t==I||t==S?e.size:Or(e).length},Un.snakeCase=Ha,Un.some=function(e,t,n){var r=Bo(e)?Lt:ti;return n&&ms(e,t,n)&&(t=i),r(e,ss(t,3))},Un.sortedIndex=function(e,t){return ni(e,t)},Un.sortedIndexBy=function(e,t,n){return ri(e,t,ss(n,2))},Un.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var r=ni(e,t);if(r<n&&Vo(e[r],t))return r}return-1},Un.sortedLastIndex=function(e,t){return ni(e,t,!0)},Un.sortedLastIndexBy=function(e,t,n){return ri(e,t,ss(n,2),!0)},Un.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var n=ni(e,t,!0)-1;if(Vo(e[n],t))return n}return-1},Un.startCase=Ka,Un.startsWith=function(e,t,n){return e=ya(e),n=null==n?0:sr(fa(n),0,e.length),t=oi(t),e.slice(n,n+t.length)==t},Un.subtract=Ec,Un.sum=function(e){return e&&e.length?Ht(e,nc):0},Un.sumBy=function(e,t){return e&&e.length?Ht(e,ss(t,2)):0},Un.template=function(e,t,n){var r=Un.templateSettings;n&&ms(e,t,n)&&(t=i),e=ya(e),t=wa({},t,r,Qi);var s,o,a=wa({},t.imports,r.imports,Qi),c=Na(a),u=Yt(a,c),l=0,h=t.interpolate||ve,d="__p += '",f=Ce((t.escape||ve).source+"|"+h.source+"|"+(h===X?he:ve).source+"|"+(t.evaluate||ve).source+"|$","g"),p="//# sourceURL="+(De.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++rt+"]")+"\n";e.replace(f,function(t,n,r,i,a,c){return r||(r=i),d+=e.slice(l,c).replace(we,nn),n&&(s=!0,d+="' +\n__e("+n+") +\n'"),a&&(o=!0,d+="';\n"+a+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),l=c+t.length,t}),d+="';\n";var g=De.call(t,"variable")&&t.variable;if(g){if(ue.test(g))throw new be("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(o?d.replace($,""):d).replace(B,"$1").replace(z,"$1;"),d="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var m=Xa(function(){return Ie(c,p+"return "+d).apply(i,u)});if(m.source=d,Qo(m))throw m;return m},Un.times=function(e,t){if((e=fa(e))<1||e>h)return[];var n=f,r=yn(e,f);t=ss(t),e-=f;for(var i=Kt(r,t);++n<e;)t(n);return i},Un.toFinite=da,Un.toInteger=fa,Un.toLength=pa,Un.toLower=function(e){return ya(e).toLowerCase()},Un.toNumber=ga,Un.toSafeInteger=function(e){return e?sr(fa(e),-9007199254740991,h):0===e?e:0},Un.toString=ya,Un.toUpper=function(e){return ya(e).toUpperCase()},Un.trim=function(e,t,n){if((e=ya(e))&&(n||t===i))return Gt(e);if(!e||!(t=oi(t)))return e;var r=hn(e),s=hn(t);return _i(r,Jt(r,s),Zt(r,s)+1).join("")},Un.trimEnd=function(e,t,n){if((e=ya(e))&&(n||t===i))return e.slice(0,dn(e)+1);if(!e||!(t=oi(t)))return e;var r=hn(e);return _i(r,0,Zt(r,hn(t))+1).join("")},Un.trimStart=function(e,t,n){if((e=ya(e))&&(n||t===i))return e.replace(re,"");if(!e||!(t=oi(t)))return e;var r=hn(e);return _i(r,Jt(r,hn(t))).join("")},Un.truncate=function(e,t){var n=30,r="...";if(Zo(t)){var s="separator"in t?t.separator:s;n="length"in t?fa(t.length):n,r="omission"in t?oi(t.omission):r}var o=(e=ya(e)).length;if(rn(e)){var a=hn(e);o=a.length}if(n>=o)return e;var c=n-ln(r);if(c<1)return r;var u=a?_i(a,0,c).join(""):e.slice(0,c);if(s===i)return u+r;if(a&&(c+=u.length-c),ia(s)){if(e.slice(c).search(s)){var l,h=u;for(s.global||(s=Ce(s.source,ya(de.exec(s))+"g")),s.lastIndex=0;l=s.exec(h);)var d=l.index;u=u.slice(0,d===i?c:d)}}else if(e.indexOf(oi(s),c)!=c){var f=u.lastIndexOf(s);f>-1&&(u=u.slice(0,f))}return u+r},Un.unescape=function(e){return(e=ya(e))&&K.test(e)?e.replace(W,fn):e},Un.uniqueId=function(e){var t=++Oe;return ya(e)+t},Un.upperCase=Ga,Un.upperFirst=Qa,Un.each=yo,Un.eachRight=_o,Un.first=zs,oc(Un,(mc={},_r(Un,function(e,t){De.call(Un.prototype,t)||(mc[t]=e)}),mc),{chain:!1}),Un.VERSION="4.17.21",Ct(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){Un[e].placeholder=Un}),Ct(["drop","take"],function(e,t){$n.prototype[e]=function(n){n=n===i?1:mn(fa(n),0);var r=this.__filtered__&&!t?new $n(this):this.clone();return r.__filtered__?r.__takeCount__=yn(n,r.__takeCount__):r.__views__.push({size:yn(n,f),type:e+(r.__dir__<0?"Right":"")}),r},$n.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),Ct(["filter","map","takeWhile"],function(e,t){var n=t+1,r=1==n||3==n;$n.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:ss(e,3),type:n}),t.__filtered__=t.__filtered__||r,t}}),Ct(["head","last"],function(e,t){var n="take"+(t?"Right":"");$n.prototype[e]=function(){return this[n](1).value()[0]}}),Ct(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");$n.prototype[e]=function(){return this.__filtered__?new $n(this):this[n](1)}}),$n.prototype.compact=function(){return this.filter(nc)},$n.prototype.find=function(e){return this.filter(e).head()},$n.prototype.findLast=function(e){return this.reverse().find(e)},$n.prototype.invokeMap=Kr(function(e,t){return"function"==typeof e?new $n(this):this.map(function(n){return xr(n,e,t)})}),$n.prototype.reject=function(e){return this.filter(Oo(ss(e)))},$n.prototype.slice=function(e,t){e=fa(e);var n=this;return n.__filtered__&&(e>0||t<0)?new $n(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==i&&(n=(t=fa(t))<0?n.dropRight(-t):n.take(t-e)),n)},$n.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},$n.prototype.toArray=function(){return this.take(f)},_r($n.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),r=/^(?:head|last)$/.test(t),s=Un[r?"take"+("last"==t?"Right":""):t],o=r||/^find/.test(t);s&&(Un.prototype[t]=function(){var t=this.__wrapped__,a=r?[1]:arguments,c=t instanceof $n,u=a[0],l=c||Bo(t),h=function(e){var t=s.apply(Un,Pt([e],a));return r&&d?t[0]:t};l&&n&&"function"==typeof u&&1!=u.length&&(c=l=!1);var d=this.__chain__,f=!!this.__actions__.length,p=o&&!d,g=c&&!f;if(!o&&l){t=g?t:new $n(this);var m=e.apply(t,a);return m.__actions__.push({func:ho,args:[h],thisArg:i}),new qn(m,d)}return p&&g?e.apply(this,a):(m=this.thru(h),p?r?m.value()[0]:m.value():m)})}),Ct(["pop","push","shift","sort","splice","unshift"],function(e){var t=xe[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);Un.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var i=this.value();return t.apply(Bo(i)?i:[],e)}return this[n](function(n){return t.apply(Bo(n)?n:[],e)})}}),_r($n.prototype,function(e,t){var n=Un[t];if(n){var r=n.name+"";De.call(An,r)||(An[r]=[]),An[r].push({name:t,func:n})}}),An[Fi(i,2).name]=[{name:"wrapper",func:i}],$n.prototype.clone=function(){var e=new $n(this.__wrapped__);return e.__actions__=ki(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ki(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ki(this.__views__),e},$n.prototype.reverse=function(){if(this.__filtered__){var e=new $n(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},$n.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=Bo(e),r=t<0,i=n?e.length:0,s=function(e,t,n){for(var r=-1,i=n.length;++r<i;){var s=n[r],o=s.size;switch(s.type){case"drop":e+=o;break;case"dropRight":t-=o;break;case"take":t=yn(t,e+o);break;case"takeRight":e=mn(e,t-o)}}return{start:e,end:t}}(0,i,this.__views__),o=s.start,a=s.end,c=a-o,u=r?a:o-1,l=this.__iteratees__,h=l.length,d=0,f=yn(c,this.__takeCount__);if(!n||!r&&i==c&&f==c)return hi(e,this.__actions__);var p=[];e:for(;c--&&d<f;){for(var g=-1,m=e[u+=t];++g<h;){var y=l[g],_=y.iteratee,v=y.type,w=_(m);if(2==v)m=w;else if(!w){if(1==v)continue e;break e}}p[d++]=m}return p},Un.prototype.at=fo,Un.prototype.chain=function(){return lo(this)},Un.prototype.commit=function(){return new qn(this.value(),this.__chain__)},Un.prototype.next=function(){this.__values__===i&&(this.__values__=ha(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?i:this.__values__[this.__index__++]}},Un.prototype.plant=function(e){for(var t,n=this;n instanceof jn;){var r=Fs(n);r.__index__=0,r.__values__=i,t?s.__wrapped__=r:t=r;var s=r;n=n.__wrapped__}return s.__wrapped__=e,t},Un.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof $n){var t=e;return this.__actions__.length&&(t=new $n(this)),(t=t.reverse()).__actions__.push({func:ho,args:[Js],thisArg:i}),new qn(t,this.__chain__)}return this.thru(Js)},Un.prototype.toJSON=Un.prototype.valueOf=Un.prototype.value=function(){return hi(this.__wrapped__,this.__actions__)},Un.prototype.first=Un.prototype.head,Qe&&(Un.prototype[Qe]=function(){return this}),Un}();ht._=pn,(r=function(){return pn}.call(t,n,t,e))===i||(e.exports=r)}.call(this)}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{"use strict";n(543);const e=function(e,n){if(!e)throw t(n)},t=function(e){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},r=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==o||null==a||null==c)throw new s;const u=i<<2|o>>4;if(r.push(u),64!==a){const e=o<<4&240|a>>2;if(r.push(e),64!==c){const e=a<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class s extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(e){const t=r(e);return i.encodeByteArray(t,!0)},a=function(e){return o(e).replace(/\./g,"")},c=function(e){try{return i.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function u(e){return l(void 0,e)}function l(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&h(n)&&(e[n]=l(e[n],t[n]));return e}function h(e){return"__proto__"!==e}const d=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&c(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},f=e=>{var t,n;return null===(n=null===(t=d())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},p=e=>{const t=f(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},g=()=>{var e;return null===(e=d())||void 0===e?void 0:e.config},m=e=>{var t;return null===(t=d())||void 0===t?void 0:t[`_${e}`]};class y{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function _(e){return e.endsWith(".cloudworkstations.dev")}async function v(e){return(await fetch(e,{credentials:"include"})).ok}function w(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(s)),""].join(".")}const b={};let I=!1;function E(e,t){if("undefined"==typeof window||"undefined"==typeof document||!_(window.location.host)||b[e]===t||b[e]||I)return;function n(e){return`__firebase__banner__${e}`}b[e]=t;const r="__firebase__banner",i=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(b))b[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(r),t=n("text"),s=document.getElementById(t)||document.createElement("span"),o=n("learnmore"),a=document.getElementById(o)||document.createElement("a"),c=n("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(a,o);const n=function(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{I=!0,function(){const e=document.getElementById(r);e&&e.remove()}()},e}();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(u,c),t.append(u,s,a,n),document.body.appendChild(t)}i?(s.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',s.innerText="Preview backend running in this workspace."),s.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function T(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function C(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(T())}function k(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function S(){return!function(){var e;const t=null===(e=d())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class x extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,x.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,A.prototype.create)}}class A{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(N,(e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`})}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new x(r,o,n)}}const N=/\{\$([^}]+)}/g;function R(e){return JSON.parse(e)}function P(e){return JSON.stringify(e)}const D=function(e){let t={},n={},r={},i="";try{const s=e.split(".");t=R(c(s[0])||""),n=R(c(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}};function O(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function L(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function M(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function F(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function U(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(V(n)&&V(s)){if(!U(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function V(e){return null!==e&&"object"==typeof e}function j(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function q(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function $(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class B{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=4294967295&(t<<1|t>>>31)}let r,i,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],u=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(r=c^o&(a^c),i=1518500249):(r=o^a^c,i=1859775393):e<60?(r=o&a|c&(o|a),i=2400959708):(r=o^a^c,i=3395469782);const t=(s<<5|s>>>27)+r+u+i+n[e]&4294967295;u=c,c=a,a=4294967295&(o<<30|o>>>2),o=s,s=t}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+u&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const i=this.buf_;let s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let r=24;r>=0;r-=8)e[n]=this.chain_[t]>>r&255,++n;return e}}class z{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=W),void 0===r.error&&(r.error=W),void 0===r.complete&&(r.complete=W);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function W(){}function H(e,t){return`${e} failed: ${t} argument `}const K=function(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function G(e){return e&&e._delegate?e._delegate:e}class Q{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Y="[DEFAULT]";class X{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new y;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:Y})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=Y){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=Y){return this.instances.has(e)}getOptions(e=Y){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===Y?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=Y){return this.component?this.component.multipleInstances?e:Y:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class J{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new X(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Z=[];var ee;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(ee||(ee={}));const te={debug:ee.DEBUG,verbose:ee.VERBOSE,info:ee.INFO,warn:ee.WARN,error:ee.ERROR,silent:ee.SILENT},ne=ee.INFO,re={[ee.DEBUG]:"log",[ee.VERBOSE]:"log",[ee.INFO]:"info",[ee.WARN]:"warn",[ee.ERROR]:"error"},ie=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=re[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class se{constructor(e){this.name=e,this._logLevel=ne,this._logHandler=ie,this._userLogHandler=null,Z.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ee))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?te[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ee.DEBUG,...e),this._logHandler(this,ee.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ee.VERBOSE,...e),this._logHandler(this,ee.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ee.INFO,...e),this._logHandler(this,ee.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ee.WARN,...e),this._logHandler(this,ee.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ee.ERROR,...e),this._logHandler(this,ee.ERROR,...e)}}let oe,ae;const ce=new WeakMap,ue=new WeakMap,le=new WeakMap,he=new WeakMap,de=new WeakMap;let fe={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return ue.get(e);if("objectStoreNames"===t)return e.objectStoreNames||le.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ge(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function pe(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ae||(ae=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(me(this),e),ge(ce.get(this))}:function(...e){return ge(t.apply(me(this),e))}:function(e,...n){const r=t.call(me(this),e,...n);return le.set(r,e.sort?e.sort():[e]),ge(r)}:(e instanceof IDBTransaction&&function(e){if(ue.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});ue.set(e,t)}(e),n=e,(oe||(oe=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>n instanceof e)?new Proxy(e,fe):e);var t,n}function ge(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(ge(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&ce.set(t,e)}).catch(()=>{}),de.set(t,e),t}(e);if(he.has(e))return he.get(e);const t=pe(e);return t!==e&&(he.set(e,t),de.set(t,e)),t}const me=e=>de.get(e),ye=["get","getKey","getAll","getAllKeys","count"],_e=["put","add","delete","clear"],ve=new Map;function we(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(ve.get(t))return ve.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=_e.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!ye.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return ve.set(t,s),s}var be;be=fe,fe={...be,get:(e,t,n)=>we(e,t)||be.get(e,t,n),has:(e,t)=>!!we(e,t)||be.has(e,t)};class Ie{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const Ee="@firebase/app",Te="0.13.1",Ce=new se("@firebase/app"),ke="@firebase/app-compat",Se="@firebase/analytics-compat",xe="@firebase/analytics",Ae="@firebase/app-check-compat",Ne="@firebase/app-check",Re="@firebase/auth",Pe="@firebase/auth-compat",De="@firebase/database",Oe="@firebase/data-connect",Le="@firebase/database-compat",Me="@firebase/functions",Fe="@firebase/functions-compat",Ue="@firebase/installations",Ve="@firebase/installations-compat",je="@firebase/messaging",qe="@firebase/messaging-compat",$e="@firebase/performance",Be="@firebase/performance-compat",ze="@firebase/remote-config",We="@firebase/remote-config-compat",He="@firebase/storage",Ke="@firebase/storage-compat",Ge="@firebase/firestore",Qe="@firebase/ai",Ye="@firebase/firestore-compat",Xe="firebase",Je="[DEFAULT]",Ze={[Ee]:"fire-core",[ke]:"fire-core-compat",[xe]:"fire-analytics",[Se]:"fire-analytics-compat",[Ne]:"fire-app-check",[Ae]:"fire-app-check-compat",[Re]:"fire-auth",[Pe]:"fire-auth-compat",[De]:"fire-rtdb",[Oe]:"fire-data-connect",[Le]:"fire-rtdb-compat",[Me]:"fire-fn",[Fe]:"fire-fn-compat",[Ue]:"fire-iid",[Ve]:"fire-iid-compat",[je]:"fire-fcm",[qe]:"fire-fcm-compat",[$e]:"fire-perf",[Be]:"fire-perf-compat",[ze]:"fire-rc",[We]:"fire-rc-compat",[He]:"fire-gcs",[Ke]:"fire-gcs-compat",[Ge]:"fire-fst",[Ye]:"fire-fst-compat",[Qe]:"fire-vertex","fire-js":"fire-js",[Xe]:"fire-js-all"},et=new Map,tt=new Map,nt=new Map;function rt(e,t){try{e.container.addComponent(t)}catch(n){Ce.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function it(e){const t=e.name;if(nt.has(t))return Ce.debug(`There were multiple attempts to register component ${t}.`),!1;nt.set(t,e);for(const t of et.values())rt(t,e);for(const t of tt.values())rt(t,e);return!0}function st(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function ot(e){return null!=e&&void 0!==e.settings}const at=new A("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class ct{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Q("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw at.create("app-deleted",{appName:this._name})}}const ut="11.9.0";function lt(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:Je,automaticDataCollectionEnabled:!0},t),i=r.name;if("string"!=typeof i||!i)throw at.create("bad-app-name",{appName:String(i)});if(n||(n=g()),!n)throw at.create("no-options");const s=et.get(i);if(s){if(U(n,s.options)&&U(r,s.config))return s;throw at.create("duplicate-app",{appName:i})}const o=new J(i);for(const e of nt.values())o.addComponent(e);const a=new ct(n,r,o);return et.set(i,a),a}function ht(e=Je){const t=et.get(e);if(!t&&e===Je&&g())return lt();if(!t)throw at.create("no-app",{appName:e});return t}function dt(e,t,n){var r;let i=null!==(r=Ze[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Ce.warn(e.join(" "))}it(new Q(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}const ft="firebase-heartbeat-store";let pt=null;function gt(){return pt||(pt=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=ge(o);return r&&o.addEventListener("upgradeneeded",e=>{r(ge(o.result),e.oldVersion,e.newVersion,ge(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ft)}catch(e){console.warn(e)}}}).catch(e=>{throw at.create("idb-open",{originalErrorMessage:e.message})})),pt}async function mt(e,t){try{const n=(await gt()).transaction(ft,"readwrite"),r=n.objectStore(ft);await r.put(t,yt(e)),await n.done}catch(e){if(e instanceof x)Ce.warn(e.message);else{const t=at.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});Ce.warn(t.message)}}}function yt(e){return`${e.name}!${e.options.appId}`}class _t{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new wt(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=vt();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ce.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=vt(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),bt(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),bt(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=a(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Ce.warn(e),""}}}function vt(){return(new Date).toISOString().substring(0,10)}class wt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await gt()).transaction(ft),n=await t.objectStore(ft).get(yt(e));return await t.done,n}catch(e){if(e instanceof x)Ce.warn(e.message);else{const t=at.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});Ce.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return mt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return mt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function bt(e){return a(JSON.stringify({version:2,heartbeats:e})).length}function It(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}it(new Q("platform-logger",e=>new Ie(e),"PRIVATE")),it(new Q("heartbeat",e=>new _t(e),"PRIVATE")),dt(Ee,Te,""),dt(Ee,Te,"esm2017"),dt("fire-js",""),dt("firebase","11.9.1","app"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const Et=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Tt=new A("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Ct=new se("@firebase/auth");function kt(e,...t){Ct.logLevel<=ee.ERROR&&Ct.error(`Auth (${ut}): ${e}`,...t)}function St(e,...t){throw Rt(e,...t)}function xt(e,...t){return Rt(e,...t)}function At(e,t,n){const r=Object.assign(Object.assign({},Et()),{[t]:n});return new A("auth","Firebase",r).create(t,{appName:e.name})}function Nt(e){return At(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Rt(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return Tt.create(e,...t)}function Pt(e,t,...n){if(!e)throw Rt(t,...n)}function Dt(e){const t="INTERNAL ASSERTION FAILED: "+e;throw kt(t),new Error(t)}function Ot(e,t){e||Dt(t)}function Lt(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Mt(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function Ft(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Mt()||"https:"===Mt()||function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class Ut{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ot(t>e,"Short delay should be less than long delay!"),this.isMobile=C()||k()}get(){return Ft()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Vt(e,t){Ot(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class jt{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Dt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Dt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Dt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const qt={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},$t=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Bt=new Ut(3e4,6e4);function zt(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Wt(e,t,n,r,i={}){return Ht(e,i,async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=j(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:a},i);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),e.emulatorConfig&&_(e.emulatorConfig.host)&&(c.credentials="include"),jt.fetch()(await Gt(e,e.config.apiHost,n,o),c)})}async function Ht(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},qt),t);try{const t=new Yt(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw Xt(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Xt(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw Xt(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw Xt(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw At(e,a,o);St(e,a)}}catch(t){if(t instanceof x)throw t;St(e,"network-request-failed",{message:String(t)})}}async function Kt(e,t,n,r,i={}){const s=await Wt(e,t,n,r,i);return"mfaPendingCredential"in s&&St(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function Gt(e,t,n,r){const i=`${t}${n}?${r}`,s=e,o=s.config.emulator?Vt(e.config,i):`${e.config.apiScheme}://${i}`;return $t.includes(n)&&(await s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType())?s._getPersistence()._getFinalTarget(o).toString():o}function Qt(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Yt{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(xt(this.auth,"network-request-failed")),Bt.get())})}}function Xt(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=xt(e,t,r);return i.customData._tokenResponse=n,i}function Jt(e){return void 0!==e&&void 0!==e.enterprise}class Zt{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Qt(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function en(e,t){return Wt(e,"GET","/v2/recaptchaConfig",zt(e,t))}async function tn(e,t){return Wt(e,"POST","/v1/accounts:lookup",t)}function nn(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function rn(e){return 1e3*Number(e)}function sn(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return kt("JWT malformed, contained fewer than 3 sections"),null;try{const e=c(n);return e?JSON.parse(e):(kt("Failed to decode base64 JWT payload"),null)}catch(e){return kt("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function on(e){const t=sn(e);return Pt(t,"internal-error"),Pt(void 0!==t.exp,"internal-error"),Pt(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function an(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof x&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class cn{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class un{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=nn(this.lastLoginAt),this.creationTime=nn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ln(e){var t;const n=e.auth,r=await e.getIdToken(),i=await an(e,tn(n,{idToken:r}));Pt(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?hn(s.providerUserInfo):[],a=(c=e.providerData,u=o,[...c.filter(e=>!u.some(t=>t.providerId===e.providerId)),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new un(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}function hn(e){return e.map(e=>{var{providerId:t}=e,n=It(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}class dn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Pt(e.idToken,"internal-error"),Pt(void 0!==e.idToken,"internal-error"),Pt(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):on(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Pt(0!==e.length,"internal-error");const t=on(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(Pt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await Ht(e,{},async()=>{const n=j({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=await Gt(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const a={method:"POST",headers:o,body:n};return e.emulatorConfig&&_(e.emulatorConfig.host)&&(a.credentials="include"),jt.fetch()(s,a)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new dn;return n&&(Pt("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(Pt("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(Pt("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new dn,this.toJSON())}_performRefresh(){return Dt("not implemented")}}function fn(e,t){Pt("string"==typeof e||void 0===e,"internal-error",{appName:t})}class pn{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=It(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new cn(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new un(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await an(this,this.stsTokenManager.getToken(this.auth,e));return Pt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=G(e),r=await n.getIdToken(t),i=sn(r);Pt(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:nn(rn(i.auth_time)),issuedAtTime:nn(rn(i.iat)),expirationTime:nn(rn(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=G(e);await ln(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Pt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new pn(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Pt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await ln(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ot(this.auth.app))return Promise.reject(Nt(this.auth));const e=await this.getIdToken();return await an(this,async function(e,t){return Wt(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:_,emailVerified:v,isAnonymous:w,providerData:b,stsTokenManager:I}=t;Pt(_&&I,e,"internal-error");const E=dn.fromJSON(this.name,I);Pt("string"==typeof _,e,"internal-error"),fn(l,e.name),fn(h,e.name),Pt("boolean"==typeof v,e,"internal-error"),Pt("boolean"==typeof w,e,"internal-error"),fn(d,e.name),fn(f,e.name),fn(p,e.name),fn(g,e.name),fn(m,e.name),fn(y,e.name);const T=new pn({uid:_,auth:e,email:h,emailVerified:v,displayName:l,isAnonymous:w,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:m,lastLoginAt:y});return b&&Array.isArray(b)&&(T.providerData=b.map(e=>Object.assign({},e))),g&&(T._redirectEventId=g),T}static async _fromIdTokenResponse(e,t,n=!1){const r=new dn;r.updateFromServerResponse(t);const i=new pn({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await ln(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];Pt(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?hn(r.providerUserInfo):[],s=!(r.email&&r.passwordHash||(null==i?void 0:i.length)),o=new dn;o.updateFromIdToken(n);const a=new pn({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:s}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new un(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash||(null==i?void 0:i.length))};return Object.assign(a,c),a}}const gn=new Map;function mn(e){Ot(e instanceof Function,"Expected a class definition");let t=gn.get(e);return t?(Ot(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,gn.set(e,t),t)}class yn{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}yn.type="NONE";const _n=yn;function vn(e,t,n){return`firebase:${e}:${t}:${n}`}class wn{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=vn(this.userKey,r.apiKey,i),this.fullPersistenceKey=vn("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await tn(this.auth,{idToken:e}).catch(()=>{});return t?pn._fromGetAccountInfoResponse(this.auth,t,e):null}return pn._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new wn(mn(_n),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||mn(_n);const s=vn(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){let r;if("string"==typeof t){const n=await tn(e,{idToken:t}).catch(()=>{});if(!n)break;r=await pn._fromGetAccountInfoResponse(e,n,t)}else r=pn._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}})),new wn(i,e,n)):new wn(i,e,n)}}function bn(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Cn(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(In(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Sn(t))return"Blackberry";if(xn(t))return"Webos";if(En(t))return"Safari";if((t.includes("chrome/")||Tn(t))&&!t.includes("edge/"))return"Chrome";if(kn(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function In(e=T()){return/firefox\//i.test(e)}function En(e=T()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Tn(e=T()){return/crios\//i.test(e)}function Cn(e=T()){return/iemobile/i.test(e)}function kn(e=T()){return/android/i.test(e)}function Sn(e=T()){return/blackberry/i.test(e)}function xn(e=T()){return/webos/i.test(e)}function An(e=T()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Nn(e=T()){return An(e)||kn(e)||xn(e)||Sn(e)||/windows phone/i.test(e)||Cn(e)}function Rn(e,t=[]){let n;switch(e){case"Browser":n=bn(T());break;case"Worker":n=`${bn(T())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${ut}/${r}`}class Pn{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,r)=>{try{n(e(t))}catch(e){r(e)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class Dn{constructor(e){var t,n,r,i;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class On{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Mn(this),this.idTokenSubscription=new Mn(this),this.beforeStateQueue=new Pn(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Tt,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=mn(t)),this._initializationPromise=this.queue(async()=>{var n,r,i;if(!this._deleted&&(this.persistenceManager=await wn.create(this,e),null===(n=this._resolvePersistenceManagerAvailable)||void 0===n||n.call(this),!this._deleted)){if(null===(r=this._popupRedirectResolver)||void 0===r?void 0:r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await tn(this,{idToken:e}),n=await pn._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(ot(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Pt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ln(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ot(this.app))return Promise.reject(Nt(this));const t=e?G(e):null;return t&&Pt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Pt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ot(this.app)?Promise.reject(Nt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ot(this.app)?Promise.reject(Nt(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(mn(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return Wt(e,"GET","/v2/passwordPolicy",zt(e,t))}(this),t=new Dn(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new A("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return Wt(e,"POST","/v2/accounts:revokeToken",zt(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&mn(e)||this._popupRedirectResolver;Pt(t,this,"argument-error"),this.redirectPersistenceManager=await wn.create(this,[mn(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Pt(o,this,"internal-error"),o.then(()=>{s||i(this.currentUser)}),"function"==typeof t){const i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Pt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Rn(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;if(ot(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){Ct.logLevel<=ee.WARN&&Ct.warn(`Auth (${ut}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function Ln(e){return G(e)}class Mn{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e){const t=new z(e,void 0);return t.subscribe.bind(t)}(e=>this.observer=e)}get next(){return Pt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Fn={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Un(e){return Fn.loadJS(e)}function Vn(e){return`__${e}${Math.floor(1e6*Math.random())}`}class jn{constructor(){this.enterprise=new qn}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class qn{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const $n="NO_RECAPTCHA";class Bn{constructor(e){this.type="recaptcha-enterprise",this.auth=Ln(e)}async verify(e="verify",t=!1){function n(t,n,r){const i=window.grecaptcha;Jt(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n($n)})}):r(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new jn).execute("siteKey",{action:"verify"}):new Promise((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{en(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const n=new Zt(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(i=>{if(!t&&Jt(window.grecaptcha))n(i,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=Fn.recaptchaEnterpriseScript;0!==t.length&&(t+=i),Un(t).then(()=>{n(i,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function zn(e,t,n,r=!1,i=!1){const s=new Bn(e);let o;if(i)o=$n;else try{o=await s.verify(n)}catch(e){o=await s.verify(n,!0)}const a=Object.assign({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Wn(e,t,n,r,i){var s,o;if("EMAIL_PASSWORD_PROVIDER"===i){if(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await zn(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch(async i=>{if("auth/missing-recaptcha-token"===i.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const i=await zn(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)})}if("PHONE_PROVIDER"===i){if(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("PHONE_PROVIDER")){const i=await zn(e,t,n);return r(e,i).catch(async i=>{var s;if("AUDIT"===(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const i=await zn(e,t,n,!1,!0);return r(e,i)}return Promise.reject(i)})}{const i=await zn(e,t,n,!1,!0);return r(e,i)}}return Promise.reject(i+" provider is not supported.")}function Hn(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Kn(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Gn{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Dt("not implemented")}_getIdTokenResponse(e){return Dt("not implemented")}_linkToIdToken(e,t){return Dt("not implemented")}_getReauthenticationResolver(e){return Dt("not implemented")}}async function Qn(e,t){return Wt(e,"POST","/v1/accounts:signUp",t)}async function Yn(e,t){return Kt(e,"POST","/v1/accounts:signInWithPassword",zt(e,t))}class Xn extends Gn{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Xn(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Xn(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Wn(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Yn,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Kt(e,"POST","/v1/accounts:signInWithEmailLink",zt(e,t))}(e,{email:this._email,oobCode:this._password});default:St(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Wn(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Qn,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Kt(e,"POST","/v1/accounts:signInWithEmailLink",zt(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:St(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Jn(e,t){return Kt(e,"POST","/v1/accounts:signInWithIdp",zt(e,t))}class Zn extends Gn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Zn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):St("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=It(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new Zn(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return Jn(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Jn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Jn(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=j(t)}return e}}async function er(e,t){return Wt(e,"POST","/v1/accounts:sendVerificationCode",zt(e,t))}const tr={USER_NOT_FOUND:"user-not-found"};class nr extends Gn{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new nr({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new nr({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Kt(e,"POST","/v1/accounts:signInWithPhoneNumber",zt(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Kt(e,"POST","/v1/accounts:signInWithPhoneNumber",zt(e,t));if(n.temporaryProof)throw Xt(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Kt(e,"POST","/v1/accounts:signInWithPhoneNumber",zt(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),tr)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new nr({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class rr{constructor(e){var t,n,r,i,s,o;const a=q($(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);Pt(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.lang)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=q($(e)).link,n=t?q($(t)).deep_link_id:null,r=q($(e)).deep_link_id;return(r?q($(r)).link:null)||r||n||t||e}(e);try{return new rr(t)}catch(e){return null}}}class ir{constructor(){this.providerId=ir.PROVIDER_ID}static credential(e,t){return Xn._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=rr.parseLink(t);return Pt(n,"argument-error"),Xn._fromEmailAndCode(e,n.code,n.tenantId)}}ir.PROVIDER_ID="password",ir.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ir.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class sr{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class or extends sr{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ar extends or{constructor(){super("facebook.com")}static credential(e){return Zn._fromParams({providerId:ar.PROVIDER_ID,signInMethod:ar.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ar.credentialFromTaggedObject(e)}static credentialFromError(e){return ar.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return ar.credential(e.oauthAccessToken)}catch(e){return null}}}ar.FACEBOOK_SIGN_IN_METHOD="facebook.com",ar.PROVIDER_ID="facebook.com";class cr extends or{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Zn._fromParams({providerId:cr.PROVIDER_ID,signInMethod:cr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return cr.credentialFromTaggedObject(e)}static credentialFromError(e){return cr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return cr.credential(t,n)}catch(e){return null}}}cr.GOOGLE_SIGN_IN_METHOD="google.com",cr.PROVIDER_ID="google.com";class ur extends or{constructor(){super("github.com")}static credential(e){return Zn._fromParams({providerId:ur.PROVIDER_ID,signInMethod:ur.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ur.credentialFromTaggedObject(e)}static credentialFromError(e){return ur.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return ur.credential(e.oauthAccessToken)}catch(e){return null}}}ur.GITHUB_SIGN_IN_METHOD="github.com",ur.PROVIDER_ID="github.com";class lr extends or{constructor(){super("twitter.com")}static credential(e,t){return Zn._fromParams({providerId:lr.PROVIDER_ID,signInMethod:lr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return lr.credentialFromTaggedObject(e)}static credentialFromError(e){return lr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return lr.credential(t,n)}catch(e){return null}}}async function hr(e,t){return Kt(e,"POST","/v1/accounts:signUp",zt(e,t))}lr.TWITTER_SIGN_IN_METHOD="twitter.com",lr.PROVIDER_ID="twitter.com";class dr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await pn._fromIdTokenResponse(e,n,r),s=fr(n);return new dr({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=fr(n);return new dr({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function fr(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class pr extends x{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,pr.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new pr(e,t,n,r)}}function gr(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw pr._fromErrorAndOperation(e,n,t,r);throw n})}async function mr(e,t,n=!1){if(ot(e.app))return Promise.reject(Nt(e));const r="signIn",i=await gr(e,r,t),s=await dr._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function yr(e){const t=Ln(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}function _r(e,t){return Wt(e,"POST","/v2/accounts/mfaEnrollment:start",zt(e,t))}new WeakMap;const vr="__sak";class wr{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(vr,"1"),this.storage.removeItem(vr),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class br extends wr{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Nn(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);!function(){const e=T();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||i===e.newValue||e.newValue===e.oldValue?r():setTimeout(r,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}br.type="LOCAL";const Ir=br;class Er extends wr{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Er.type="SESSION";const Tr=Er;class Cr{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new Cr(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map(async e=>e(t.origin,i)),a=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}}))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function kr(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Cr.receivers=[];class Sr{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise((o,a)=>{const c=kr("",20);r.port1.start();const u=setTimeout(()=>{a(new Error("unsupported_event"))},n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})}}function xr(){return window}function Ar(){return void 0!==xr().WorkerGlobalScope&&"function"==typeof xr().importScripts}const Nr="firebaseLocalStorageDb",Rr="firebaseLocalStorage",Pr="fbase_key";class Dr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Or(e,t){return e.transaction([Rr],t?"readwrite":"readonly").objectStore(Rr)}function Lr(){const e=indexedDB.open(Nr,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(Rr,{keyPath:Pr})}catch(e){n(e)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(Rr)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Nr);return new Dr(e).toPromise()}(),t(await Lr()))})})}async function Mr(e,t,n){const r=Or(e,!0).put({[Pr]:t,value:n});return new Dr(r).toPromise()}function Fr(e,t){const n=Or(e,!0).delete(t);return new Dr(n).toPromise()}class Ur{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Lr()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ar()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Cr._getInstance(Ar()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Sr(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Lr();return await Mr(e,vr,"1"),await Fr(e,vr),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>Mr(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=Or(e,!1).get(t),r=await new Dr(n).toPromise();return void 0===r?null:r.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Fr(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=Or(e,!1).getAll();return new Dr(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Ur.type="LOCAL";const Vr=Ur;function jr(e,t){return Wt(e,"POST","/v2/accounts/mfaSignIn:start",zt(e,t))}Vn("rcb"),new Ut(3e4,6e4);const qr="recaptcha";async function $r(e,t,n){var r;if(!e._getRecaptchaConfig())try{await async function(e){const t=Ln(e),n=await en(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new Zt(n);null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()&&new Bn(t).verify()}(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"==typeof t?{phoneNumber:t}:t,"session"in i){const t=i.session;if("phoneNumber"in i){Pt("enroll"===t.type,e,"internal-error");const r=Wn(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},"mfaSmsEnrollment",async(e,t)=>t.phoneEnrollmentInfo.captchaResponse===$n?(Pt((null==n?void 0:n.type)===qr,e,"argument-error"),_r(e,await Br(e,t,n))):_r(e,t),"PHONE_PROVIDER"),s=await r.catch(e=>Promise.reject(e));return s.phoneSessionInfo.sessionInfo}{Pt("signin"===t.type,e,"internal-error");const s=(null===(r=i.multiFactorHint)||void 0===r?void 0:r.uid)||i.multiFactorUid;Pt(s,e,"missing-multi-factor-info");const o=Wn(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},"mfaSmsSignIn",async(e,t)=>t.phoneSignInInfo.captchaResponse===$n?(Pt((null==n?void 0:n.type)===qr,e,"argument-error"),jr(e,await Br(e,t,n))):jr(e,t),"PHONE_PROVIDER"),a=await o.catch(e=>Promise.reject(e));return a.phoneResponseInfo.sessionInfo}}{const t=Wn(e,{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},"sendVerificationCode",async(e,t)=>t.captchaResponse===$n?(Pt((null==n?void 0:n.type)===qr,e,"argument-error"),er(e,await Br(e,t,n))):er(e,t),"PHONE_PROVIDER"),r=await t.catch(e=>Promise.reject(e));return r.sessionInfo}}finally{null==n||n._reset()}}async function Br(e,t,n){Pt(n.type===qr,e,"argument-error");const r=await n.verify();Pt("string"==typeof r,e,"argument-error");const i=Object.assign({},t);if("phoneEnrollmentInfo"in i){const e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,n=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:s}}),i}if("phoneSignInInfo"in i){const e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,n=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),i}return Object.assign(i,{recaptchaToken:r}),i}class zr{constructor(e){this.providerId=zr.PROVIDER_ID,this.auth=Ln(e)}verifyPhoneNumber(e,t){return $r(this.auth,e,G(t))}static credential(e,t){return nr._fromVerification(e,t)}static credentialFromResult(e){const t=e;return zr.credentialFromTaggedObject(t)}static credentialFromError(e){return zr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?nr._fromTokenResponse(t,n):null}}zr.PROVIDER_ID="phone",zr.PHONE_SIGN_IN_METHOD="phone";class Wr extends Gn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Jn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Jn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Jn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Hr(e){return mr(e.auth,new Wr(e),e.bypassAuthState)}function Kr(e){const{auth:t,user:n}=e;return Pt(n,t,"internal-error"),async function(e,t,n=!1){const{auth:r}=e;if(ot(r.app))return Promise.reject(Nt(r));const i="reauthenticate";try{const s=await an(e,gr(r,i,t,e),n);Pt(s.idToken,r,"internal-error");const o=sn(s.idToken);Pt(o,r,"internal-error");const{sub:a}=o;return Pt(e.uid===a,r,"user-mismatch"),dr._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&St(r,"user-mismatch"),e}}(n,new Wr(e),e.bypassAuthState)}async function Gr(e){const{auth:t,user:n}=e;return Pt(n,t,"internal-error"),async function(e,t,n=!1){const r=await an(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return dr._forOperation(e,"link",r)}(n,new Wr(e),e.bypassAuthState)}class Qr{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Hr;case"linkViaPopup":case"linkViaRedirect":return Gr;case"reauthViaPopup":case"reauthViaRedirect":return Kr;default:St(this.auth,"internal-error")}}resolve(e){Ot(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ot(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Yr=new Ut(2e3,1e4);class Xr extends Qr{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Xr.currentPopupAction&&Xr.currentPopupAction.cancel(),Xr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Pt(e,this.auth,"internal-error"),e}async onExecution(){Ot(1===this.filter.length,"Popup operations only handle one event");const e=kr();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(xt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(xt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Xr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(xt(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Yr.get())};e()}}Xr.currentPopupAction=null;const Jr=new Map;class Zr extends Qr{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Jr.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return vn("pendingRedirect",e.config.apiKey,e.name)}(t),r=function(e){return mn(e._redirectPersistence)}(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Jr.set(this.auth._key(),e)}return this.bypassAuthState||Jr.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function ei(e,t){Jr.set(e._key(),t)}async function ti(e,t,n=!1){if(ot(e.app))return Promise.reject(Nt(e));const r=Ln(e),i=function(e,t){return t?mn(t):(Pt(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(r,t),s=new Zr(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class ni{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ii(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!ii(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(xt(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(ri(e))}saveEventToCache(e){this.cachedEventUids.add(ri(e)),this.lastProcessedEventTime=Date.now()}}function ri(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function ii({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const si=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,oi=/^https?/;function ai(e){const t=Lt(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!oi.test(n))return!1;if(si.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const ci=new Ut(3e4,6e4);function ui(){const e=xr().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}function li(e){return new Promise((t,n)=>{var r,i,s;function o(){ui(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{ui(),n(xt(e,"network-request-failed"))},timeout:ci.get()})}if(null===(i=null===(r=xr().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=xr().gapi)||void 0===s?void 0:s.load)){const t=Vn("iframefcb");return xr()[t]=()=>{gapi.load?o():n(xt(e,"network-request-failed"))},Un(`${Fn.gapiScript}?onload=${t}`).catch(e=>n(e))}o()}}).catch(e=>{throw hi=null,e})}let hi=null;const di=new Ut(5e3,15e3),fi={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},pi=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function gi(e){const t=e.config;Pt(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Vt(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:ut},i=pi.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${j(r).slice(1)}`}const mi={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class yi{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const _i=encodeURIComponent("fac");async function vi(e,t,n,r,i,s){Pt(e.config.authDomain,e,"auth-domain-config-required"),Pt(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:ut,eventId:i};if(t instanceof sr){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",M(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof or){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),u=c?`#${_i}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?Vt(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${j(a).slice(1)}${u}`}const wi="webStorageSupport",bi=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Tr,this._completeRedirectFn=ti,this._overrideRedirectResult=ei}async _openPopup(e,t,n,r){var i;return Ot(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},mi),{width:r.toString(),height:i.toString(),top:s,left:o}),u=T().toLowerCase();n&&(a=Tn(u)?"_blank":n),In(u)&&(t=t||"http://localhost",c.scrollbars="yes");const l=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=T()){var t;return An(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new yi(null);const h=window.open(t||"",a,l);Pt(h,e,"popup-blocked");try{h.focus()}catch(e){}return new yi(h)}(e,await vi(e,t,n,Lt(),r),kr())}async _openRedirect(e,t,n,r){return await this._originValidation(e),i=await vi(e,t,n,Lt(),r),xr().location.href=i,new Promise(()=>{});var i}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Ot(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return hi=hi||li(e),hi}(e),n=xr().gapi;return Pt(n,e,"internal-error"),t.open({where:document.body,url:gi(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:fi,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=xt(e,"network-request-failed"),s=xr().setTimeout(()=>{r(i)},di.get());function o(){xr().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{r(i)})}))}(e),n=new ni(e);return t.register("authEvent",t=>(Pt(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(wi,{type:wi},n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[wi];void 0!==i&&t(!!i),St(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return Wt(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(ai(e))return}catch(e){}St(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Nn()||En()||An()}};var Ii="@firebase/auth",Ei="1.10.7";class Ti{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Pt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Ci=m("authIdTokenMaxAge")||300;let ki=null;var Si,xi;Si={loadJS:e=>new Promise((t,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=xt("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Fn=Si,xi="Browser",it(new Q("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;Pt(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:xi,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Rn(xi)},c=new On(n,r,i,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(mn);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),it(new Q("auth-internal",e=>{return t=Ln(e.getProvider("auth").getImmediate()),new Ti(t);var t},"PRIVATE").setInstantiationMode("EXPLICIT")),dt(Ii,Ei,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(xi)),dt(Ii,Ei,"esm2017");var Ai,Ni,Ri="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Pi={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function r(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}(t,function(){this.blockSize=-1}),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,i=this.B,s=this.h,o=0;o<t;){if(0==s)for(;o<=r;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(i[s++]=e.charCodeAt(o++),s==this.blockSize){n(this,i),s=0;break}}else for(;o<t;)if(i[s++]=e[o++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var i={};function s(e){return-128<=e&&128>e?function(e){var t=i;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new r([0|e],0>e?-1:0)}(e)}(e):new r([0|e],0>e?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(0>e)return d(o(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=4294967296;return new r(t,0)}var a=s(0),c=s(1),u=s(16777216);function l(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function h(e){return-1==e.h}function d(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new r(n,~e.h).add(c)}function f(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function g(e,t){this.g=e,this.h=t}function m(e,t){if(l(t))throw Error("division by zero");if(l(e))return new g(a,a);if(h(e))return t=m(d(e),t),new g(d(t.g),d(t.h));if(h(t))return t=m(e,d(t)),new g(d(t.g),t.h);if(30<e.g.length){if(h(e)||h(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=t;0>=r.l(e);)n=y(n),r=y(r);var i=_(n,1),s=_(r,1);for(r=_(r,2),n=_(n,2);!l(r);){var u=s.add(r);0>=u.l(e)&&(i=i.add(n),s=u),r=_(r,1),n=_(n,1)}return t=f(e,i.j(t)),new g(i,t)}for(i=a;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),u=(s=o(n)).j(t);h(u)||0<u.l(e);)u=(s=o(n-=r)).j(t);l(s)&&(s=c),i=i.add(s),e=f(e,u)}return new g(i,e)}function y(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new r(n,e.h)}function _(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,s=[],o=0;o<i;o++)s[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new r(s,e.h)}(e=r.prototype).m=function(){if(h(this))return-d(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(l(this))return"0";if(h(this))return"-"+d(this).toString(e);for(var t=o(Math.pow(e,6)),n=this,r="";;){var i=m(n,t).g,s=((0<(n=f(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(l(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return h(e=f(this,e))?-1:l(e)?0:1},e.abs=function(){return h(this)?d(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,s=0;s<=t;s++){var o=i+(65535&this.i(s))+(65535&e.i(s)),a=(o>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);i=a>>>16,o&=65535,a&=65535,n[s]=a<<16|o}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(l(this)||l(e))return a;if(h(this))return h(e)?d(this).j(d(e)):d(d(this).j(e));if(h(e))return d(this.j(d(e)));if(0>this.l(u)&&0>e.l(u))return o(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<e.g.length;s++){var c=this.i(i)>>>16,f=65535&this.i(i),g=e.i(s)>>>16,m=65535&e.i(s);n[2*i+2*s]+=f*m,p(n,2*i+2*s),n[2*i+2*s+1]+=c*m,p(n,2*i+2*s+1),n[2*i+2*s+1]+=f*g,p(n,2*i+2*s+1),n[2*i+2*s+2]+=c*g,p(n,2*i+2*s+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new r(n,0)},e.A=function(e){return m(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new r(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new r(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,Ni=Pi.Md5=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=o(Math.pow(n,8)),i=a,s=0;s<t.length;s+=8){var c=Math.min(8,t.length-s),u=parseInt(t.substring(s,s+c),n);8>c?(c=o(Math.pow(n,c)),i=i.j(c).add(o(u))):i=(i=i.j(r)).add(o(u))}return i},Ai=Pi.Integer=r}).apply(void 0!==Ri?Ri:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Di,Oi,Li,Mi,Fi,Ui,Vi,ji,qi="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},$i={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof qi&&qi];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in i))break e;i=i[o]}(r=r(s=i[e=e[e.length-1]]))!=s&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(0,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,function(e,t){return t})}});var r=r||{},i=this||self;function s(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function u(e,t,n){return(u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function l(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function h(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function d(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function f(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(s(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function p(e){return/^[\s\xa0]*$/.test(e)}function g(){var e=i.navigator;return e&&(e=e.userAgent)?e:""}function m(e){return m[" "](e),e}m[" "]=function(){};var y=!(-1==g().indexOf("Gecko")||-1!=g().toLowerCase().indexOf("webkit")&&-1==g().indexOf("Edge")||-1!=g().indexOf("Trident")||-1!=g().indexOf("MSIE")||-1!=g().indexOf("Edge"));function _(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function v(e){const t={};for(const n in e)t[n]=e[n];return t}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<w.length;t++)n=w[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function I(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function E(e){i.setTimeout(()=>{throw e},0)}function T(){var e=A;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var C=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new k,e=>e.reset());class k{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let S,x=!1,A=new class{constructor(){this.h=this.g=null}add(e,t){const n=C.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},N=()=>{const e=i.Promise.resolve(void 0);S=()=>{e.then(R)}};var R=()=>{for(var e;e=T();){try{e.h.call(e.g)}catch(e){E(e)}var t=C;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}x=!1};function P(){this.s=this.s,this.C=this.C}function D(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}P.prototype.s=!1,P.prototype.ma=function(){this.s||(this.s=!0,this.N())},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},D.prototype.h=function(){this.defaultPrevented=!0};var O=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(e){}return e}();function L(e,t){if(D.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(y){e:{try{m(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:M[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&L.aa.h.call(this)}}h(L,D);var M={2:"touch",3:"pen",4:"mouse"};L.prototype.h=function(){L.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var F="closure_listenable_"+(1e6*Math.random()|0),U=0;function V(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++U,this.da=this.fa=!1}function j(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function q(e){this.src=e,this.g={},this.h=0}function $(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(j(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function B(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}q.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=B(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new V(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var z="closure_lm_"+(1e6*Math.random()|0),W={};function H(e,t,n,r,i){if(r&&r.once)return G(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)H(e,t[s],n,r,i);return null}return n=te(n),e&&e[F]?e.K(t,n,o(r)?!!r.capture:!!r,i):K(e,t,n,!1,r,i)}function K(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=o(i)?!!i.capture:!!i,c=Z(e);if(c||(e[z]=c=new q(e)),(n=c.add(t,n,r,a,s)).proxy)return n;if(r=function(){const e=J;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)O||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(X(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function G(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)G(e,t[s],n,r,i);return null}return n=te(n),e&&e[F]?e.L(t,n,o(r)?!!r.capture:!!r,i):K(e,t,n,!0,r,i)}function Q(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Q(e,t[s],n,r,i);else r=o(r)?!!r.capture:!!r,n=te(n),e&&e[F]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=B(s=e.g[t],n,r,i))&&(j(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=Z(e))&&(t=e.g[t.toString()],e=-1,t&&(e=B(t,n,r,i)),(n=-1<e?t[e]:null)&&Y(n))}function Y(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[F])$(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(X(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Z(t))?($(n,e),0==n.h&&(n.src=null,t[z]=null)):j(e)}}}function X(e){return e in W?W[e]:W[e]="on"+e}function J(e,t){if(e.da)e=!0;else{t=new L(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&Y(e),e=n.call(r,t)}return e}function Z(e){return(e=e[z])instanceof q?e:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(e){return"function"==typeof e?e:(e[ee]||(e[ee]=function(t){return e.handleEvent(t)}),e[ee])}function ne(){P.call(this),this.i=new q(this),this.M=this,this.F=null}function re(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new D(t,e);else if(t instanceof D)t.target=t.target||e;else{var i=t;b(t=new D(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=ie(o,r,!0,t)&&i}if(i=ie(o=t.g=e,r,!0,t)&&i,i=ie(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=ie(o=t.g=n[s],r,!1,t)&&i}function ie(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&$(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}function se(e,t,n){if("function"==typeof e)n&&(e=u(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=u(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}function oe(e){e.g=se(()=>{e.g=null,e.i&&(e.i=!1,oe(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}h(ne,P),ne.prototype[F]=!0,ne.prototype.removeEventListener=function(e,t,n,r){Q(this,e,t,n,r)},ne.prototype.N=function(){if(ne.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)j(n[r]);delete t.g[e],t.h--}}this.F=null},ne.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ne.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ae extends P{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:oe(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ce(e){P.call(this),this.h=e,this.g={}}h(ce,P);var ue=[];function le(e){_(e.g,function(e,t){this.g.hasOwnProperty(t)&&Y(e)},e),e.g={}}ce.prototype.N=function(){ce.aa.N.call(this),le(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var he=i.JSON.stringify,de=i.JSON.parse,fe=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function pe(){}function ge(e){return e.h||(e.h=e.i())}function me(){}pe.prototype.h=null;var ye={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function _e(){D.call(this,"d")}function ve(){D.call(this,"c")}h(_e,D),h(ve,D);var we={},be=null;function Ie(){return be=be||new ne}function Ee(e){D.call(this,we.La,e)}function Te(e){const t=Ie();re(t,new Ee(t))}function Ce(e,t){D.call(this,we.STAT_EVENT,e),this.stat=t}function ke(e){const t=Ie();re(t,new Ce(t,e))}function Se(e,t){D.call(this,we.Ma,e),this.size=t}function xe(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){e()},t)}function Ae(){this.g=!0}function Ne(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return he(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}we.La="serverreachability",h(Ee,D),we.STAT_EVENT="statevent",h(Ce,D),we.Ma="timingevent",h(Se,D),Ae.prototype.xa=function(){this.g=!1},Ae.prototype.info=function(){};var Re,Pe={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},De={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Oe(){}function Le(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new ce(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Me}function Me(){this.i=null,this.g="",this.h=!1}h(Oe,pe),Oe.prototype.g=function(){return new XMLHttpRequest},Oe.prototype.i=function(){return{}},Re=new Oe;var Fe={},Ue={};function Ve(e,t,n){e.L=1,e.v=ht(ot(t)),e.m=n,e.P=!0,je(e,null)}function je(e,t){e.F=Date.now(),Be(e),e.A=ot(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),Ct(n.i,"t",r),e.C=0,n=e.j.J,e.h=new Me,e.g=fn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new ae(u(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(ue[0]=i.toString()),i=ue);for(var s=0;s<i.length;s++){var o=H(n,i[s],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?v(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Te(),function(e,t,n,r,i,s){e.info(function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o})}(e.i,e.u,e.A,e.l,e.R,e.m)}function qe(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function $e(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Ue:(n=Number(t.substring(n,r)),isNaN(n)?Fe:(r+=1)+n>t.length?Ue:(t=t.slice(r,r+n),e.C=r+n,t))}function Be(e){e.S=Date.now()+e.I,ze(e,e.I)}function ze(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=xe(u(e.ba,e),t)}function We(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function He(e){0==e.j.G||e.J||cn(e.j,e)}function Ke(e){We(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,le(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function Ge(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||Ze(n.h,e)))if(!e.K&&Ze(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;an(n),Yt(n)}rn(n),ke(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=xe(u(n.Za,n),6e3));if(1>=Je(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else ln(n,11)}else if((e.K||n.g==e)&&an(n),!p(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.K=u[1],n.ia=u[2];const t=u[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=u[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(et(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,lt(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=e;if((r=n).qa=dn(r,r.J?r.ia:null,r.W),o.K){tt(r.h,o);var a=o,c=r.L;c&&(a.I=c),a.B&&(We(a),Be(a)),r.g=o}else nn(r);0<n.i.length&&Jt(n)}else"stop"!=u[0]&&"close"!=u[0]||ln(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?ln(n,7):Qt(n):"noop"!=u[0]&&n.l&&n.l.ta(u),n.v=0)}Te()}catch(e){}}Le.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Wt(e)?t.j():this.Y(e)},Le.prototype.Y=function(e){try{if(e==this.g)e:{const d=Wt(this.g);var t=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||Ht(this.g)))){this.J||4!=d||7==t||Te(),We(this);var n=this.g.Z();this.X=n;t:if(qe(this)){var r=Ht(this.g);e="";var s=r.length,o=4==Wt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ke(this),He(this);var a="";break t}this.h.i=new i.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(o&&t==s-1)});r.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(e,t,n,r,i,s,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o})}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(c)){var l=c;break t}}l=null}if(!(n=l)){this.o=!1,this.s=3,ke(12),Ke(this),He(this);break e}Ne(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ge(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;){if(e=$e(this,a),e==Ue){4==d&&(this.s=4,ke(14),n=!1),Ne(this.i,this.l,null,"[Incomplete Response]");break}if(e==Fe){this.s=4,ke(15),Ne(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}Ne(this.i,this.l,e,null),Ge(this,e)}if(qe(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,ke(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),sn(h),h.M=!0,ke(11))}}else Ne(this.i,this.l,a,"[Invalid Chunked Response]"),Ke(this),He(this)}else Ne(this.i,this.l,a,null),Ge(this,a);4==d&&Ke(this),this.o&&!this.J&&(4==d?cn(this.j,this):(this.o=!1,Be(this)))}else(function(e){const t={};e=(e.g&&2<=Wt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(p(e[r]))continue;var n=I(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,ke(12)):(this.s=0,ke(13)),Ke(this),He(this)}}}catch(e){}},Le.prototype.cancel=function(){this.J=!0,Ke(this)},Le.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(Te(),ke(17)),Ke(this),this.s=2,He(this)):ze(this,this.S-e)};var Qe=class{constructor(e,t){this.g=e,this.map=t}};function Ye(e){this.l=e||10,e=i.PerformanceNavigationTiming?0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Xe(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Je(e){return e.h?1:e.g?e.g.size:0}function Ze(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function et(e,t){e.g?e.g.add(t):e.h=t}function tt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function nt(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return d(e.i)}function rt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(s(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(s(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(s(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}Ye.prototype.cancel=function(){if(this.i=nt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var it=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function st(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof st){this.h=e.h,at(this,e.j),this.o=e.o,this.g=e.g,ct(this,e.s),this.l=e.l;var t=e.i,n=new bt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),ut(this,n),this.m=e.m}else e&&(t=String(e).match(it))?(this.h=!1,at(this,t[1]||"",!0),this.o=dt(t[2]||""),this.g=dt(t[3]||"",!0),ct(this,t[4]),this.l=dt(t[5]||"",!0),ut(this,t[6]||"",!0),this.m=dt(t[7]||"")):(this.h=!1,this.i=new bt(null,this.h))}function ot(e){return new st(e)}function at(e,t,n){e.j=n?dt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ct(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function ut(e,t,n){t instanceof bt?(e.i=t,function(e,t){t&&!e.j&&(It(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Et(this,t),Ct(this,n,e))},e)),e.j=t}(e.i,e.h)):(n||(t=ft(t,vt)),e.i=new bt(t,e.h))}function lt(e,t,n){e.i.set(t,n)}function ht(e){return lt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function dt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ft(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,pt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function pt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}st.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ft(t,mt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ft(t,mt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ft(n,"/"==n.charAt(0)?_t:yt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ft(n,wt)),e.join("")};var gt,mt=/[#\/\?@]/g,yt=/[#\?:]/g,_t=/[#\?]/g,vt=/[#\?@]/g,wt=/#/g;function bt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function It(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function Et(e,t){It(e),t=kt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Tt(e,t){return It(e),t=kt(e,t),e.g.has(t)}function Ct(e,t,n){Et(e,t),0<n.length&&(e.i=null,e.g.set(kt(e,t),d(n)),e.h+=n.length)}function kt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function St(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function xt(){this.g=new fe}function At(e,t,n){const r=n||"";try{rt(e,function(e,n){let i=e;o(e)&&(i=he(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Nt(e){this.l=e.Ub||null,this.j=e.eb||!1}function Rt(e,t){ne.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Pt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Dt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Ot(e)}function Ot(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Lt(e){let t="";return _(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function Mt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Lt(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):lt(e,t,n))}function Ft(e){ne.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=bt.prototype).add=function(e,t){It(this),this.i=null,e=kt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){It(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},e.na=function(){It(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},e.V=function(e){It(this);let t=[];if("string"==typeof e)Tt(this,e)&&(t=t.concat(this.g.get(kt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return It(this),this.i=null,Tt(this,e=kt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")},h(Nt,pe),Nt.prototype.g=function(){return new Rt(this.l,this.j)},Nt.prototype.i=(gt={},function(){return gt}),h(Rt,ne),(e=Rt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Ot(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Dt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ot(this)),this.g&&(this.readyState=3,Ot(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Pt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Dt(this):Ot(this),3==this.readyState&&Pt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Dt(this))},e.Qa=function(e){this.g&&(this.response=e,Dt(this))},e.ga=function(){this.g&&Dt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Rt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),h(Ft,ne);var Ut=/^https?$/i,Vt=["POST","PUT"];function jt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,qt(e),Bt(e)}function qt(e){e.A||(e.A=!0,re(e,"complete"),re(e,"error"))}function $t(e){if(e.h&&void 0!==r&&(!e.v[1]||4!=Wt(e)||2!=e.Z()))if(e.u&&4==Wt(e))se(e.Ea,0,e);else if(re(e,"readystatechange"),4==Wt(e)){e.h=!1;try{const r=e.Z();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var s;if(s=0===r){var o=String(e.D).match(it)[1]||null;!o&&i.self&&i.self.location&&(o=i.self.location.protocol.slice(0,-1)),s=!Ut.test(o?o.toLowerCase():"")}n=s}if(n)re(e,"complete"),re(e,"success");else{e.m=6;try{var a=2<Wt(e)?e.g.statusText:""}catch(e){a=""}e.l=a+" ["+e.Z()+"]",qt(e)}}finally{Bt(e)}}}function Bt(e,t){if(e.g){zt(e);const n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||re(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function zt(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function Wt(e){return e.g?e.g.readyState:0}function Ht(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Kt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Gt(e){this.Aa=0,this.i=[],this.j=new Ae,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Kt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Kt("baseRetryDelayMs",5e3,e),this.cb=Kt("retryDelaySeedMs",1e4,e),this.Wa=Kt("forwardChannelMaxRetries",2,e),this.wa=Kt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Ye(e&&e.concurrentRequestLimit),this.Da=new xt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Qt(e){if(Xt(e),3==e.G){var t=e.U++,n=ot(e.I);if(lt(n,"SID",e.K),lt(n,"RID",t),lt(n,"TYPE","terminate"),en(e,n),(t=new Le(e,e.j,t)).L=2,t.v=ht(ot(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=fn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Be(t)}hn(e)}function Yt(e){e.g&&(sn(e),e.g.cancel(),e.g=null)}function Xt(e){Yt(e),e.u&&(i.clearTimeout(e.u),e.u=null),an(e),e.h.cancel(),e.s&&("number"==typeof e.s&&i.clearTimeout(e.s),e.s=null)}function Jt(e){if(!Xe(e.h)&&!e.s){e.s=!0;var t=e.Ga;S||N(),x||(S(),x=!0),A.add(t,e),e.B=0}}function Zt(e,t){var n;n=t?t.l:e.U++;const r=ot(e.I);lt(r,"SID",e.K),lt(r,"RID",n),lt(r,"AID",e.T),en(e,r),e.m&&e.o&&Mt(r,e.m,e.o),n=new Le(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tn(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),et(e.h,n),Ve(n,r,t)}function en(e,t){e.H&&_(e.H,function(e,n){lt(t,n,e)}),e.l&&rt({},function(e,n){lt(t,n,e)})}function tn(e,t,n){n=Math.min(e.i.length,n);var r=e.l?u(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),s=!1;else try{At(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function nn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;S||N(),x||(S(),x=!0),A.add(t,e),e.v=0}}function rn(e){return!(e.g||e.u||3<=e.v||(e.Y++,e.u=xe(u(e.Fa,e),un(e,e.v)),e.v++,0))}function sn(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function on(e){e.g=new Le(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=ot(e.qa);lt(t,"RID","rpc"),lt(t,"SID",e.K),lt(t,"AID",e.T),lt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&lt(t,"TO",e.ja),lt(t,"TYPE","xmlhttp"),en(e,t),e.m&&e.o&&Mt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=ht(ot(t)),n.m=null,n.P=!0,je(n,e)}function an(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function cn(e,t){var n=null;if(e.g==t){an(e),sn(e),e.g=null;var r=2}else{if(!Ze(e.h,t))return;n=t.D,tt(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;re(r=Ie(),new Se(r,n)),Jt(e)}else nn(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&function(e,t){return!(Je(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=xe(u(e.Ga,e,t),un(e,e.B)),e.B++,0)))}(e,t)||2==r&&rn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:ln(e,5);break;case 4:ln(e,10);break;case 3:ln(e,6);break;default:ln(e,2)}}function un(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function ln(e,t){if(e.j.info("Error code "+t),2==t){var n=u(e.fb,e),r=e.Xa;const t=!r;r=new st(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||at(r,"https"),ht(r),t?function(e,t){const n=new Ae;if(i.Image){const r=new Image;r.onload=l(St,n,"TestLoadImage: loaded",!0,t,r),r.onerror=l(St,n,"TestLoadImage: error",!1,t,r),r.onabort=l(St,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=l(St,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Ae;const n=new AbortController,r=setTimeout(()=>{n.abort(),St(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(r),e.ok?St(0,0,!0,t):St(0,0,!1,t)}).catch(()=>{clearTimeout(r),St(0,0,!1,t)})}(r.toString(),n)}else ke(2);e.G=0,e.l&&e.l.sa(t),hn(e),Xt(e)}function hn(e){if(e.G=0,e.ka=[],e.l){const t=nt(e.h);0==t.length&&0==e.i.length||(f(e.ka,t),f(e.ka,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.ra()}}function dn(e,t,n){var r=n instanceof st?ot(n):new st(n);if(""!=r.g)t&&(r.g=t+"."+r.g),ct(r,r.s);else{var s=i.location;r=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;var o=new st(null);r&&at(o,r),t&&(o.g=t),s&&ct(o,s),n&&(o.l=n),r=o}return n=e.D,t=e.ya,n&&t&&lt(r,n,t),lt(r,"VER",e.la),en(e,r),r}function fn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Ft(new Nt({eb:n})):new Ft(e.pa)).Ha(e.J),t}function pn(){}function gn(){}function mn(e,t){ne.call(this),this.g=new Gt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!p(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!p(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new vn(this)}function yn(e){_e.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function _n(){ve.call(this),this.status=1}function vn(e){this.g=e}(e=Ft.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Re.g(),this.v=this.o?ge(this.o):ge(Re),this.g.onreadystatechange=u(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void jt(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=i.FormData&&e instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Vt,t,void 0))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{zt(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){jt(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,re(this,"complete"),re(this,"abort"),Bt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Bt(this,!0)),Ft.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?$t(this):this.bb())},e.bb=function(){$t(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Wt(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),de(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Gt.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){ke(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=dn(this,null,this.W),Jt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Le(this,this.j,e);let s=this.o;if(this.S&&(s?(s=v(s),b(s,this.S)):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tn(this,i,t),lt(n=ot(this.I),"RID",e),lt(n,"CVER",22),this.D&&lt(n,"X-HTTP-Session-Id",this.D),en(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(Lt(s)))+"&"+t:this.m&&Mt(n,this.m,s)),et(this.h,i),this.Ua&&lt(n,"TYPE","init"),this.P?(lt(n,"$req",t),lt(n,"SID","null"),i.T=!0,Ve(i,n,null)):Ve(i,n,t),this.G=2}}else 3==this.G&&(e?Zt(this,e):0==this.i.length||Xe(this.h)||Zt(this))},e.Fa=function(){if(this.u=null,on(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=xe(u(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ke(10),Yt(this),on(this))},e.Za=function(){null!=this.C&&(this.C=null,Yt(this),rn(this),ke(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),ke(2)):(this.j.info("Failed to ping google.com"),ke(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=pn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},gn.prototype.g=function(e,t){return new mn(e,t)},h(mn,ne),mn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},mn.prototype.close=function(){Qt(this.g)},mn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=he(e),e=n);t.i.push(new Qe(t.Ya++,e)),3==t.G&&Jt(t)},mn.prototype.N=function(){this.g.l=null,delete this.j,Qt(this.g),delete this.g,mn.aa.N.call(this)},h(yn,_e),h(_n,ve),h(vn,pn),vn.prototype.ua=function(){re(this.g,"a")},vn.prototype.ta=function(e){re(this.g,new yn(e))},vn.prototype.sa=function(e){re(this.g,new _n)},vn.prototype.ra=function(){re(this.g,"b")},gn.prototype.createWebChannel=gn.prototype.g,mn.prototype.send=mn.prototype.o,mn.prototype.open=mn.prototype.m,mn.prototype.close=mn.prototype.close,ji=$i.createWebChannelTransport=function(){return new gn},Vi=$i.getStatEventTarget=function(){return Ie()},Ui=$i.Event=we,Fi=$i.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Pe.NO_ERROR=0,Pe.TIMEOUT=8,Pe.HTTP_ERROR=6,Mi=$i.ErrorCode=Pe,De.COMPLETE="complete",Li=$i.EventType=De,me.EventType=ye,ye.OPEN="a",ye.CLOSE="b",ye.ERROR="c",ye.MESSAGE="d",ne.prototype.listen=ne.prototype.K,Oi=$i.WebChannel=me,$i.FetchXmlHttpFactory=Nt,Ft.prototype.listenOnce=Ft.prototype.L,Ft.prototype.getLastError=Ft.prototype.Ka,Ft.prototype.getLastErrorCode=Ft.prototype.Ba,Ft.prototype.getStatus=Ft.prototype.Z,Ft.prototype.getResponseJson=Ft.prototype.Oa,Ft.prototype.getResponseText=Ft.prototype.oa,Ft.prototype.send=Ft.prototype.ea,Ft.prototype.setWithCredentials=Ft.prototype.Ha,Di=$i.XhrIo=Ft}).apply(void 0!==qi?qi:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Bi="@firebase/firestore",zi="4.7.17";class Wi{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Wi.UNAUTHENTICATED=new Wi(null),Wi.GOOGLE_CREDENTIALS=new Wi("google-credentials-uid"),Wi.FIRST_PARTY=new Wi("first-party-uid"),Wi.MOCK_USER=new Wi("mock-user");let Hi="11.9.0";const Ki=new se("@firebase/firestore");function Gi(){return Ki.logLevel}function Qi(e,...t){if(Ki.logLevel<=ee.DEBUG){const n=t.map(Ji);Ki.debug(`Firestore (${Hi}): ${e}`,...n)}}function Yi(e,...t){if(Ki.logLevel<=ee.ERROR){const n=t.map(Ji);Ki.error(`Firestore (${Hi}): ${e}`,...n)}}function Xi(e,...t){if(Ki.logLevel<=ee.WARN){const n=t.map(Ji);Ki.warn(`Firestore (${Hi}): ${e}`,...n)}}function Ji(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function Zi(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,es(e,r,n)}function es(e,t,n){let r=`FIRESTORE (${Hi}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw Yi(r),new Error(r)}function ts(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||es(t,i,r)}function ns(e,t){return e}const rs={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class is extends x{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ss{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class os{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class as{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Wi.UNAUTHENTICATED))}shutdown(){}}class cs{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class us{constructor(e){this.t=e,this.currentUser=Wi.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ts(void 0===this.o,42304);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new ss;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new ss,e.enqueueRetryable(()=>r(this.currentUser))};const s=()=>{const t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{Qi("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Qi("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new ss)}},0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(Qi("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(ts("string"==typeof t.accessToken,31837,{l:t}),new os(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ts(null===e||"string"==typeof e,2055,{h:e}),new Wi(e)}}class ls{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=Wi.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class hs{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new ls(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Wi.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ds{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class fs{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ot(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ts(void 0===this.o,3512);const n=e=>{null!=e.error&&Qi("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.m;return this.m=e.token,Qi("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const r=e=>{Qi("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?r(e):Qi("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new ds(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(ts("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new ds(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function ps(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}function gs(){return new TextEncoder}class ms{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=ps(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function ys(e,t){return e<t?-1:e>t?1:0}function _s(e,t){let n=0;for(;n<e.length&&n<t.length;){const r=e.codePointAt(n),i=t.codePointAt(n);if(r!==i){if(r<128&&i<128)return ys(r,i);{const s=gs(),o=ws(s.encode(vs(e,n)),s.encode(vs(t,n)));return 0!==o?o:ys(r,i)}}n+=r>65535?2:1}return ys(e.length,t.length)}function vs(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function ws(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return ys(e[n],t[n]);return ys(e.length,t.length)}function bs(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}const Is=-62135596800,Es=1e6;class Ts{static now(){return Ts.fromMillis(Date.now())}static fromDate(e){return Ts.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Es);return new Ts(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new is(rs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new is(rs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Is)throw new is(rs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new is(rs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Es}_compareTo(e){return this.seconds===e.seconds?ys(this.nanoseconds,e.nanoseconds):ys(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-Is;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Cs{static fromTimestamp(e){return new Cs(e)}static min(){return new Cs(new Ts(0,0))}static max(){return new Cs(new Ts(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const ks="__name__";class Ss{constructor(e,t,n){void 0===t?t=0:t>e.length&&Zi(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&Zi(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Ss.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ss?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=Ss.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return ys(e.length,t.length)}static compareSegments(e,t){const n=Ss.isNumericId(e),r=Ss.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?Ss.extractNumericId(e).compare(Ss.extractNumericId(t)):_s(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ai.fromString(e.substring(4,e.length-2))}}class xs extends Ss{construct(e,t,n){return new xs(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new is(rs.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new xs(t)}static emptyPath(){return new xs([])}}const As=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ns extends Ss{construct(e,t,n){return new Ns(e,t,n)}static isValidIdentifier(e){return As.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ns.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===ks}static keyField(){return new Ns([ks])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new is(rs.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new is(rs.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new is(rs.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new is(rs.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ns(t)}static emptyPath(){return new Ns([])}}class Rs{constructor(e){this.path=e}static fromPath(e){return new Rs(xs.fromString(e))}static fromName(e){return new Rs(xs.fromString(e).popFirst(5))}static empty(){return new Rs(xs.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===xs.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return xs.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Rs(new xs(e.slice()))}}function Ps(e){return new Ds(e.readTime,e.key,-1)}class Ds{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Ds(Cs.min(),Rs.empty(),-1)}static max(){return new Ds(Cs.max(),Rs.empty(),-1)}}function Os(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Rs.comparator(e.documentKey,t.documentKey),0!==n?n:ys(e.largestBatchId,t.largestBatchId))}class Ls{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function Ms(e){if(e.code!==rs.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;Qi("LocalStore","Unexpectedly lost primary lease")}class Fs{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Zi(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Fs((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Fs?t:Fs.resolve(t)}catch(e){return Fs.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Fs.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Fs.reject(t)}static resolve(e){return new Fs((t,n)=>{t(e)})}static reject(e){return new Fs((t,n)=>{n(e)})}static waitFor(e){return new Fs((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=Fs.resolve(!1);for(const n of e)t=t.next(e=>e?Fs.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new Fs((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next(e=>{s[c]=e,++o,o===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new Fs((n,r)=>{const i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}function Us(e){return"IndexedDbTransactionError"===e.name}class Vs{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ue(e),this.ce=e=>t.writeSequenceNumber(e))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ce&&this.ce(e),e}}Vs.le=-1;function js(e){return null==e}function qs(e){return 0===e&&1/e==-1/0}function $s(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function Bs(e){return e+""}const zs="owner",Ws="mutationQueues",Hs="mutations",Ks="documentMutations",Gs="remoteDocumentGlobal",Qs="targets",Ys="targetDocuments",Xs="targetGlobal",Js="collectionParents",Zs="clientMetadata",eo="bundles",to="namedQueries";function no(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ro(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function io(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class so{constructor(e,t){this.comparator=e,this.root=t||ao.EMPTY}insert(e,t){return new so(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ao.BLACK,null,null))}remove(e){return new so(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ao.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new oo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new oo(this.root,e,this.comparator,!1)}getReverseIterator(){return new oo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new oo(this.root,e,this.comparator,!0)}}class oo{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ao{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:ao.RED,this.left=null!=r?r:ao.EMPTY,this.right=null!=i?i:ao.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new ao(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return ao.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return ao.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ao.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ao.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Zi(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Zi(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Zi(27949);return e+(this.isRed()?0:1)}}ao.EMPTY=null,ao.RED=!0,ao.BLACK=!1,ao.EMPTY=new class{constructor(){this.size=0}get key(){throw Zi(57766)}get value(){throw Zi(16141)}get color(){throw Zi(16727)}get left(){throw Zi(29726)}get right(){throw Zi(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new ao(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class co{constructor(e){this.comparator=e,this.data=new so(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new uo(this.data.getIterator())}getIteratorFrom(e){return new uo(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof co))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new co(this.comparator);return t.data=e,t}}class uo{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class lo{constructor(e){this.fields=e,e.sort(Ns.comparator)}static empty(){return new lo([])}unionWith(e){let t=new co(Ns.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new lo(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return bs(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class ho extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class fo{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new ho("Invalid base64 string: "+e):e}}(e);return new fo(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new fo(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ys(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}fo.EMPTY_BYTE_STRING=new fo("");const po=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function go(e){if(ts(!!e,39018),"string"==typeof e){let t=0;const n=po.exec(e);if(ts(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:mo(e.seconds),nanos:mo(e.nanos)}}function mo(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function yo(e){return"string"==typeof e?fo.fromBase64String(e):fo.fromUint8Array(e)}const _o="server_timestamp",vo="__type__",wo="__previous_value__",bo="__local_write_time__";function Io(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[vo])||void 0===n?void 0:n.stringValue)===_o}function Eo(e){const t=e.mapValue.fields[wo];return Io(t)?Eo(t):t}function To(e){const t=go(e.mapValue.fields[bo].timestampValue);return new Ts(t.seconds,t.nanos)}class Co{constructor(e,t,n,r,i,s,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=u}}const ko="(default)";class So{constructor(e,t){this.projectId=e,this.database=t||ko}static empty(){return new So("","")}get isDefaultDatabase(){return this.database===ko}isEqual(e){return e instanceof So&&e.projectId===this.projectId&&e.database===this.database}}const xo="__type__",Ao="__max__",No={fields:{__type__:{stringValue:Ao}}},Ro="__vector__",Po="value";function Do(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Io(e)?4:Yo(e)?9007199254740991:Go(e)?10:11:Zi(28295,{value:e})}function Oo(e,t){if(e===t)return!0;const n=Do(e);if(n!==Do(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return To(e).isEqual(To(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=go(e.timestampValue),r=go(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return yo(e.bytesValue).isEqual(yo(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return mo(e.geoPointValue.latitude)===mo(t.geoPointValue.latitude)&&mo(e.geoPointValue.longitude)===mo(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return mo(e.integerValue)===mo(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=mo(e.doubleValue),r=mo(t.doubleValue);return n===r?qs(n)===qs(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return bs(e.arrayValue.values||[],t.arrayValue.values||[],Oo);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(no(n)!==no(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Oo(n[e],r[e])))return!1;return!0}(e,t);default:return Zi(52216,{left:e})}}function Lo(e,t){return void 0!==(e.values||[]).find(e=>Oo(e,t))}function Mo(e,t){if(e===t)return 0;const n=Do(e),r=Do(t);if(n!==r)return ys(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ys(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=mo(e.integerValue||e.doubleValue),r=mo(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Fo(e.timestampValue,t.timestampValue);case 4:return Fo(To(e),To(t));case 5:return _s(e.stringValue,t.stringValue);case 6:return function(e,t){const n=yo(e),r=yo(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=ys(n[e],r[e]);if(0!==t)return t}return ys(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=ys(mo(e.latitude),mo(t.latitude));return 0!==n?n:ys(mo(e.longitude),mo(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Uo(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,s;const o=e.fields||{},a=t.fields||{},c=null===(n=o[Po])||void 0===n?void 0:n.arrayValue,u=null===(r=a[Po])||void 0===r?void 0:r.arrayValue,l=ys((null===(i=null==c?void 0:c.values)||void 0===i?void 0:i.length)||0,(null===(s=null==u?void 0:u.values)||void 0===s?void 0:s.length)||0);return 0!==l?l:Uo(c,u)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===No&&t===No)return 0;if(e===No)return 1;if(t===No)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=_s(r[e],s[e]);if(0!==t)return t;const o=Mo(n[r[e]],i[s[e]]);if(0!==o)return o}return ys(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Zi(23264,{Pe:n})}}function Fo(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return ys(e,t);const n=go(e),r=go(t),i=ys(n.seconds,r.seconds);return 0!==i?i:ys(n.nanos,r.nanos)}function Uo(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Mo(n[e],r[e]);if(t)return t}return ys(n.length,r.length)}function Vo(e){return jo(e)}function jo(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=go(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return yo(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return Rs.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=jo(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${jo(e.fields[i])}`;return n+"}"}(e.mapValue):Zi(61005,{value:e})}function qo(e){switch(Do(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Eo(e);return t?16+qo(t):16;case 5:return 2*e.stringValue.length;case 6:return yo(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce((e,t)=>e+qo(t),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return ro(e.fields,(e,n)=>{t+=e.length+qo(n)}),t}(e.mapValue);default:throw Zi(13486,{value:e})}}function $o(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Bo(e){return!!e&&"integerValue"in e}function zo(e){return!!e&&"arrayValue"in e}function Wo(e){return!!e&&"nullValue"in e}function Ho(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Ko(e){return!!e&&"mapValue"in e}function Go(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[xo])||void 0===n?void 0:n.stringValue)===Ro}function Qo(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return ro(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Qo(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Qo(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Yo(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===Ao}class Xo{constructor(e){this.value=e}static empty(){return new Xo({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ko(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Qo(t)}setAll(e){let t=Ns.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Qo(e):r.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Ko(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Oo(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Ko(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){ro(t,(t,n)=>e[t]=n);for(const t of n)delete e[t]}clone(){return new Xo(Qo(this.value))}}function Jo(e){const t=[];return ro(e.fields,(e,n)=>{const r=new Ns([e]);if(Ko(n)){const e=Jo(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new lo(t)}class Zo{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new Zo(e,0,Cs.min(),Cs.min(),Cs.min(),Xo.empty(),0)}static newFoundDocument(e,t,n,r){return new Zo(e,1,t,Cs.min(),n,r,0)}static newNoDocument(e,t){return new Zo(e,2,t,Cs.min(),Cs.min(),Xo.empty(),0)}static newUnknownDocument(e,t){return new Zo(e,3,t,Cs.min(),Cs.min(),Xo.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Cs.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Xo.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Xo.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Cs.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Zo&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Zo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ea{constructor(e,t){this.position=e,this.inclusive=t}}function ta(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?Rs.comparator(Rs.fromName(o.referenceValue),n.key):Mo(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function na(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Oo(e.position[n],t.position[n]))return!1;return!0}class ra{constructor(e,t="asc"){this.field=e,this.dir=t}}function ia(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class sa{}class oa extends sa{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new fa(e,t,n):"array-contains"===t?new ya(e,n):"in"===t?new _a(e,n):"not-in"===t?new va(e,n):"array-contains-any"===t?new wa(e,n):new oa(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new pa(e,n):new ga(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(Mo(t,this.value)):null!==t&&Do(this.value)===Do(t)&&this.matchesComparison(Mo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Zi(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class aa extends sa{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new aa(e,t)}matches(e){return ca(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Te||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function ca(e){return"and"===e.op}function ua(e){return function(e){for(const t of e.filters)if(t instanceof aa)return!1;return!0}(e)&&ca(e)}function la(e){if(e instanceof oa)return e.field.canonicalString()+e.op.toString()+Vo(e.value);if(ua(e))return e.filters.map(e=>la(e)).join(",");{const t=e.filters.map(e=>la(e)).join(",");return`${e.op}(${t})`}}function ha(e,t){return e instanceof oa?function(e,t){return t instanceof oa&&e.op===t.op&&e.field.isEqual(t.field)&&Oo(e.value,t.value)}(e,t):e instanceof aa?function(e,t){return t instanceof aa&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&ha(n,t.filters[r]),!0)}(e,t):void Zi(19439)}function da(e){return e instanceof oa?function(e){return`${e.field.canonicalString()} ${e.op} ${Vo(e.value)}`}(e):e instanceof aa?function(e){return e.op.toString()+" {"+e.getFilters().map(da).join(" ,")+"}"}(e):"Filter"}class fa extends oa{constructor(e,t,n){super(e,t,n),this.key=Rs.fromName(n.referenceValue)}matches(e){const t=Rs.comparator(e.key,this.key);return this.matchesComparison(t)}}class pa extends oa{constructor(e,t){super(e,"in",t),this.keys=ma(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class ga extends oa{constructor(e,t){super(e,"not-in",t),this.keys=ma(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ma(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>Rs.fromName(e.referenceValue))}class ya extends oa{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return zo(t)&&Lo(t.arrayValue,this.value)}}class _a extends oa{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Lo(this.value.arrayValue,t)}}class va extends oa{constructor(e,t){super(e,"not-in",t)}matches(e){if(Lo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!Lo(this.value.arrayValue,t)}}class wa extends oa{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!zo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Lo(this.value.arrayValue,e))}}class ba{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Ie=null}}function Ia(e,t=null,n=[],r=[],i=null,s=null,o=null){return new ba(e,t,n,r,i,s,o)}function Ea(e){const t=ns(e);if(null===t.Ie){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>la(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),js(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Vo(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Vo(e)).join(",")),t.Ie=e}return t.Ie}function Ta(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!ia(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!ha(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!na(e.startAt,t.startAt)&&na(e.endAt,t.endAt)}function Ca(e){return Rs.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class ka{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function Sa(e){return new ka(e)}function xa(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Aa(e){return null!==e.collectionGroup}function Na(e){const t=ns(e);if(null===t.Ee){t.Ee=[];const e=new Set;for(const n of t.explicitOrderBy)t.Ee.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new co(Ns.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);r.forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ee.push(new ra(r,n))}),e.has(Ns.keyField().canonicalString())||t.Ee.push(new ra(Ns.keyField(),n))}return t.Ee}function Ra(e){const t=ns(e);return t.de||(t.de=function(e,t){if("F"===e.limitType)return Ia(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new ra(e.field,t)});const n=e.endAt?new ea(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new ea(e.startAt.position,e.startAt.inclusive):null;return Ia(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,Na(e))),t.de}function Pa(e,t){const n=e.filters.concat([t]);return new ka(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Da(e,t,n){return new ka(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Oa(e,t){return Ta(Ra(e),Ra(t))&&e.limitType===t.limitType}function La(e){return`${Ea(Ra(e))}|lt:${e.limitType}`}function Ma(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>da(e)).join(", ")}]`),js(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Vo(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Vo(e)).join(",")),`Target(${t})`}(Ra(e))}; limitType=${e.limitType})`}function Fa(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Rs.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Na(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=ta(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Na(e),t)||e.endAt&&!function(e,t,n){const r=ta(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Na(e),t))}(e,t)}function Ua(e){return(t,n)=>{let r=!1;for(const i of Na(e)){const e=Va(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Va(e,t,n){const r=e.field.isKeyField()?Rs.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Mo(r,i):Zi(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Zi(19790,{direction:e.dir})}}class ja{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){ro(this.inner,(t,n)=>{for(const[t,r]of n)e(t,r)})}isEmpty(){return io(this.inner)}size(){return this.innerSize}}const qa=new so(Rs.comparator);function $a(){return qa}const Ba=new so(Rs.comparator);function za(...e){let t=Ba;for(const n of e)t=t.insert(n.key,n);return t}function Wa(e){let t=Ba;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Ha(){return Ga()}function Ka(){return Ga()}function Ga(){return new ja(e=>e.toString(),(e,t)=>e.isEqual(t))}const Qa=new so(Rs.comparator),Ya=new co(Rs.comparator);function Xa(...e){let t=Ya;for(const n of e)t=t.add(n);return t}const Ja=new co(ys);function Za(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qs(t)?"-0":t}}function ec(e){return{integerValue:""+e}}function tc(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!qs(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?ec(t):Za(e,t)}class nc{constructor(){this._=void 0}}function rc(e,t,n){return e instanceof oc?function(e,t){const n={fields:{[vo]:{stringValue:_o},[bo]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Io(t)&&(t=Eo(t)),t&&(n.fields[wo]=t),{mapValue:n}}(n,t):e instanceof ac?cc(e,t):e instanceof uc?lc(e,t):function(e,t){const n=sc(e,t),r=dc(n)+dc(e.Re);return Bo(n)&&Bo(e.Re)?ec(r):Za(e.serializer,r)}(e,t)}function ic(e,t,n){return e instanceof ac?cc(e,t):e instanceof uc?lc(e,t):n}function sc(e,t){return e instanceof hc?function(e){return Bo(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class oc extends nc{}class ac extends nc{constructor(e){super(),this.elements=e}}function cc(e,t){const n=fc(t);for(const t of e.elements)n.some(e=>Oo(e,t))||n.push(t);return{arrayValue:{values:n}}}class uc extends nc{constructor(e){super(),this.elements=e}}function lc(e,t){let n=fc(t);for(const t of e.elements)n=n.filter(e=>!Oo(e,t));return{arrayValue:{values:n}}}class hc extends nc{constructor(e,t){super(),this.serializer=e,this.Re=t}}function dc(e){return mo(e.integerValue||e.doubleValue)}function fc(e){return zo(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class pc{constructor(e,t){this.field=e,this.transform=t}}class gc{constructor(e,t){this.version=e,this.transformResults=t}}class mc{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new mc}static exists(e){return new mc(void 0,e)}static updateTime(e){return new mc(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function yc(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class _c{}function vc(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Ac(e.key,mc.none()):new Tc(e.key,e.data,mc.none());{const n=e.data,r=Xo.empty();let i=new co(Ns.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Cc(e.key,r,new lo(i.toArray()),mc.none())}}function wc(e,t,n){e instanceof Tc?function(e,t,n){const r=e.value.clone(),i=Sc(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Cc?function(e,t,n){if(!yc(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Sc(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(kc(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function bc(e,t,n,r){return e instanceof Tc?function(e,t,n,r){if(!yc(e.precondition,t))return n;const i=e.value.clone(),s=xc(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Cc?function(e,t,n,r){if(!yc(e.precondition,t))return n;const i=xc(e.fieldTransforms,r,t),s=t.data;return s.setAll(kc(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):function(e,t,n){return yc(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Ic(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=sc(r.transform,e||null);null!=i&&(null===n&&(n=Xo.empty()),n.set(r.field,i))}return n||null}function Ec(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&bs(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof ac&&t instanceof ac||e instanceof uc&&t instanceof uc?bs(e.elements,t.elements,Oo):e instanceof hc&&t instanceof hc?Oo(e.Re,t.Re):e instanceof oc&&t instanceof oc}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Tc extends _c{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Cc extends _c{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function kc(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function Sc(e,t,n){const r=new Map;ts(e.length===n.length,32656,{Ve:n.length,me:e.length});for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,ic(o,a,n[i]))}return r}function xc(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,rc(e,s,t))}return r}class Ac extends _c{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Nc extends _c{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Rc{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&wc(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=bc(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=bc(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Ka();return this.mutations.forEach(r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=vc(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(Cs.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Xa())}isEqual(e){return this.batchId===e.batchId&&bs(this.mutations,e.mutations,(e,t)=>Ec(e,t))&&bs(this.baseMutations,e.baseMutations,(e,t)=>Ec(e,t))}}class Pc{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){ts(e.mutations.length===n.length,58842,{fe:e.mutations.length,ge:n.length});let r=Qa;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Pc(e,t,n,r)}}class Dc{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Oc{constructor(e,t){this.count=e,this.unchangedNames=t}}var Lc,Mc;function Fc(e){if(void 0===e)return Yi("GRPC error has no .code"),rs.UNKNOWN;switch(e){case Lc.OK:return rs.OK;case Lc.CANCELLED:return rs.CANCELLED;case Lc.UNKNOWN:return rs.UNKNOWN;case Lc.DEADLINE_EXCEEDED:return rs.DEADLINE_EXCEEDED;case Lc.RESOURCE_EXHAUSTED:return rs.RESOURCE_EXHAUSTED;case Lc.INTERNAL:return rs.INTERNAL;case Lc.UNAVAILABLE:return rs.UNAVAILABLE;case Lc.UNAUTHENTICATED:return rs.UNAUTHENTICATED;case Lc.INVALID_ARGUMENT:return rs.INVALID_ARGUMENT;case Lc.NOT_FOUND:return rs.NOT_FOUND;case Lc.ALREADY_EXISTS:return rs.ALREADY_EXISTS;case Lc.PERMISSION_DENIED:return rs.PERMISSION_DENIED;case Lc.FAILED_PRECONDITION:return rs.FAILED_PRECONDITION;case Lc.ABORTED:return rs.ABORTED;case Lc.OUT_OF_RANGE:return rs.OUT_OF_RANGE;case Lc.UNIMPLEMENTED:return rs.UNIMPLEMENTED;case Lc.DATA_LOSS:return rs.DATA_LOSS;default:return Zi(39323,{code:e})}}(Mc=Lc||(Lc={}))[Mc.OK=0]="OK",Mc[Mc.CANCELLED=1]="CANCELLED",Mc[Mc.UNKNOWN=2]="UNKNOWN",Mc[Mc.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Mc[Mc.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Mc[Mc.NOT_FOUND=5]="NOT_FOUND",Mc[Mc.ALREADY_EXISTS=6]="ALREADY_EXISTS",Mc[Mc.PERMISSION_DENIED=7]="PERMISSION_DENIED",Mc[Mc.UNAUTHENTICATED=16]="UNAUTHENTICATED",Mc[Mc.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Mc[Mc.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Mc[Mc.ABORTED=10]="ABORTED",Mc[Mc.OUT_OF_RANGE=11]="OUT_OF_RANGE",Mc[Mc.UNIMPLEMENTED=12]="UNIMPLEMENTED",Mc[Mc.INTERNAL=13]="INTERNAL",Mc[Mc.UNAVAILABLE=14]="UNAVAILABLE",Mc[Mc.DATA_LOSS=15]="DATA_LOSS";const Uc=new Ai([4294967295,4294967295],0);function Vc(e){const t=gs().encode(e),n=new Ni;return n.update(t),new Uint8Array(n.digest())}function jc(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Ai([n,r],0),new Ai([i,s],0)]}class qc{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new $c(`Invalid padding: ${t}`);if(n<0)throw new $c(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new $c(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new $c(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=Ai.fromNumber(this.pe)}we(e,t,n){let r=e.add(t.multiply(Ai.fromNumber(n)));return 1===r.compare(Uc)&&(r=new Ai([r.getBits(0),r.getBits(1)],0)),r.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.pe)return!1;const t=Vc(e),[n,r]=jc(t);for(let e=0;e<this.hashCount;e++){const t=this.we(n,r,e);if(!this.be(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new qc(i,r,t);return n.forEach(e=>s.insert(e)),s}insert(e){if(0===this.pe)return;const t=Vc(e),[n,r]=jc(t);for(let e=0;e<this.hashCount;e++){const t=this.we(n,r,e);this.Se(t)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class $c extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Bc{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,zc.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Bc(Cs.min(),r,new so(ys),$a(),Xa())}}class zc{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new zc(n,t,Xa(),Xa(),Xa())}}class Wc{constructor(e,t,n,r){this.De=e,this.removedTargetIds=t,this.key=n,this.ve=r}}class Hc{constructor(e,t){this.targetId=e,this.Ce=t}}class Kc{constructor(e,t,n=fo.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Gc{constructor(){this.Fe=0,this.Me=Xc(),this.xe=fo.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return 0!==this.Fe}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=Xa(),t=Xa(),n=Xa();return this.Me.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Zi(38017,{changeType:i})}}),new zc(this.xe,this.Oe,e,t,n)}Qe(){this.Ne=!1,this.Me=Xc()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,ts(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class Qc{constructor(e){this.ze=e,this.je=new Map,this.He=$a(),this.Je=Yc(),this.Ye=Yc(),this.Ze=new so(ys)}Xe(e){for(const t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(const t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,t=>{const n=this.rt(t);switch(e.state){case 0:this.it(t)&&n.ke(e.resumeToken);break;case 1:n.We(),n.Be||n.Qe(),n.ke(e.resumeToken);break;case 2:n.We(),n.Be||this.removeTarget(t);break;case 3:this.it(t)&&(n.Ge(),n.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),n.ke(e.resumeToken));break;default:Zi(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach((e,n)=>{this.it(n)&&t(n)})}ot(e){const t=e.targetId,n=e.Ce.count,r=this._t(t);if(r){const i=r.target;if(Ca(i))if(0===n){const e=new Rs(i.path);this.tt(t,e,Zo.newNoDocument(e,Cs.min()))}else ts(1===n,20013,{expectedCount:n});else{const r=this.ut(t);if(r!==n){const n=this.ct(e),i=n?this.lt(n,e,r):1;if(0!==i){this.st(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,e)}}}}}ct(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=yo(n).toUint8Array()}catch(e){if(e instanceof ho)return Xi("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new qc(s,r,i)}catch(e){return Xi(e instanceof $c?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.pe?null:o}lt(e,t,n){return t.Ce.count===n-this.Tt(e,t.targetId)?0:2}Tt(e,t){const n=this.ze.getRemoteKeysForTarget(t);let r=0;return n.forEach(n=>{const i=this.ze.Pt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.tt(t,n,null),r++)}),r}It(e){const t=new Map;this.je.forEach((n,r)=>{const i=this._t(r);if(i){if(n.current&&Ca(i.target)){const t=new Rs(i.target.path);this.Et(t).has(r)||this.dt(r,t)||this.tt(r,t,Zo.newNoDocument(t,e))}n.Le&&(t.set(r,n.qe()),n.Qe())}});let n=Xa();this.Ye.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this._t(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.He.forEach((t,n)=>n.setReadTime(e));const r=new Bc(e,t,this.Ze,this.He,n);return this.He=$a(),this.Je=Yc(),this.Ye=Yc(),this.Ze=new so(ys),r}et(e,t){if(!this.it(e))return;const n=this.dt(e,t.key)?2:0;this.rt(e).$e(t.key,n),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,n){if(!this.it(e))return;const r=this.rt(e);this.dt(e,t)?r.$e(t,1):r.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),n&&(this.He=this.He.insert(t,n))}removeTarget(e){this.je.delete(e)}ut(e){const t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new Gc,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new co(ys),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new co(ys),this.Je=this.Je.insert(e,t)),t}it(e){const t=null!==this._t(e);return t||Qi("WatchChangeAggregator","Detected inactive target",e),t}_t(e){const t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new Gc),this.ze.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}}function Yc(){return new so(Rs.comparator)}function Xc(){return new so(Rs.comparator)}const Jc={asc:"ASCENDING",desc:"DESCENDING"},Zc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},eu={and:"AND",or:"OR"};class tu{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function nu(e,t){return e.useProto3Json||js(t)?t:{value:t}}function ru(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function iu(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function su(e,t){return ru(e,t.toTimestamp())}function ou(e){return ts(!!e,49232),Cs.fromTimestamp(function(e){const t=go(e);return new Ts(t.seconds,t.nanos)}(e))}function au(e,t){return cu(e,t).canonicalString()}function cu(e,t){const n=function(e){return new xs(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function uu(e){const t=xs.fromString(e);return ts(Su(t),10190,{key:t.toString()}),t}function lu(e,t){return au(e.databaseId,t.path)}function hu(e,t){const n=uu(t);if(n.get(1)!==e.databaseId.projectId)throw new is(rs.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new is(rs.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Rs(pu(n))}function du(e,t){return au(e.databaseId,t)}function fu(e){return new xs(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function pu(e){return ts(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function gu(e,t,n){return{name:lu(e,t),fields:n.value.mapValue.fields}}function mu(e,t){return{documents:[du(e,t.path)]}}function yu(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=du(e,i);const s=function(e){if(0!==e.length)return Cu(aa.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:Eu(e.field),direction:wu(e.dir)}}(e))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=nu(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{gt:n,parent:i}}function _u(e){let t=function(e){const t=uu(e);return 4===t.length?xs.emptyPath():pu(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){ts(1===r,65062);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=vu(e);return t instanceof aa&&ua(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map(e=>function(e){return new ra(Tu(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,js(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new ea(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new ea(n,t)}(n.endAt)),function(e,t,n,r,i,s,o,a){return new ka(e,t,n,r,i,s,o,a)}(t,i,o,s,a,"F",c,u)}function vu(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Tu(e.unaryFilter.field);return oa.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Tu(e.unaryFilter.field);return oa.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Tu(e.unaryFilter.field);return oa.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Tu(e.unaryFilter.field);return oa.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Zi(61313);default:return Zi(60726)}}(e):void 0!==e.fieldFilter?function(e){return oa.create(Tu(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Zi(58110);default:return Zi(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return aa.create(e.compositeFilter.filters.map(e=>vu(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Zi(1026)}}(e.compositeFilter.op))}(e):Zi(30097,{filter:e})}function wu(e){return Jc[e]}function bu(e){return Zc[e]}function Iu(e){return eu[e]}function Eu(e){return{fieldPath:e.canonicalString()}}function Tu(e){return Ns.fromServerFormat(e.fieldPath)}function Cu(e){return e instanceof oa?function(e){if("=="===e.op){if(Ho(e.value))return{unaryFilter:{field:Eu(e.field),op:"IS_NAN"}};if(Wo(e.value))return{unaryFilter:{field:Eu(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Ho(e.value))return{unaryFilter:{field:Eu(e.field),op:"IS_NOT_NAN"}};if(Wo(e.value))return{unaryFilter:{field:Eu(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Eu(e.field),op:bu(e.op),value:e.value}}}(e):e instanceof aa?function(e){const t=e.getFilters().map(e=>Cu(e));return 1===t.length?t[0]:{compositeFilter:{op:Iu(e.op),filters:t}}}(e):Zi(54877,{filter:e})}function ku(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Su(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class xu{constructor(e,t,n,r,i=Cs.min(),s=Cs.min(),o=fo.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new xu(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new xu(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new xu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new xu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Au{constructor(e){this.wt=e}}function Nu(e){const t=_u({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Da(t,t.limit,"L"):t}class Ru{constructor(){}vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(e.booleanValue?1:0);else if("integerValue"in e)this.Mt(t,15),t.xt(mo(e.integerValue));else if("doubleValue"in e){const n=mo(e.doubleValue);isNaN(n)?this.Mt(t,13):(this.Mt(t,15),qs(n)?t.xt(0):t.xt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Mt(t,20),"string"==typeof n&&(n=go(n)),t.Ot(`${n.seconds||""}`),t.xt(n.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt(yo(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Mt(t,45),t.xt(n.latitude||0),t.xt(n.longitude||0)}else"mapValue"in e?Yo(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):Go(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):Zi(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){const n=e.fields||{};this.Mt(t,55);for(const e of Object.keys(n))this.Nt(e,t),this.Ct(n[e],t)}qt(e,t){var n,r;const i=e.fields||{};this.Mt(t,53);const s=Po,o=(null===(r=null===(n=i[s].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.Mt(t,15),t.xt(mo(o)),this.Nt(s,t),this.Ct(i[s],t)}$t(e,t){const n=e.values||[];this.Mt(t,50);for(const e of n)this.Ct(e,t)}kt(e,t){this.Mt(t,37),Rs.fromName(e).path.forEach(e=>{this.Mt(t,60),this.Kt(e,t)})}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}}Ru.Wt=new Ru;class Pu{constructor(){this.Cn=new Du}addToCollectionParentIndex(e,t){return this.Cn.add(t),Fs.resolve()}getCollectionParents(e,t){return Fs.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return Fs.resolve()}deleteFieldIndex(e,t){return Fs.resolve()}deleteAllFieldIndexes(e){return Fs.resolve()}createTargetIndexes(e,t){return Fs.resolve()}getDocumentsMatchingTarget(e,t){return Fs.resolve(null)}getIndexType(e,t){return Fs.resolve(0)}getFieldIndexes(e,t){return Fs.resolve([])}getNextCollectionGroupToUpdate(e){return Fs.resolve(null)}getMinOffset(e,t){return Fs.resolve(Ds.min())}getMinOffsetFromCollectionGroup(e,t){return Fs.resolve(Ds.min())}updateCollectionGroup(e,t,n){return Fs.resolve()}updateIndexEntries(e,t){return Fs.resolve()}}class Du{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new co(xs.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new co(xs.comparator)).toArray()}}new Uint8Array(0);const Ou={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Lu=41943040;class Mu{static withCacheSize(e){return new Mu(e,Mu.DEFAULT_COLLECTION_PERCENTILE,Mu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}Mu.DEFAULT_COLLECTION_PERCENTILE=10,Mu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Mu.DEFAULT=new Mu(Lu,Mu.DEFAULT_COLLECTION_PERCENTILE,Mu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Mu.DISABLED=new Mu(-1,0,0);class Fu{constructor(e){this.ur=e}next(){return this.ur+=2,this.ur}static cr(){return new Fu(0)}static lr(){return new Fu(-1)}}const Uu="LruGarbageCollector";function Vu([e,t],[n,r]){const i=ys(e,n);return 0===i?ys(t,r):i}class ju{constructor(e){this.Er=e,this.buffer=new co(Vu),this.dr=0}Ar(){return++this.dr}Rr(e){const t=[e,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Vu(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class qu{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Vr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return null!==this.Vr}mr(e){Qi(Uu,`Garbage collection scheduled in ${e}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Us(e)?Qi(Uu,"Ignoring IndexedDB error during garbage collection: ",e):await Ms(e)}await this.mr(3e5)})}}class $u{constructor(e,t){this.gr=e,this.params=t}calculateTargetCount(e,t){return this.gr.pr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return Fs.resolve(Vs.le);const n=new ju(t);return this.gr.forEachTarget(e,e=>n.Rr(e.sequenceNumber)).next(()=>this.gr.yr(e,e=>n.Rr(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.gr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.gr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(Qi("LruGarbageCollector","Garbage collection skipped; disabled"),Fs.resolve(Ou)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(Qi("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ou):this.wr(e,t))}getCacheSize(e){return this.gr.getCacheSize(e)}wr(e,t){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(Qi("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(c=Date.now(),Gi()<=ee.DEBUG&&Qi("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),Fs.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class Bu{constructor(){this.changes=new ja(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Zo.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Fs.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class zu{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Wu{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&bc(n.mutation,e,lo.empty(),Ts.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,Xa()).next(()=>t))}getLocalViewOfDocuments(e,t,n=Xa()){const r=Ha();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=za();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=Ha();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Xa()))}populateOverlays(e,t,n){const r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=$a();const s=Ga(),o=Ga();return t.forEach((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof Cc)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),bc(o.mutation,t,o.mutation.getFieldMask(),Ts.now())):s.set(t.key,lo.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new zu(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(e,t){const n=Ga();let r=new so((e,t)=>e-t),i=Xa();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const i of e)i.keys().forEach(e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||lo.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||Xa()).add(e);r=r.insert(i.batchId,a)})}).next(()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Ka();c.forEach(e=>{if(!i.has(e)){const r=vc(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Fs.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return Rs.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Aa(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):Fs.resolve(Ha());let o=-1,a=i;return s.next(t=>Fs.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?Fs.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,a,t,Xa())).next(e=>({batchId:o,changes:Wa(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Rs(t)).next(e=>{let t=za();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=za();return this.indexManager.getCollectionParents(e,i).next(o=>Fs.forEach(o,o=>{const a=function(e,t){return new ka(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Zo.newInvalidDocument(r)))});let n=za();return e.forEach((e,r)=>{const s=i.get(e);void 0!==s&&bc(s.mutation,r,lo.empty(),Ts.now()),Fa(t,r)&&(n=n.insert(e,r))}),n})}}class Hu{constructor(e){this.serializer=e,this.kr=new Map,this.qr=new Map}getBundleMetadata(e,t){return Fs.resolve(this.kr.get(t))}saveBundleMetadata(e,t){return this.kr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:ou(e.createTime)}}(t)),Fs.resolve()}getNamedQuery(e,t){return Fs.resolve(this.qr.get(t))}saveNamedQuery(e,t){return this.qr.set(t.name,function(e){return{name:e.name,query:Nu(e.bundledQuery),readTime:ou(e.readTime)}}(t)),Fs.resolve()}}class Ku{constructor(){this.overlays=new so(Rs.comparator),this.Qr=new Map}getOverlay(e,t){return Fs.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Ha();return Fs.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.St(e,t,r)}),Fs.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Qr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Qr.delete(n)),Fs.resolve()}getOverlaysForCollection(e,t,n){const r=Ha(),i=t.length+1,s=new Rs(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Fs.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new so((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Ha(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Ha(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return Fs.resolve(o)}St(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.Qr.get(r.largestBatchId).delete(n.key);this.Qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Dc(t,n));let i=this.Qr.get(t);void 0===i&&(i=Xa(),this.Qr.set(t,i)),this.Qr.set(t,i.add(n.key))}}class Gu{constructor(){this.sessionToken=fo.EMPTY_BYTE_STRING}getSessionToken(e){return Fs.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Fs.resolve()}}class Qu{constructor(){this.$r=new co(Yu.Ur),this.Kr=new co(Yu.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(e,t){const n=new Yu(e,t);this.$r=this.$r.add(n),this.Kr=this.Kr.add(n)}Gr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.zr(new Yu(e,t))}jr(e,t){e.forEach(e=>this.removeReference(e,t))}Hr(e){const t=new Rs(new xs([])),n=new Yu(t,e),r=new Yu(t,e+1),i=[];return this.Kr.forEachInRange([n,r],e=>{this.zr(e),i.push(e.key)}),i}Jr(){this.$r.forEach(e=>this.zr(e))}zr(e){this.$r=this.$r.delete(e),this.Kr=this.Kr.delete(e)}Yr(e){const t=new Rs(new xs([])),n=new Yu(t,e),r=new Yu(t,e+1);let i=Xa();return this.Kr.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new Yu(e,0),n=this.$r.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Yu{constructor(e,t){this.key=e,this.Zr=t}static Ur(e,t){return Rs.comparator(e.key,t.key)||ys(e.Zr,t.Zr)}static Wr(e,t){return ys(e.Zr,t.Zr)||Rs.comparator(e.key,t.key)}}class Xu{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nr=1,this.Xr=new co(Yu.Ur)}checkEmpty(e){return Fs.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Rc(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.Xr=this.Xr.add(new Yu(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Fs.resolve(s)}lookupMutationBatch(e,t){return Fs.resolve(this.ei(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.ti(n),i=r<0?0:r;return Fs.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Fs.resolve(0===this.mutationQueue.length?-1:this.nr-1)}getAllMutationBatches(e){return Fs.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Yu(t,0),r=new Yu(t,Number.POSITIVE_INFINITY),i=[];return this.Xr.forEachInRange([n,r],e=>{const t=this.ei(e.Zr);i.push(t)}),Fs.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new co(ys);return t.forEach(e=>{const t=new Yu(e,0),r=new Yu(e,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([t,r],e=>{n=n.add(e.Zr)})}),Fs.resolve(this.ni(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;Rs.isDocumentKey(i)||(i=i.child(""));const s=new Yu(new Rs(i),0);let o=new co(ys);return this.Xr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Zr)),!0)},s),Fs.resolve(this.ni(o))}ni(e){const t=[];return e.forEach(e=>{const n=this.ei(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){ts(0===this.ri(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Xr;return Fs.forEach(t.mutations,r=>{const i=new Yu(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Xr=n})}sr(e){}containsKey(e,t){const n=new Yu(t,0),r=this.Xr.firstAfterOrEqual(n);return Fs.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Fs.resolve()}ri(e,t){return this.ti(e)}ti(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ei(e){const t=this.ti(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Ju{constructor(e){this.ii=e,this.docs=new so(Rs.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ii(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Fs.resolve(n?n.document.mutableCopy():Zo.newInvalidDocument(t))}getEntries(e,t){let n=$a();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Zo.newInvalidDocument(e))}),Fs.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=$a();const s=t.path,o=new Rs(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||Os(Ps(o),n)<=0||(r.has(o.key)||Fa(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Fs.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Zi(9500)}si(e,t){return Fs.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Zu(this)}getSize(e){return Fs.resolve(this.size)}}class Zu extends Bu{constructor(e){super(),this.Br=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Br.addEntry(e,r)):this.Br.removeEntry(n)}),Fs.waitFor(t)}getFromCache(e,t){return this.Br.getEntry(e,t)}getAllFromCache(e,t){return this.Br.getEntries(e,t)}}class el{constructor(e){this.persistence=e,this.oi=new ja(e=>Ea(e),Ta),this.lastRemoteSnapshotVersion=Cs.min(),this.highestTargetId=0,this._i=0,this.ai=new Qu,this.targetCount=0,this.ui=Fu.cr()}forEachTarget(e,t){return this.oi.forEach((e,n)=>t(n)),Fs.resolve()}getLastRemoteSnapshotVersion(e){return Fs.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Fs.resolve(this._i)}allocateTargetId(e){return this.highestTargetId=this.ui.next(),Fs.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this._i&&(this._i=t),Fs.resolve()}Tr(e){this.oi.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ui=new Fu(t),this.highestTargetId=t),e.sequenceNumber>this._i&&(this._i=e.sequenceNumber)}addTargetData(e,t){return this.Tr(t),this.targetCount+=1,Fs.resolve()}updateTargetData(e,t){return this.Tr(t),Fs.resolve()}removeTargetData(e,t){return this.oi.delete(t.target),this.ai.Hr(t.targetId),this.targetCount-=1,Fs.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.oi.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.oi.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),Fs.waitFor(i).next(()=>r)}getTargetCount(e){return Fs.resolve(this.targetCount)}getTargetData(e,t){const n=this.oi.get(t)||null;return Fs.resolve(n)}addMatchingKeys(e,t,n){return this.ai.Gr(t,n),Fs.resolve()}removeMatchingKeys(e,t,n){this.ai.jr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),Fs.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ai.Hr(t),Fs.resolve()}getMatchingKeysForTargetId(e,t){const n=this.ai.Yr(t);return Fs.resolve(n)}containsKey(e,t){return Fs.resolve(this.ai.containsKey(t))}}class tl{constructor(e,t){this.ci={},this.overlays={},this.li=new Vs(0),this.hi=!1,this.hi=!0,this.Pi=new Gu,this.referenceDelegate=e(this),this.Ti=new el(this),this.indexManager=new Pu,this.remoteDocumentCache=function(e){return new Ju(e)}(e=>this.referenceDelegate.Ii(e)),this.serializer=new Au(t),this.Ei=new Hu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Ku,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ci[e.toKey()];return n||(n=new Xu(t,this.referenceDelegate),this.ci[e.toKey()]=n),n}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(e,t,n){Qi("MemoryPersistence","Starting transaction:",e);const r=new nl(this.li.next());return this.referenceDelegate.di(),n(r).next(e=>this.referenceDelegate.Ai(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ri(e,t){return Fs.or(Object.values(this.ci).map(n=>()=>n.containsKey(e,t)))}}class nl extends Ls{constructor(e){super(),this.currentSequenceNumber=e}}class rl{constructor(e){this.persistence=e,this.Vi=new Qu,this.mi=null}static fi(e){return new rl(e)}get gi(){if(this.mi)return this.mi;throw Zi(60996)}addReference(e,t,n){return this.Vi.addReference(n,t),this.gi.delete(n.toString()),Fs.resolve()}removeReference(e,t,n){return this.Vi.removeReference(n,t),this.gi.add(n.toString()),Fs.resolve()}markPotentiallyOrphaned(e,t){return this.gi.add(t.toString()),Fs.resolve()}removeTarget(e,t){this.Vi.Hr(t.targetId).forEach(e=>this.gi.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.gi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}di(){this.mi=new Set}Ai(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Fs.forEach(this.gi,n=>{const r=Rs.fromPath(n);return this.pi(e,r).next(e=>{e||t.removeEntry(r,Cs.min())})}).next(()=>(this.mi=null,t.apply(e)))}updateLimboDocument(e,t){return this.pi(e,t).next(e=>{e?this.gi.delete(t.toString()):this.gi.add(t.toString())})}Ii(e){return 0}pi(e,t){return Fs.or([()=>Fs.resolve(this.Vi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ri(e,t)])}}class il{constructor(e,t){this.persistence=e,this.yi=new ja(e=>function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Bs(t)),t=$s(e.get(n),t);return Bs(t)}(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=function(e,t){return new $u(e,t)}(this,t)}static fi(e,t){return new il(e,t)}di(){}Ai(e){return Fs.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}pr(e){const t=this.br(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}br(e){let t=0;return this.yr(e,e=>{t++}).next(()=>t)}yr(e,t){return Fs.forEach(this.yi,(n,r)=>this.Dr(e,n,r).next(e=>e?Fs.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.si(e,r=>this.Dr(e,r,t).next(e=>{e||(n++,i.removeEntry(r,Cs.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.yi.set(t,e.currentSequenceNumber),Fs.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.yi.set(n,e.currentSequenceNumber),Fs.resolve()}removeReference(e,t,n){return this.yi.set(n,e.currentSequenceNumber),Fs.resolve()}updateLimboDocument(e,t){return this.yi.set(t,e.currentSequenceNumber),Fs.resolve()}Ii(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=qo(e.data.value)),t}Dr(e,t,n){return Fs.or([()=>this.persistence.Ri(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.yi.get(t);return Fs.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class sl{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.ds=n,this.As=r}static Rs(e,t){let n=Xa(),r=Xa();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new sl(e,t.fromCache,n,r)}}class ol{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class al{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=S()?8:function(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}(T())>0?6:4}initialize(e,t){this.ys=e,this.indexManager=t,this.Vs=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.ws(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.bs(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;const n=new ol;return this.Ss(e,t,n).next(r=>{if(i.result=r,this.fs)return this.Ds(e,t,n,r.size)})}).next(()=>i.result)}Ds(e,t,n,r){return n.documentReadCount<this.gs?(Gi()<=ee.DEBUG&&Qi("QueryEngine","SDK will not create cache indexes for query:",Ma(t),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),Fs.resolve()):(Gi()<=ee.DEBUG&&Qi("QueryEngine","Query:",Ma(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ps*r?(Gi()<=ee.DEBUG&&Qi("QueryEngine","The SDK decides to create cache indexes for query:",Ma(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ra(t))):Fs.resolve())}ws(e,t){if(xa(t))return Fs.resolve(null);let n=Ra(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=Da(t,null,"F"),n=Ra(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{const i=Xa(...r);return this.ys.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{const s=this.vs(t,r);return this.Cs(t,s,i,n.readTime)?this.ws(e,Da(t,null,"F")):this.Fs(e,s,t,n)}))})))}bs(e,t,n,r){return xa(t)||r.isEqual(Cs.min())?Fs.resolve(null):this.ys.getDocuments(e,n).next(i=>{const s=this.vs(t,i);return this.Cs(t,s,n,r)?Fs.resolve(null):(Gi()<=ee.DEBUG&&Qi("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Ma(t)),this.Fs(e,s,t,function(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=Cs.fromTimestamp(1e9===r?new Ts(n+1,0):new Ts(n,r));return new Ds(i,Rs.empty(),t)}(r,-1)).next(e=>e))})}vs(e,t){let n=new co(Ua(e));return t.forEach((t,r)=>{Fa(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,n){return Gi()<=ee.DEBUG&&Qi("QueryEngine","Using full collection scan to execute query:",Ma(t)),this.ys.getDocumentsMatchingQuery(e,t,Ds.min(),n)}Fs(e,t,n,r){return this.ys.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const cl="LocalStore";class ul{constructor(e,t,n,r){this.persistence=e,this.Ms=t,this.serializer=r,this.xs=new so(ys),this.Os=new ja(e=>Ea(e),Ta),this.Ns=new Map,this.Bs=e.getRemoteDocumentCache(),this.Ti=e.getTargetCache(),this.Ei=e.getBundleCache(),this.Ls(n)}Ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Wu(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.xs))}}async function ll(e,t){const n=ns(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(i=>(r=i,n.Ls(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const i=[],s=[];let o=Xa();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next(e=>({ks:e,removedBatchIds:i,addedBatchIds:s}))})})}function hl(e){const t=ns(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ti.getLastRemoteSnapshotVersion(e))}function dl(e,t){const n=ns(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}async function fl(e,t,n){const r=ns(e),i=r.xs.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!Us(e))throw e;Qi(cl,`Failed to update sequence numbers for target ${t}: ${e}`)}r.xs=r.xs.remove(t),r.Os.delete(i.target)}function pl(e,t,n){const r=ns(e);let i=Cs.min(),s=Xa();return r.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const r=ns(e),i=r.Os.get(n);return void 0!==i?Fs.resolve(r.xs.get(i)):r.Ti.getTargetData(t,n)}(r,e,Ra(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Ti.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.Ms.getDocumentsMatchingQuery(e,t,n?i:Cs.min(),n?s:Xa())).next(e=>(function(e,t,n){let r=e.Ns.get(t)||Cs.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Ns.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,$s:s})))}class gl{constructor(){this.activeTargetIds=Ja}js(e){this.activeTargetIds=this.activeTargetIds.add(e)}Hs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}zs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ml{constructor(){this.xo=new gl,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.xo.js(e),this.Oo[e]||"not-current"}updateQueryState(e,t,n){this.Oo[e]=t}removeLocalQueryTarget(e){this.xo.Hs(e)}isLocalQueryTarget(e){return this.xo.activeTargetIds.has(e)}clearQueryState(e){delete this.Oo[e]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(e){return this.xo.activeTargetIds.has(e)}start(){return this.xo=new gl,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class yl{No(e){}shutdown(){}}const _l="ConnectivityMonitor";class vl{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(e){this.Qo.push(e)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){Qi(_l,"Network connectivity changed: AVAILABLE");for(const e of this.Qo)e(0)}qo(){Qi(_l,"Network connectivity changed: UNAVAILABLE");for(const e of this.Qo)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let wl=null;function bl(){return null===wl?wl=268435456+Math.round(2147483648*Math.random()):wl++,"0x"+wl.toString(16)}const Il="RestConnection",El={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Tl{get Uo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Ko=t+"://"+e.host,this.Wo=`projects/${n}/databases/${r}`,this.Go=this.databaseId.database===ko?`project_id=${n}`:`project_id=${n}&database_id=${r}`}zo(e,t,n,r,i){const s=bl(),o=this.jo(e,t.toUriEncodedString());Qi(Il,`Sending RPC '${e}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(a,r,i);const{host:c}=new URL(o),u=_(c);return this.Jo(e,o,a,n,u).then(t=>(Qi(Il,`Received RPC '${e}' ${s}: `,t),t),t=>{throw Xi(Il,`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t})}Yo(e,t,n,r,i,s){return this.zo(e,t,n,r,i)}Ho(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Hi,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}jo(e,t){const n=El[e];return`${this.Ko}/v1/${t}:${n}`}terminate(){}}class Cl{constructor(e){this.Zo=e.Zo,this.Xo=e.Xo}e_(e){this.t_=e}n_(e){this.r_=e}i_(e){this.s_=e}onMessage(e){this.o_=e}close(){this.Xo()}send(e){this.Zo(e)}__(){this.t_()}a_(){this.r_()}u_(e){this.s_(e)}c_(e){this.o_(e)}}const kl="WebChannelConnection";class Sl extends Tl{constructor(e){super(e),this.l_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,i){const s=bl();return new Promise((i,o)=>{const a=new Di;a.setWithCredentials(!0),a.listenOnce(Li.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Mi.NO_ERROR:const t=a.getResponseJson();Qi(kl,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case Mi.TIMEOUT:Qi(kl,`RPC '${e}' ${s} timed out`),o(new is(rs.DEADLINE_EXCEEDED,"Request time out"));break;case Mi.HTTP_ERROR:const n=a.getStatus();if(Qi(kl,`RPC '${e}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(rs).indexOf(t)>=0?t:rs.UNKNOWN}(t.status);o(new is(e,t.message))}else o(new is(rs.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new is(rs.UNAVAILABLE,"Connection failed."));break;default:Zi(9055,{h_:e,streamId:s,P_:a.getLastErrorCode(),T_:a.getLastError()})}}finally{Qi(kl,`RPC '${e}' ${s} completed.`)}});const c=JSON.stringify(r);Qi(kl,`RPC '${e}' ${s} sending request:`,r),a.send(t,"POST",c,n,15)})}I_(e,t,n){const r=bl(),i=[this.Ko,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=ji(),o=Vi(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Ho(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=i.join("");Qi(kl,`Creating RPC '${e}' stream ${r}: ${u}`,a);const l=s.createWebChannel(u,a);this.E_(l);let h=!1,d=!1;const f=new Cl({Zo:t=>{d?Qi(kl,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(h||(Qi(kl,`Opening RPC '${e}' stream ${r} transport.`),l.open(),h=!0),Qi(kl,`RPC '${e}' stream ${r} sending:`,t),l.send(t))},Xo:()=>l.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(l,Oi.EventType.OPEN,()=>{d||(Qi(kl,`RPC '${e}' stream ${r} transport opened.`),f.__())}),p(l,Oi.EventType.CLOSE,()=>{d||(d=!0,Qi(kl,`RPC '${e}' stream ${r} transport closed`),f.u_(),this.d_(l))}),p(l,Oi.EventType.ERROR,t=>{d||(d=!0,Xi(kl,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),f.u_(new is(rs.UNAVAILABLE,"The operation could not be completed")))}),p(l,Oi.EventType.MESSAGE,t=>{var n;if(!d){const i=t.data[0];ts(!!i,16349);const s=i,o=(null==s?void 0:s.error)||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Qi(kl,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=Lc[e];if(void 0!==t)return Fc(t)}(t),i=o.message;void 0===n&&(n=rs.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,f.u_(new is(n,i)),l.close()}else Qi(kl,`RPC '${e}' stream ${r} received:`,i),f.c_(i)}}),p(o,Ui.STAT_EVENT,t=>{t.stat===Fi.PROXY?Qi(kl,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===Fi.NOPROXY&&Qi(kl,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{f.a_()},0),f}terminate(){this.l_.forEach(e=>e.close()),this.l_=[]}E_(e){this.l_.push(e)}d_(e){this.l_=this.l_.filter(t=>t===e)}}function xl(){return"undefined"!=typeof document?document:null}function Al(e){return new tu(e,!0)}class Nl{constructor(e,t,n=1e3,r=1.5,i=6e4){this.xi=e,this.timerId=t,this.A_=n,this.R_=r,this.V_=i,this.m_=0,this.f_=null,this.g_=Date.now(),this.reset()}reset(){this.m_=0}p_(){this.m_=this.V_}y_(e){this.cancel();const t=Math.floor(this.m_+this.w_()),n=Math.max(0,Date.now()-this.g_),r=Math.max(0,t-n);r>0&&Qi("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.m_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.f_=this.xi.enqueueAfterDelay(this.timerId,r,()=>(this.g_=Date.now(),e())),this.m_*=this.R_,this.m_<this.A_&&(this.m_=this.A_),this.m_>this.V_&&(this.m_=this.V_)}b_(){null!==this.f_&&(this.f_.skipDelay(),this.f_=null)}cancel(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}w_(){return(Math.random()-.5)*this.m_}}const Rl="PersistentStream";class Pl{constructor(e,t,n,r,i,s,o,a){this.xi=e,this.S_=n,this.D_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.v_=0,this.C_=null,this.F_=null,this.stream=null,this.M_=0,this.x_=new Nl(e,t)}O_(){return 1===this.state||5===this.state||this.N_()}N_(){return 2===this.state||3===this.state}start(){this.M_=0,4!==this.state?this.auth():this.B_()}async stop(){this.O_()&&await this.close(0)}L_(){this.state=0,this.x_.reset()}k_(){this.N_()&&null===this.C_&&(this.C_=this.xi.enqueueAfterDelay(this.S_,6e4,()=>this.q_()))}Q_(e){this.U_(),this.stream.send(e)}async q_(){if(this.N_())return this.close(0)}U_(){this.C_&&(this.C_.cancel(),this.C_=null)}K_(){this.F_&&(this.F_.cancel(),this.F_=null)}async close(e,t){this.U_(),this.K_(),this.x_.cancel(),this.v_++,4!==e?this.x_.reset():t&&t.code===rs.RESOURCE_EXHAUSTED?(Yi(t.toString()),Yi("Using maximum backoff delay to prevent overloading the backend."),this.x_.p_()):t&&t.code===rs.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.i_(t)}W_(){}auth(){this.state=1;const e=this.G_(this.v_),t=this.v_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.v_===t&&this.z_(e,n)},t=>{e(()=>{const e=new is(rs.UNKNOWN,"Fetching auth token failed: "+t.message);return this.j_(e)})})}z_(e,t){const n=this.G_(this.v_);this.stream=this.H_(e,t),this.stream.e_(()=>{n(()=>this.listener.e_())}),this.stream.n_(()=>{n(()=>(this.state=2,this.F_=this.xi.enqueueAfterDelay(this.D_,1e4,()=>(this.N_()&&(this.state=3),Promise.resolve())),this.listener.n_()))}),this.stream.i_(e=>{n(()=>this.j_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.M_?this.J_(e):this.onNext(e))})}B_(){this.state=5,this.x_.y_(async()=>{this.state=0,this.start()})}j_(e){return Qi(Rl,`close with error: ${e}`),this.stream=null,this.close(4,e)}G_(e){return t=>{this.xi.enqueueAndForget(()=>this.v_===e?t():(Qi(Rl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Dl extends Pl{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}H_(e,t){return this.connection.I_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.x_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Zi(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(ts(void 0===t||"string"==typeof t,58123),fo.fromBase64String(t||"")):(ts(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),fo.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?rs.UNKNOWN:Fc(e.code);return new is(t,e.message||"")}(o);n=new Kc(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=hu(e,r.document.name),s=ou(r.document.updateTime),o=r.document.createTime?ou(r.document.createTime):Cs.min(),a=new Xo({mapValue:{fields:r.document.fields}}),c=Zo.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new Wc(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=hu(e,r.document),s=r.readTime?ou(r.readTime):Cs.min(),o=Zo.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Wc([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=hu(e,r.document),s=r.removedTargetIds||[];n=new Wc([],s,i,null)}else{if(!("filter"in t))return Zi(11601,{Vt:t});{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new Oc(r,i),o=e.targetId;n=new Hc(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Cs.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Cs.min():t.readTime?ou(t.readTime):Cs.min()}(e);return this.listener.Y_(t,n)}Z_(e){const t={};t.database=fu(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Ca(r)?{documents:mu(e,r)}:{query:yu(e,r).gt},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=iu(e,t.resumeToken);const r=nu(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(Cs.min())>0){n.readTime=ru(e,t.snapshotVersion.toTimestamp());const r=nu(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Zi(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Q_(t)}X_(e){const t={};t.database=fu(this.serializer),t.removeTarget=e,this.Q_(t)}}class Ol extends Pl{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get ea(){return this.M_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.ea&&this.ta([])}H_(e,t){return this.connection.I_("Write",e,t)}J_(e){return ts(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ts(!e.writeResults||0===e.writeResults.length,55816),this.listener.na()}onNext(e){ts(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.x_.reset();const t=function(e,t){return e&&e.length>0?(ts(void 0!==t,14353),e.map(e=>function(e,t){let n=e.updateTime?ou(e.updateTime):ou(t);return n.isEqual(Cs.min())&&(n=ou(t)),new gc(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=ou(e.commitTime);return this.listener.ra(n,t)}ia(){const e={};e.database=fu(this.serializer),this.Q_(e)}ta(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>function(e,t){let n;if(t instanceof Tc)n={update:gu(e,t.key,t.value)};else if(t instanceof Ac)n={delete:lu(e,t.key)};else if(t instanceof Cc)n={update:gu(e,t.key,t.data),updateMask:ku(t.fieldMask)};else{if(!(t instanceof Nc))return Zi(16599,{ft:t.type});n={verify:lu(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof oc)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ac)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof uc)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof hc)return{fieldPath:t.field.canonicalString(),increment:n.Re};throw Zi(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:su(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Zi(27497)}(e,t.precondition)),n}(this.serializer,e))};this.Q_(t)}}class Ll{}class Ml extends Ll{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.sa=!1}oa(){if(this.sa)throw new is(rs.FAILED_PRECONDITION,"The client has already been terminated.")}zo(e,t,n,r){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.zo(e,cu(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===rs.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new is(rs.UNKNOWN,e.toString())})}Yo(e,t,n,r,i){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Yo(e,cu(t,n),r,s,o,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===rs.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new is(rs.UNKNOWN,e.toString())})}terminate(){this.sa=!0,this.connection.terminate()}}class Fl{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this._a=0,this.aa=null,this.ua=!0}ca(){0===this._a&&(this.la("Unknown"),this.aa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.aa=null,this.ha("Backend didn't respond within 10 seconds."),this.la("Offline"),Promise.resolve())))}Pa(e){"Online"===this.state?this.la("Unknown"):(this._a++,this._a>=1&&(this.Ta(),this.ha(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.la("Offline")))}set(e){this.Ta(),this._a=0,"Online"===e&&(this.ua=!1),this.la(e)}la(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ha(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ua?(Yi(t),this.ua=!1):Qi("OnlineStateTracker",t)}Ta(){null!==this.aa&&(this.aa.cancel(),this.aa=null)}}const Ul="RemoteStore";class Vl{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ia=[],this.Ea=new Map,this.da=new Set,this.Aa=[],this.Ra=i,this.Ra.No(e=>{n.enqueueAndForget(async()=>{Gl(this)&&(Qi(Ul,"Restarting streams for network reachability change."),await async function(e){const t=ns(e);t.da.add(4),await ql(t),t.Va.set("Unknown"),t.da.delete(4),await jl(t)}(this))})}),this.Va=new Fl(n,r)}}async function jl(e){if(Gl(e))for(const t of e.Aa)await t(!0)}async function ql(e){for(const t of e.Aa)await t(!1)}function $l(e,t){const n=ns(e);n.Ea.has(t.targetId)||(n.Ea.set(t.targetId,t),Kl(n)?Hl(n):dh(n).N_()&&zl(n,t))}function Bl(e,t){const n=ns(e),r=dh(n);n.Ea.delete(t),r.N_()&&Wl(n,t),0===n.Ea.size&&(r.N_()?r.k_():Gl(n)&&n.Va.set("Unknown"))}function zl(e,t){if(e.ma.Ke(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Cs.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}dh(e).Z_(t)}function Wl(e,t){e.ma.Ke(t),dh(e).X_(t)}function Hl(e){e.ma=new Qc({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Rt:t=>e.Ea.get(t)||null,Pt:()=>e.datastore.serializer.databaseId}),dh(e).start(),e.Va.ca()}function Kl(e){return Gl(e)&&!dh(e).O_()&&e.Ea.size>0}function Gl(e){return 0===ns(e).da.size}function Ql(e){e.ma=void 0}async function Yl(e){e.Va.set("Online")}async function Xl(e){e.Ea.forEach((t,n)=>{zl(e,t)})}async function Jl(e,t){Ql(e),Kl(e)?(e.Va.Pa(t),Hl(e)):e.Va.set("Unknown")}async function Zl(e,t,n){if(e.Va.set("Online"),t instanceof Kc&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Ea.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ea.delete(r),e.ma.removeTarget(r))}(e,t)}catch(n){Qi(Ul,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await eh(e,n)}else if(t instanceof Wc?e.ma.Xe(t):t instanceof Hc?e.ma.ot(t):e.ma.nt(t),!n.isEqual(Cs.min()))try{const t=await hl(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.ma.It(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Ea.get(r);i&&e.Ea.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const r=e.Ea.get(t);if(!r)return;e.Ea.set(t,r.withResumeToken(fo.EMPTY_BYTE_STRING,r.snapshotVersion)),Wl(e,t);const i=new xu(r.target,t,n,r.sequenceNumber);zl(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Qi(Ul,"Failed to raise snapshot:",t),await eh(e,t)}}async function eh(e,t,n){if(!Us(t))throw t;e.da.add(1),await ql(e),e.Va.set("Offline"),n||(n=()=>hl(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{Qi(Ul,"Retrying IndexedDB access"),await n(),e.da.delete(1),await jl(e)})}function th(e,t){return t().catch(n=>eh(e,n,t))}async function nh(e){const t=ns(e),n=fh(t);let r=t.Ia.length>0?t.Ia[t.Ia.length-1].batchId:-1;for(;rh(t);)try{const e=await dl(t.localStore,r);if(null===e){0===t.Ia.length&&n.k_();break}r=e.batchId,ih(t,e)}catch(e){await eh(t,e)}sh(t)&&oh(t)}function rh(e){return Gl(e)&&e.Ia.length<10}function ih(e,t){e.Ia.push(t);const n=fh(e);n.N_()&&n.ea&&n.ta(t.mutations)}function sh(e){return Gl(e)&&!fh(e).O_()&&e.Ia.length>0}function oh(e){fh(e).start()}async function ah(e){fh(e).ia()}async function ch(e){const t=fh(e);for(const n of e.Ia)t.ta(n.mutations)}async function uh(e,t,n){const r=e.Ia.shift(),i=Pc.from(r,t,n);await th(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await nh(e)}async function lh(e,t){t&&fh(e).ea&&await async function(e,t){if(function(e){return function(e){switch(e){case rs.OK:return Zi(64938);case rs.CANCELLED:case rs.UNKNOWN:case rs.DEADLINE_EXCEEDED:case rs.RESOURCE_EXHAUSTED:case rs.INTERNAL:case rs.UNAVAILABLE:case rs.UNAUTHENTICATED:return!1;case rs.INVALID_ARGUMENT:case rs.NOT_FOUND:case rs.ALREADY_EXISTS:case rs.PERMISSION_DENIED:case rs.FAILED_PRECONDITION:case rs.ABORTED:case rs.OUT_OF_RANGE:case rs.UNIMPLEMENTED:case rs.DATA_LOSS:return!0;default:return Zi(15467,{code:e})}}(e)&&e!==rs.ABORTED}(t.code)){const n=e.Ia.shift();fh(e).L_(),await th(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await nh(e)}}(e,t),sh(e)&&oh(e)}async function hh(e,t){const n=ns(e);n.asyncQueue.verifyOperationInProgress(),Qi(Ul,"RemoteStore received new credentials");const r=Gl(n);n.da.add(3),await ql(n),r&&n.Va.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.da.delete(3),await jl(n)}function dh(e){return e.fa||(e.fa=function(e,t,n){const r=ns(e);return r.oa(),new Dl(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{e_:Yl.bind(null,e),n_:Xl.bind(null,e),i_:Jl.bind(null,e),Y_:Zl.bind(null,e)}),e.Aa.push(async t=>{t?(e.fa.L_(),Kl(e)?Hl(e):e.Va.set("Unknown")):(await e.fa.stop(),Ql(e))})),e.fa}function fh(e){return e.ga||(e.ga=function(e,t,n){const r=ns(e);return r.oa(),new Ol(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{e_:()=>Promise.resolve(),n_:ah.bind(null,e),i_:lh.bind(null,e),na:ch.bind(null,e),ra:uh.bind(null,e)}),e.Aa.push(async t=>{t?(e.ga.L_(),await nh(e)):(await e.ga.stop(),e.Ia.length>0&&(Qi(Ul,`Stopping write stream with ${e.Ia.length} pending writes`),e.Ia=[]))})),e.ga}class ph{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ss,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new ph(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new is(rs.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function gh(e,t){if(Yi("AsyncQueue",`${t}: ${e}`),Us(e))return new is(rs.UNAVAILABLE,`${t}: ${e}`);throw e}class mh{static emptySet(e){return new mh(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||Rs.comparator(t.key,n.key):(e,t)=>Rs.comparator(e.key,t.key),this.keyedMap=za(),this.sortedSet=new so(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof mh))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new mh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class yh{constructor(){this.pa=new so(Rs.comparator)}track(e){const t=e.doc.key,n=this.pa.get(t);n?0!==e.type&&3===n.type?this.pa=this.pa.insert(t,e):3===e.type&&1!==n.type?this.pa=this.pa.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.pa=this.pa.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.pa=this.pa.remove(t):1===e.type&&2===n.type?this.pa=this.pa.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):Zi(63341,{Vt:e,ya:n}):this.pa=this.pa.insert(t,e)}wa(){const e=[];return this.pa.inorderTraversal((t,n)=>{e.push(n)}),e}}class _h{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new _h(e,t,mh.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Oa(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class vh{constructor(){this.ba=void 0,this.Sa=[]}Da(){return this.Sa.some(e=>e.va())}}class wh{constructor(){this.queries=bh(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=ns(e),r=n.queries;n.queries=bh(),r.forEach((e,n)=>{for(const e of n.Sa)e.onError(t)})}(this,new is(rs.ABORTED,"Firestore shutting down"))}}function bh(){return new ja(e=>La(e),Oa)}async function Ih(e,t){const n=ns(e);let r=3;const i=t.query;let s=n.queries.get(i);s?!s.Da()&&t.va()&&(r=2):(s=new vh,r=t.va()?0:1);try{switch(r){case 0:s.ba=await n.onListen(i,!0);break;case 1:s.ba=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=gh(e,`Initialization of query '${Ma(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,s),s.Sa.push(t),t.Fa(n.onlineState),s.ba&&t.Ma(s.ba)&&kh(n)}async function Eh(e,t){const n=ns(e),r=t.query;let i=3;const s=n.queries.get(r);if(s){const e=s.Sa.indexOf(t);e>=0&&(s.Sa.splice(e,1),0===s.Sa.length?i=t.va()?0:1:!s.Da()&&t.va()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function Th(e,t){const n=ns(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.Sa)t.Ma(e)&&(r=!0);i.ba=e}}r&&kh(n)}function Ch(e,t,n){const r=ns(e),i=r.queries.get(t);if(i)for(const e of i.Sa)e.onError(n);r.queries.delete(t)}function kh(e){e.Ca.forEach(e=>{e.next()})}var Sh,xh;(xh=Sh||(Sh={})).xa="default",xh.Cache="cache";class Ah{constructor(e,t,n){this.query=e,this.Oa=t,this.Na=!1,this.Ba=null,this.onlineState="Unknown",this.options=n||{}}Ma(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new _h(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Na?this.La(e)&&(this.Oa.next(e),t=!0):this.ka(e,this.onlineState)&&(this.qa(e),t=!0),this.Ba=e,t}onError(e){this.Oa.error(e)}Fa(e){this.onlineState=e;let t=!1;return this.Ba&&!this.Na&&this.ka(this.Ba,e)&&(this.qa(this.Ba),t=!0),t}ka(e,t){if(!e.fromCache)return!0;if(!this.va())return!0;const n="Offline"!==t;return(!this.options.Qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}La(e){if(e.docChanges.length>0)return!0;const t=this.Ba&&this.Ba.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}qa(e){e=_h.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Na=!0,this.Oa.next(e)}va(){return this.options.source!==Sh.Cache}}class Nh{constructor(e){this.key=e}}class Rh{constructor(e){this.key=e}}class Ph{constructor(e,t){this.query=e,this.Ha=t,this.Ja=null,this.hasCachedResults=!1,this.current=!1,this.Ya=Xa(),this.mutatedKeys=Xa(),this.Za=Ua(e),this.Xa=new mh(this.Za)}get eu(){return this.Ha}tu(e,t){const n=t?t.nu:new yh,r=t?t.Xa:this.Xa;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const u=r.get(e),l=Fa(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.ru(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.Za(l,a)>0||c&&this.Za(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Xa:s,nu:n,Cs:o,mutatedKeys:i}}ru(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.Xa;this.Xa=e.Xa,this.mutatedKeys=e.mutatedKeys;const s=e.nu.wa();s.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Zi(20277,{Vt:e})}};return n(e)-n(t)}(e.type,t.type)||this.Za(e.doc,t.doc)),this.iu(n),r=null!=r&&r;const o=t&&!r?this.su():[],a=0===this.Ya.size&&this.current&&!r?1:0,c=a!==this.Ja;return this.Ja=a,0!==s.length||c?{snapshot:new _h(this.query,e.Xa,i,s,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),ou:o}:{ou:o}}Fa(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Xa:this.Xa,nu:new yh,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ou:[]}}_u(e){return!this.Ha.has(e)&&!!this.Xa.has(e)&&!this.Xa.get(e).hasLocalMutations}iu(e){e&&(e.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=e.current)}su(){if(!this.current)return[];const e=this.Ya;this.Ya=Xa(),this.Xa.forEach(e=>{this._u(e.key)&&(this.Ya=this.Ya.add(e.key))});const t=[];return e.forEach(e=>{this.Ya.has(e)||t.push(new Rh(e))}),this.Ya.forEach(n=>{e.has(n)||t.push(new Nh(n))}),t}au(e){this.Ha=e.$s,this.Ya=Xa();const t=this.tu(e.documents);return this.applyChanges(t,!0)}uu(){return _h.fromInitialDocuments(this.query,this.Xa,this.mutatedKeys,0===this.Ja,this.hasCachedResults)}}const Dh="SyncEngine";class Oh{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Lh{constructor(e){this.key=e,this.cu=!1}}class Mh{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.lu={},this.hu=new ja(e=>La(e),Oa),this.Pu=new Map,this.Tu=new Set,this.Iu=new so(Rs.comparator),this.Eu=new Map,this.du=new Qu,this.Au={},this.Ru=new Map,this.Vu=Fu.lr(),this.onlineState="Unknown",this.mu=void 0}get isPrimaryClient(){return!0===this.mu}}async function Fh(e,t,n=!0){const r=rd(e);let i;const s=r.hu.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.uu()):i=await Vh(r,t,n,!0),i}async function Uh(e,t){const n=rd(e);await Vh(n,t,!0,!1)}async function Vh(e,t,n,r){const i=await function(e,t){const n=ns(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.Ti.getTargetData(e,t).next(i=>i?(r=i,Fs.resolve(r)):n.Ti.allocateTargetId(e).next(i=>(r=new xu(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Ti.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.xs.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.xs=n.xs.insert(e.targetId,e),n.Os.set(t,e.targetId)),e})}(e.localStore,Ra(t)),s=i.targetId,o=e.sharedClientState.addLocalQueryTarget(s,n);let a;return r&&(a=await async function(e,t,n,r,i){e.fu=(t,n,r)=>async function(e,t,n,r){let i=t.view.tu(n);i.Cs&&(i=await pl(e.localStore,t.query,!1).then(({documents:e})=>t.view.tu(e,i)));const s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s,o);return Xh(e,t.targetId,a.ou),a.snapshot}(e,t,n,r);const s=await pl(e.localStore,t,!0),o=new Ph(t,s.$s),a=o.tu(s.documents),c=zc.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);Xh(e,n,u.ou);const l=new Oh(t,n,o);return e.hu.set(t,l),e.Pu.has(n)?e.Pu.get(n).push(t):e.Pu.set(n,[t]),u.snapshot}(e,t,s,"current"===o,i.resumeToken)),e.isPrimaryClient&&n&&$l(e.remoteStore,i),a}async function jh(e,t,n){const r=ns(e),i=r.hu.get(t),s=r.Pu.get(i.targetId);if(s.length>1)return r.Pu.set(i.targetId,s.filter(e=>!Oa(e,t))),void r.hu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await fl(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Bl(r.remoteStore,i.targetId),Qh(r,i.targetId)}).catch(Ms)):(Qh(r,i.targetId),await fl(r.localStore,i.targetId,!0))}async function qh(e,t){const n=ns(e),r=n.hu.get(t),i=n.Pu.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Bl(n.remoteStore,r.targetId))}async function $h(e,t){const n=ns(e);try{const e=await function(e,t){const n=ns(e),r=t.snapshotVersion;let i=n.xs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=n.Bs.newChangeBuffer({trackRemovals:!0});i=n.xs;const o=[];t.targetChanges.forEach((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Ti.removeMatchingKeys(e,s.removedDocuments,a).next(()=>n.Ti.addMatchingKeys(e,s.addedDocuments,a)));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(fo.EMPTY_BYTE_STRING,Cs.min()).withLastLimboFreeSnapshotVersion(Cs.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Ti.updateTargetData(e,u))});let a=$a(),c=Xa();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(function(e,t,n){let r=Xa(),i=Xa();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=$a();return n.forEach((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(Cs.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):Qi(cl,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)}),{qs:r,Qs:i}})}(e,s,t.documentUpdates).next(e=>{a=e.qs,c=e.Qs})),!r.isEqual(Cs.min())){const t=n.Ti.getLastRemoteSnapshotVersion(e).next(t=>n.Ti.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return Fs.waitFor(o).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,a,c)).next(()=>a)}).then(e=>(n.xs=i,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Eu.get(t);r&&(ts(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?r.cu=!0:e.modifiedDocuments.size>0?ts(r.cu,14607):e.removedDocuments.size>0&&(ts(r.cu,42227),r.cu=!1))}),await ed(n,e,t)}catch(e){await Ms(e)}}function Bh(e,t,n){const r=ns(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.hu.forEach((n,r)=>{const i=r.view.Fa(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=ns(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const e of n.Sa)e.Fa(t)&&(r=!0)}),r&&kh(n)}(r.eventManager,t),e.length&&r.lu.Y_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function zh(e,t,n){const r=ns(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Eu.get(t),s=i&&i.key;if(s){let e=new so(Rs.comparator);e=e.insert(s,Zo.newNoDocument(s,Cs.min()));const n=Xa().add(s),i=new Bc(Cs.min(),new Map,new so(ys),e,n);await $h(r,i),r.Iu=r.Iu.remove(s),r.Eu.delete(t),Zh(r)}else await fl(r.localStore,t,!1).then(()=>Qh(r,t,n)).catch(Ms)}async function Wh(e,t){const n=ns(e),r=t.batch.batchId;try{const e=await function(e,t){const n=ns(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),i=n.Bs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=Fs.resolve();return s.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{const s=n.docVersions.get(e);ts(null!==s,48541),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Xa();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))})}(n.localStore,t);Gh(n,r,null),Kh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await ed(n,e)}catch(e){await Ms(e)}}async function Hh(e,t,n){const r=ns(e);try{const e=await function(e,t){const n=ns(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(ts(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}(r.localStore,t);Gh(r,t,n),Kh(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await ed(r,e)}catch(n){await Ms(n)}}function Kh(e,t){(e.Ru.get(t)||[]).forEach(e=>{e.resolve()}),e.Ru.delete(t)}function Gh(e,t,n){const r=ns(e);let i=r.Au[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Au[r.currentUser.toKey()]=i}}function Qh(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Pu.get(t))e.hu.delete(r),n&&e.lu.gu(r,n);e.Pu.delete(t),e.isPrimaryClient&&e.du.Hr(t).forEach(t=>{e.du.containsKey(t)||Yh(e,t)})}function Yh(e,t){e.Tu.delete(t.path.canonicalString());const n=e.Iu.get(t);null!==n&&(Bl(e.remoteStore,n),e.Iu=e.Iu.remove(t),e.Eu.delete(n),Zh(e))}function Xh(e,t,n){for(const r of n)r instanceof Nh?(e.du.addReference(r.key,t),Jh(e,r)):r instanceof Rh?(Qi(Dh,"Document no longer in limbo: "+r.key),e.du.removeReference(r.key,t),e.du.containsKey(r.key)||Yh(e,r.key)):Zi(19791,{pu:r})}function Jh(e,t){const n=t.key,r=n.path.canonicalString();e.Iu.get(n)||e.Tu.has(r)||(Qi(Dh,"New document in limbo: "+n),e.Tu.add(r),Zh(e))}function Zh(e){for(;e.Tu.size>0&&e.Iu.size<e.maxConcurrentLimboResolutions;){const t=e.Tu.values().next().value;e.Tu.delete(t);const n=new Rs(xs.fromString(t)),r=e.Vu.next();e.Eu.set(r,new Lh(n)),e.Iu=e.Iu.insert(n,r),$l(e.remoteStore,new xu(Ra(Sa(n.path)),r,"TargetPurposeLimboResolution",Vs.le))}}async function ed(e,t,n){const r=ns(e),i=[],s=[],o=[];r.hu.isEmpty()||(r.hu.forEach((e,a)=>{o.push(r.fu(a,t,n).then(e=>{var t;if((e||n)&&r.isPrimaryClient){const i=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(e){i.push(e);const t=sl.Rs(a.targetId,e);s.push(t)}}))}),await Promise.all(o),r.lu.Y_(i),await async function(e,t){const n=ns(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Fs.forEach(t,t=>Fs.forEach(t.ds,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>Fs.forEach(t.As,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(!Us(e))throw e;Qi(cl,"Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.xs.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.xs=n.xs.insert(t,i)}}}(r.localStore,s))}async function td(e,t){const n=ns(e);if(!n.currentUser.isEqual(t)){Qi(Dh,"User change. New user:",t.toKey());const e=await ll(n.localStore,t);n.currentUser=t,function(e){e.Ru.forEach(e=>{e.forEach(e=>{e.reject(new is(rs.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Ru.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await ed(n,e.ks)}}function nd(e,t){const n=ns(e),r=n.Eu.get(t);if(r&&r.cu)return Xa().add(r.key);{let e=Xa();const r=n.Pu.get(t);if(!r)return e;for(const t of r){const r=n.hu.get(t);e=e.unionWith(r.view.eu)}return e}}function rd(e){const t=ns(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=$h.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=nd.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=zh.bind(null,t),t.lu.Y_=Th.bind(null,t.eventManager),t.lu.gu=Ch.bind(null,t.eventManager),t}function id(e){const t=ns(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Wh.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Hh.bind(null,t),t}class sd{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Al(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Su(e),await this.persistence.start(),this.localStore=this.Du(e),this.gcScheduler=this.vu(e,this.localStore),this.indexBackfillerScheduler=this.Cu(e,this.localStore)}vu(e,t){return null}Cu(e,t){return null}Du(e){return function(e,t,n,r){return new ul(e,t,n,r)}(this.persistence,new al,e.initialUser,this.serializer)}Su(e){return new tl(rl.fi,this.serializer)}bu(e){return new ml}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}sd.provider={build:()=>new sd};class od extends sd{constructor(e){super(),this.cacheSizeBytes=e}vu(e,t){ts(this.persistence.referenceDelegate instanceof il,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new qu(n,e.asyncQueue,t)}Su(e){const t=void 0!==this.cacheSizeBytes?Mu.withCacheSize(this.cacheSizeBytes):Mu.DEFAULT;return new tl(e=>il.fi(e,t),this.serializer)}}class ad{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Bh(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=td.bind(null,this.syncEngine),await async function(e,t){const n=ns(e);t?(n.da.delete(2),await jl(n)):t||(n.da.add(2),await ql(n),n.Va.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new wh}createDatastore(e){const t=Al(e.databaseInfo.databaseId),n=function(e){return new Sl(e)}(e.databaseInfo);return function(e,t,n,r){return new Ml(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new Vl(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,e=>Bh(this.syncEngine,e,0),vl.C()?new vl:new yl)}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Mh(e,t,n,r,i,s);return o&&(a.mu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=ns(e);Qi(Ul,"RemoteStore shutting down."),t.da.add(5),await ql(t),t.Ra.shutdown(),t.Va.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}ad.provider={build:()=>new ad};class cd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Mu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Mu(this.observer.error,e):Yi("Uncaught Error in snapshot listener:",e.toString()))}xu(){this.muted=!0}Mu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const ud="FirestoreClient";class ld{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Wi.UNAUTHENTICATED,this.clientId=ms.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{Qi(ud,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(Qi(ud,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ss;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=gh(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function hd(e,t){e.asyncQueue.verifyOperationInProgress(),Qi(ud,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await ll(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function dd(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Qi(ud,"Using user provided OfflineComponentProvider");try{await hd(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===rs.FAILED_PRECONDITION||e.code===rs.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;Xi("Error using user provided cache. Falling back to memory cache: "+n),await hd(e,new sd)}}else Qi(ud,"Using default OfflineComponentProvider"),await hd(e,new od(void 0));return e._offlineComponents}(e);Qi(ud,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>hh(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>hh(t.remoteStore,n)),e._onlineComponents=t}async function fd(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Qi(ud,"Using user provided OnlineComponentProvider"),await dd(e,e._uninitializedComponentsProvider._online)):(Qi(ud,"Using default OnlineComponentProvider"),await dd(e,new ad))),e._onlineComponents}async function pd(e){const t=await fd(e),n=t.eventManager;return n.onListen=Fh.bind(null,t.syncEngine),n.onUnlisten=jh.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Uh.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=qh.bind(null,t.syncEngine),n}function gd(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const md=new Map;function yd(e,t,n){if(!n)throw new is(rs.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function _d(e){if(!Rs.isDocumentKey(e))throw new is(rs.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function vd(e){if(Rs.isDocumentKey(e))throw new is(rs.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function wd(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Zi(12329,{type:typeof e})}function bd(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new is(rs.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=wd(e);throw new is(rs.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}const Id="firestore.googleapis.com",Ed=!0;class Td{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new is(rs.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Id,this.ssl=Ed}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:Ed;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=Lu;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new is(rs.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new is(rs.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=gd(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new is(rs.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new is(rs.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new is(rs.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Cd{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Td({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new is(rs.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new is(rs.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Td(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new as;switch(e.type){case"firstParty":return new hs(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new is(rs.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=md.get(e);t&&(Qi("ComponentProvider","Removing Datastore"),md.delete(e),t.terminate())}(this),Promise.resolve()}}class kd{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new kd(this.firestore,e,this._query)}}class Sd{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new xd(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Sd(this.firestore,e,this._key)}}class xd extends kd{constructor(e,t,n){super(e,t,Sa(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Sd(this.firestore,null,new Rs(e))}withConverter(e){return new xd(this.firestore,e,this._path)}}function Ad(e,t,...n){if(e=G(e),yd("collection","path",t),e instanceof Cd){const r=xs.fromString(t,...n);return vd(r),new xd(e,null,r)}{if(!(e instanceof Sd||e instanceof xd))throw new is(rs.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(xs.fromString(t,...n));return vd(r),new xd(e.firestore,null,r)}}function Nd(e,t,...n){if(e=G(e),1===arguments.length&&(t=ms.newId()),yd("doc","path",t),e instanceof Cd){const r=xs.fromString(t,...n);return _d(r),new Sd(e,null,new Rs(r))}{if(!(e instanceof Sd||e instanceof xd))throw new is(rs.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(xs.fromString(t,...n));return _d(r),new Sd(e.firestore,e instanceof xd?e.converter:null,new Rs(r))}}const Rd="AsyncQueue";class Pd{constructor(e=Promise.resolve()){this.Ju=[],this.Yu=!1,this.Zu=[],this.Xu=null,this.ec=!1,this.tc=!1,this.nc=[],this.x_=new Nl(this,"async_queue_retry"),this.rc=()=>{const e=xl();e&&Qi(Rd,"Visibility state changed to "+e.visibilityState),this.x_.b_()},this.sc=e;const t=xl();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.rc)}get isShuttingDown(){return this.Yu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.oc(),this._c(e)}enterRestrictedMode(e){if(!this.Yu){this.Yu=!0,this.tc=e||!1;const t=xl();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.rc)}}enqueue(e){if(this.oc(),this.Yu)return new Promise(()=>{});const t=new ss;return this._c(()=>this.Yu&&this.tc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ju.push(e),this.ac()))}async ac(){if(0!==this.Ju.length){try{await this.Ju[0](),this.Ju.shift(),this.x_.reset()}catch(e){if(!Us(e))throw e;Qi(Rd,"Operation failed with retryable error: "+e)}this.Ju.length>0&&this.x_.y_(()=>this.ac())}}_c(e){const t=this.sc.then(()=>(this.ec=!0,e().catch(e=>{throw this.Xu=e,this.ec=!1,Yi("INTERNAL UNHANDLED ERROR: ",Dd(e)),e}).then(e=>(this.ec=!1,e))));return this.sc=t,t}enqueueAfterDelay(e,t,n){this.oc(),this.nc.indexOf(e)>-1&&(t=0);const r=ph.createAndSchedule(this,e,t,n,e=>this.uc(e));return this.Zu.push(r),r}oc(){this.Xu&&Zi(47125,{cc:Dd(this.Xu)})}verifyOperationInProgress(){}async lc(){let e;do{e=this.sc,await e}while(e!==this.sc)}hc(e){for(const t of this.Zu)if(t.timerId===e)return!0;return!1}Pc(e){return this.lc().then(()=>{this.Zu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.Zu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.lc()})}Tc(e){this.nc.push(e)}uc(e){const t=this.Zu.indexOf(e);this.Zu.splice(t,1)}}function Dd(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class Od extends Cd{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Pd,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Pd(e),this._firestoreClient=void 0,await e}}}function Ld(e){if(e._terminated)throw new is(rs.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new Co(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,gd(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new ld(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class Md{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Md(fo.fromBase64String(e))}catch(e){throw new is(rs.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Md(fo.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Fd{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new is(rs.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ns(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Ud{constructor(e){this._methodName=e}}class Vd{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new is(rs.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new is(rs.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ys(this._lat,e._lat)||ys(this._long,e._long)}}class jd{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const qd=/^__.*__$/;class $d{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Cc(e,this.data,this.fieldMask,t,this.fieldTransforms):new Tc(e,this.data,t,this.fieldTransforms)}}class Bd{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Cc(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function zd(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Zi(40011,{Ic:e})}}class Wd{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Ec(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ic(){return this.settings.Ic}dc(e){return new Wd(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ac(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.dc({path:n,Rc:!1});return r.Vc(e),r}mc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.dc({path:n,Rc:!1});return r.Ec(),r}fc(e){return this.dc({path:void 0,Rc:!0})}gc(e){return of(e,this.settings.methodName,this.settings.yc||!1,this.path,this.settings.wc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Ec(){if(this.path)for(let e=0;e<this.path.length;e++)this.Vc(this.path.get(e))}Vc(e){if(0===e.length)throw this.gc("Document fields must not be empty");if(zd(this.Ic)&&qd.test(e))throw this.gc('Document fields cannot begin and end with "__"')}}class Hd{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Al(e)}bc(e,t,n,r=!1){return new Wd({Ic:e,methodName:t,wc:n,path:Ns.emptyPath(),Rc:!1,yc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Kd(e){const t=e._freezeSettings(),n=Al(e._databaseId);return new Hd(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Gd(e,t,n,r,i,s={}){const o=e.bc(s.merge||s.mergeFields?2:0,t,n,i);tf("Data must be an object, but it was:",o,r);const a=Zd(r,o);let c,u;if(s.merge)c=new lo(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=nf(t,r,n);if(!o.contains(i))throw new is(rs.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);af(e,i)||e.push(i)}c=new lo(e),u=o.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,u=o.fieldTransforms;return new $d(new Xo(a),c,u)}class Qd extends Ud{_toFieldTransform(e){if(2!==e.Ic)throw 1===e.Ic?e.gc(`${this._methodName}() can only appear at the top level of your update data`):e.gc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Qd}}class Yd extends Ud{_toFieldTransform(e){return new pc(e.path,new oc)}isEqual(e){return e instanceof Yd}}function Xd(e,t,n,r=!1){return Jd(n,e.bc(r?4:3,t))}function Jd(e,t){if(ef(e=G(e)))return tf("Unsupported field value:",t,e),Zd(e,t);if(e instanceof Ud)return function(e,t){if(!zd(t.Ic))throw t.gc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.gc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Rc&&4!==t.Ic)throw t.gc("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Jd(i,t.fc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=G(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return tc(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Ts.fromDate(e);return{timestampValue:ru(t.serializer,n)}}if(e instanceof Ts){const n=new Ts(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ru(t.serializer,n)}}if(e instanceof Vd)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Md)return{bytesValue:iu(t.serializer,e._byteString)};if(e instanceof Sd){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.gc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:au(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof jd)return function(e,t){return{mapValue:{fields:{[xo]:{stringValue:Ro},[Po]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.gc("VectorValues must only contain numeric values.");return Za(t.serializer,e)})}}}}}}(e,t);throw t.gc(`Unsupported field value: ${wd(e)}`)}(e,t)}function Zd(e,t){const n={};return io(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ro(e,(e,r)=>{const i=Jd(r,t.Ac(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function ef(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Ts||e instanceof Vd||e instanceof Md||e instanceof Sd||e instanceof Ud||e instanceof jd)}function tf(e,t,n){if(!ef(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=wd(n);throw"an object"===r?t.gc(e+" a custom object"):t.gc(e+" "+r)}}function nf(e,t,n){if((t=G(t))instanceof Fd)return t._internalPath;if("string"==typeof t)return sf(e,t);throw of("Field path arguments must be of type string or ",e,!1,void 0,n)}const rf=new RegExp("[~\\*/\\[\\]]");function sf(e,t,n){if(t.search(rf)>=0)throw of(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Fd(...t.split("."))._internalPath}catch(r){throw of(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function of(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new is(rs.INVALID_ARGUMENT,a+e+c)}function af(e,t){return e.some(e=>e.isEqual(t))}class cf{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Sd(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new uf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(lf("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class uf extends cf{data(){return super.data()}}function lf(e,t){return"string"==typeof t?sf(e,t):t instanceof Fd?t._internalPath:t._delegate._internalPath}class hf{}class df extends hf{}function ff(e,t,...n){let r=[];t instanceof hf&&r.push(t),r=r.concat(n),function(e){const t=e.filter(e=>e instanceof mf).length,n=e.filter(e=>e instanceof pf).length;if(t>1||t>0&&n>0)throw new is(rs.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class pf extends df{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new pf(e,t,n)}_apply(e){const t=this._parse(e);return Cf(e._query,t),new kd(e.firestore,e.converter,Pa(e._query,t))}_parse(e){const t=Kd(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new is(rs.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Tf(o,s);const t=[];for(const n of o)t.push(Ef(r,e,n));a={arrayValue:{values:t}}}else a=Ef(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Tf(o,s),a=Xd(n,"where",o,"in"===s||"not-in"===s);return oa.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function gf(e,t,n){const r=t,i=lf("where",e);return pf._create(i,r,n)}class mf extends hf{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new mf(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:aa.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)Cf(n,e),n=Pa(n,e)}(e._query,t),new kd(e.firestore,e.converter,Pa(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class yf extends df{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new yf(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new is(rs.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new is(rs.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ra(t,n)}(e._query,this._field,this._direction);return new kd(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new ka(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function _f(e,t="asc"){const n=t,r=lf("orderBy",e);return yf._create(r,n)}class vf extends df{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new vf(e,t,n)}_apply(e){return new kd(e.firestore,e.converter,Da(e._query,this._limit,this._limitType))}}function wf(e){return function(e,t){if(t<=0)throw new is(rs.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}("limit",e),vf._create("limit",e,"F")}class bf extends df{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new bf(e,t,n)}_apply(e){const t=function(e,t,n,r){if(n[0]=G(n[0]),n[0]instanceof cf)return function(e,t,n,r,i){if(!r)throw new is(rs.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of Na(e))if(n.field.isKeyField())s.push($o(t,r.key));else{const e=r.data.field(n.field);if(Io(e))throw new is(rs.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new is(rs.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new ea(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=Kd(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new is(rs.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<i.length;s++){const c=i[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new is(rs.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Aa(e)&&-1!==c.indexOf("/"))throw new is(rs.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(xs.fromString(c));if(!Rs.isDocumentKey(n))throw new is(rs.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new Rs(n);a.push($o(t,i))}else{const e=Xd(n,r,c);a.push(e)}}return new ea(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}(e,this.type,this._docOrFields,this._inclusive);return new kd(e.firestore,e.converter,function(e,t){return new ka(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}function If(...e){return bf._create("startAfter",e,!1)}function Ef(e,t,n){if("string"==typeof(n=G(n))){if(""===n)throw new is(rs.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Aa(t)&&-1!==n.indexOf("/"))throw new is(rs.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(xs.fromString(n));if(!Rs.isDocumentKey(r))throw new is(rs.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return $o(e,new Rs(r))}if(n instanceof Sd)return $o(e,n._key);throw new is(rs.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${wd(n)}.`)}function Tf(e,t){if(!Array.isArray(e)||0===e.length)throw new is(rs.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Cf(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new is(rs.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new is(rs.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class kf{convertValue(e,t="none"){switch(Do(e)){case 0:return null;case 1:return e.booleanValue;case 2:return mo(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(yo(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Zi(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return ro(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,r;const i=null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t[Po].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map(e=>mo(e.doubleValue));return new jd(i)}convertGeoPoint(e){return new Vd(mo(e.latitude),mo(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Eo(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(To(e));default:return null}}convertTimestamp(e){const t=go(e);return new Ts(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=xs.fromString(e);ts(Su(n),9688,{name:e});const r=new So(n.get(1),n.get(3)),i=new Rs(n.popFirst(5));return r.isEqual(t)||Yi(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Sf(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class xf{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Af extends cf{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Nf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(lf("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Nf extends Af{data(e={}){return super.data(e)}}class Rf{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new xf(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Nf(this._firestore,this._userDataWriter,n.key,n,new xf(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new is(rs.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const r=new Nf(e._firestore,e._userDataWriter,n.doc.key,n.doc,new xf(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new Nf(e._firestore,e._userDataWriter,t.doc.key,t.doc,new xf(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Pf(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Pf(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Zi(61501,{type:e})}}function Df(e){e=bd(e,Sd);const t=bd(e.firestore,Od);return function(e,t,n={}){const r=new ss;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new cd({next:a=>{s.xu(),t.enqueueAndForget(()=>Eh(e,o));const c=a.docs.has(n);!c&&a.fromCache?i.reject(new is(rs.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&r&&"server"===r.source?i.reject(new is(rs.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:e=>i.reject(e)}),o=new Ah(Sa(n.path),s,{includeMetadataChanges:!0,Qa:!0});return Ih(e,o)}(await pd(e),e.asyncQueue,t,n,r)),r.promise}(Ld(t),e._key).then(n=>function(e,t,n){const r=n.docs.get(t._key),i=new Of(e);return new Af(e,i,t._key,r,new xf(n.hasPendingWrites,n.fromCache),t.converter)}(t,e,n))}class Of extends kf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Md(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Sd(this.firestore,null,t)}}function Lf(e){e=bd(e,kd);const t=bd(e.firestore,Od),n=Ld(t),r=new Of(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new is(rs.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),function(e,t,n={}){const r=new ss;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new cd({next:n=>{s.xu(),t.enqueueAndForget(()=>Eh(e,o)),n.fromCache&&"server"===r.source?i.reject(new is(rs.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Ah(n,s,{includeMetadataChanges:!0,Qa:!0});return Ih(e,o)}(await pd(e),e.asyncQueue,t,n,r)),r.promise}(n,e._query).then(n=>new Rf(t,r,e,n))}function Mf(e,t,n){e=bd(e,Sd);const r=bd(e.firestore,Od),i=Sf(e.converter,t,n);return jf(r,[Gd(Kd(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,mc.none())])}function Ff(e,t,n,...r){e=bd(e,Sd);const i=bd(e.firestore,Od),s=Kd(i);let o;return o="string"==typeof(t=G(t))||t instanceof Fd?function(e,t,n,r,i,s){const o=e.bc(1,t,n),a=[nf(t,r,n)],c=[i];if(s.length%2!=0)throw new is(rs.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(nf(t,s[e])),c.push(s[e+1]);const u=[],l=Xo.empty();for(let e=a.length-1;e>=0;--e)if(!af(u,a[e])){const t=a[e];let n=c[e];n=G(n);const r=o.mc(t);if(n instanceof Qd)u.push(t);else{const e=Jd(n,r);null!=e&&(u.push(t),l.set(t,e))}}const h=new lo(u);return new Bd(l,h,o.fieldTransforms)}(s,"updateDoc",e._key,t,n,r):function(e,t,n,r){const i=e.bc(1,t,n);tf("Data must be an object, but it was:",i,r);const s=[],o=Xo.empty();ro(r,(e,r)=>{const a=sf(t,e,n);r=G(r);const c=i.mc(a);if(r instanceof Qd)s.push(a);else{const e=Jd(r,c);null!=e&&(s.push(a),o.set(a,e))}});const a=new lo(s);return new Bd(o,a,i.fieldTransforms)}(s,"updateDoc",e._key,t),jf(i,[o.toMutation(e._key,mc.exists(!0))])}function Uf(e){return jf(bd(e.firestore,Od),[new Ac(e._key,mc.none())])}function Vf(e,t){const n=bd(e.firestore,Od),r=Nd(e),i=Sf(e.converter,t);return jf(n,[Gd(Kd(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,mc.exists(!1))]).then(()=>r)}function jf(e,t){return function(e,t){const n=new ss;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const r=id(e);try{const e=await function(e,t){const n=ns(e),r=Ts.now(),i=t.reduce((e,t)=>e.add(t.key),Xa());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let a=$a(),c=Xa();return n.Bs.getEntries(e,i).next(e=>{a=e,a.forEach((e,t)=>{t.isValidDocument()||(c=c.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,a)).next(i=>{s=i;const o=[];for(const e of t){const t=Ic(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Cc(e.key,t,Jo(t.value.mapValue),mc.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)}).next(t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)})}).then(()=>({batchId:o.batchId,changes:Wa(s)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Au[e.currentUser.toKey()];r||(r=new so(ys)),r=r.insert(t,n),e.Au[e.currentUser.toKey()]=r}(r,e.batchId,n),await ed(r,e.changes),await nh(r.remoteStore)}catch(e){const t=gh(e,"Failed to persist write");n.reject(t)}}(await function(e){return fd(e).then(e=>e.syncEngine)}(e),t,n)),n.promise}(Ld(e),t)}function qf(){return new Yd("serverTimestamp")}new WeakMap,function(e,t=!0){!function(e){Hi=e}(ut),it(new Q("firestore",(e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new Od(new us(e.getProvider("auth-internal")),new fs(i,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new is(rs.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new So(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),dt(Bi,zi,e),dt(Bi,zi,"esm2017")}();const $f="@firebase/database",Bf="1.0.19";let zf="";class Wf{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),P(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:R(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Hf{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return O(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Kf=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Wf(t)}}catch(e){}return new Hf},Gf=Kf("localStorage"),Qf=Kf("sessionStorage"),Yf=new se("@firebase/database"),Xf=function(){let e=1;return function(){return e++}}(),Jf=function(t){const n=function(t){const n=[];let r=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);if(s>=55296&&s<=56319){const n=s-55296;i++,e(i<t.length,"Surrogate pair missing trail surrogate."),s=65536+(n<<10)+(t.charCodeAt(i)-56320)}s<128?n[r++]=s:s<2048?(n[r++]=s>>6|192,n[r++]=63&s|128):s<65536?(n[r++]=s>>12|224,n[r++]=s>>6&63|128,n[r++]=63&s|128):(n[r++]=s>>18|240,n[r++]=s>>12&63|128,n[r++]=s>>6&63|128,n[r++]=63&s|128)}return n}(t),r=new B;r.update(n);const s=r.digest();return i.encodeByteArray(s)},Zf=function(...e){let t="";for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=Zf.apply(null,r):t+="object"==typeof r?P(r):r,t+=" "}return t};let ep=null,tp=!0;const np=function(...t){if(!0===tp&&(tp=!1,null===ep&&!0===Qf.get("logging_enabled")&&(n=!0,e(!r||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(Yf.logLevel=ee.VERBOSE,ep=Yf.log.bind(Yf),r&&Qf.set("logging_enabled",!0)):"function"==typeof n?ep=n:(ep=null,Qf.remove("logging_enabled")))),ep){const e=Zf.apply(null,t);ep(e)}var n,r},rp=function(e){return function(...t){np(e,...t)}},ip=function(...e){const t="FIREBASE INTERNAL ERROR: "+Zf(...e);Yf.error(t)},sp=function(...e){const t=`FIREBASE FATAL ERROR: ${Zf(...e)}`;throw Yf.error(t),new Error(t)},op=function(...e){const t="FIREBASE WARNING: "+Zf(...e);Yf.warn(t)},ap=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},cp="[MIN_NAME]",up="[MAX_NAME]",lp=function(e,t){if(e===t)return 0;if(e===cp||t===up)return-1;if(t===cp||e===up)return 1;{const n=_p(e),r=_p(t);return null!==n?null!==r?n-r===0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1}},hp=function(e,t){return e===t?0:e<t?-1:1},dp=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+P(t))},fp=function(e){if("object"!=typeof e||null===e)return P(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=P(t[r]),n+=":",n+=fp(e[t[r]]);return n+="}",n},pp=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function gp(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const mp=function(t){e(!ap(t),"Invalid JSON number");let n,r,i,s,o;0===t?(r=0,i=0,n=1/t==-1/0?1:0):(n=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(s=Math.min(Math.floor(Math.log(t)/Math.LN2),1023),r=s+1023,i=Math.round(t*Math.pow(2,52-s)-Math.pow(2,52))):(r=0,i=Math.round(t/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(o=11;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);a.push(n?1:0),a.reverse();const c=a.join("");let u="";for(o=0;o<64;o+=8){let e=parseInt(c.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),u+=e}return u.toLowerCase()},yp=new RegExp("^-?(0*)\\d{1,10}$"),_p=function(e){if(yp.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},vp=function(e){try{e()}catch(e){setTimeout(()=>{const t=e.stack||"";throw op("Exception was thrown by user callback.",t),e},Math.floor(0))}},wp=function(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class bp{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,ot(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){op(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Ip{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(np("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',op(e)}}class Ep{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Ep.OWNER="owner";const Tp="5",Cp=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,kp="ac",Sp="websocket",xp="long_polling";class Ap{constructor(e,t,n,r,i=!1,s="",o=!1,a=!1,c=null){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Gf.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Gf.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Np(t,n,r){let i;if(e("string"==typeof n,"typeof type must == string"),e("object"==typeof r,"typeof params must == object"),n===Sp)i=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else{if(n!==xp)throw new Error("Unknown connection type: "+n);i=(t.secure?"https://":"http://")+t.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(t)&&(r.ns=t.namespace);const s=[];return gp(r,(e,t)=>{s.push(e+"="+t)}),i+s.join("&")}class Rp{constructor(){this.counters_={}}incrementCounter(e,t=1){O(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return u(this.counters_)}}const Pp={},Dp={};function Op(e){const t=e.toString();return Pp[t]||(Pp[t]=new Rp),Pp[t]}class Lp{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&vp(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Mp="start";class Fp{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=rp(e),this.stats_=Op(t),this.urlFn=e=>(this.appCheckToken&&(e[kp]=this.appCheckToken),Np(t,xp,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Lp(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Up((...e)=>{const[t,n,r,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===Mp)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const e={};e[Mp]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=Tp,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[kp]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Cp.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Fp.forceAllow_=!0}static forceDisallow(){Fp.forceDisallow_=!0}static isAvailable(){return!(!Fp.forceAllow_&&(Fp.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=P(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=o(t),r=pp(n,1840);for(let e=0;e<r.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=P(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Up{constructor(e,t,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Xf(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Up.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(e){np("frame writing exception"),e.stack&&np(e.stack),np(e)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||np("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{np("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}let Vp=null;"undefined"!=typeof MozWebSocket?Vp=MozWebSocket:"undefined"!=typeof WebSocket&&(Vp=WebSocket);class jp{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=rp(this.connId),this.stats_=Op(t),this.connURL=jp.connectionURL_(t,s,o,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){const s={};return s.v=Tp,"undefined"!=typeof location&&location.hostname&&Cp.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s[kp]=r),i&&(s.p=i),Np(e,Sp,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Gf.set("previous_websocket_failure",!0);try{let e;0,this.mySock=new Vp(this.connURL,[],e)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){jp.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Vp&&!jp.forceDisallow_}static previouslyFailed(){return Gf.isInMemoryStorage||!0===Gf.get("previous_websocket_failure")}markConnectionHealthy(){Gf.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=R(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(t){if(e(null===this.frames,"We already have a frame buffer"),t.length<=6){const e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=P(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=pp(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}jp.responsesRequiredToBeHealthy=2,jp.healthyTimeout=3e4;class qp{static get ALL_TRANSPORTS(){return[Fp,jp]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=jp&&jp.isAvailable();let n=t&&!jp.previouslyFailed();if(e.webSocketOnly&&(t||op("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[jp];else{const e=this.transports_=[];for(const t of qp.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);qp.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}qp.globalTransportInitialized_=!1;class $p{constructor(e,t,n,r,i,s,o,a,c,u){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=rp("c:"+this.id+":"),this.transportManager_=new qp(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=wp(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=dp("t",e),n=dp("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=dp("t",e),n=dp("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=dp("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?ip("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ip("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Tp!==n&&op("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),wp(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):wp(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Gf.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Bp{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class zp{constructor(t){this.allowedEvents_=t,this.listeners_={},e(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context))return void r.splice(e,1)}validateEventType_(t){e(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class Wp extends zp{static getInstance(){return new Wp}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||C()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(t){return e("online"===t,"Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}class Hp{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Kp(){return new Hp("")}function Gp(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Qp(e){return e.pieces_.length-e.pieceNum_}function Yp(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Hp(e.pieces_,t)}function Xp(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Jp(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Zp(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Hp(t,0)}function eg(e,t){const n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof Hp)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new Hp(n,0)}function tg(e){return e.pieceNum_>=e.pieces_.length}function ng(e,t){const n=Gp(e),r=Gp(t);if(null===n)return t;if(n===r)return ng(Yp(e),Yp(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function rg(e,t){const n=Jp(e,0),r=Jp(t,0);for(let e=0;e<n.length&&e<r.length;e++){const t=lp(n[e],r[e]);if(0!==t)return t}return n.length===r.length?0:n.length<r.length?-1:1}function ig(e,t){if(Qp(e)!==Qp(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function sg(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(Qp(e)>Qp(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class og{constructor(e,t){this.errorPrefix_=t,this.parts_=Jp(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=K(this.parts_[e]);ag(this)}}function ag(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+cg(e))}function cg(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class ug extends zp{static getInstance(){return new ug}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(t){return e("visible"===t,"Unknown event type: "+t),[this.visible_]}}const lg=1e3;class hg extends Bp{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=hg.nextPersistentConnectionId_++,this.log_=rp("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=lg,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ug.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Wp.getInstance().on("online",this.onOnline_,this)}sendRequest(t,n,r){const i=++this.requestNumber_,s={r:i,a:t,b:n};this.log_(P(s)),e(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),r&&(this.requestCBHash_[i]=r)}get(e){this.initConnection_();const t=new y,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(t,n,r,i){this.initConnection_();const s=t._queryIdentifier,o=t._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),e(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),e(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:n,query:t,tag:r};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){const t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);const i={p:n};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,i=>{const s=i.d,o=i.s;hg.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(n,r),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&O(e,"w")){const n=L(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();op(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=D(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=D(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{const n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(t,n){const r=t._path.toString(),i=t._queryIdentifier;this.log_("Unlisten called for "+r+" "+i),e(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,i)&&this.connected_&&this.sendUnlisten_(r,i,t._queryObject,n)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+P(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):ip("Unrecognized action received from server: "+P(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){e(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=lg,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=lg,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=lg),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+hg.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,r())},u=function(t){e(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(t)};this.realtime_={close:c,sendRequest:u};const l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[e,c]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);o?np("getToken() completed but was canceled"):(np("getToken() completed. Creating connection."),this.authToken_=e&&e.accessToken,this.appCheckToken_=c&&c.token,a=new $p(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,n,r,e=>{op(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&op(e),c())}}}interrupt(e){np("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){np("Resuming connection for reason: "+e),delete this.interruptReasons_[e],M(this.interruptReasons_)&&(this.reconnectDelay_=lg,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>fp(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new Hp(e).toString();let r;if(this.listens.has(n)){const e=this.listens.get(n);r=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){np("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){np("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+zf.replace(/\./g,"-")]=1,C()?e["framework.cordova"]=1:k()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Wp.getInstance().currentlyOnline();return M(this.interruptReasons_)&&e}}hg.nextPersistentConnectionId_=0,hg.nextConnectionId_=0;class dg{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new dg(e,t)}}class fg{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new dg(cp,e),r=new dg(cp,t);return 0!==this.compare(n,r)}minPost(){return dg.MIN}}let pg;class gg extends fg{static get __EMPTY_NODE(){return pg}static set __EMPTY_NODE(e){pg=e}compare(e,t){return lp(e.name,t.name)}isDefinedOn(e){throw t("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return dg.MIN}maxPost(){return new dg(up,pg)}makePost(t,n){return e("string"==typeof t,"KeyIndex indexValue must always be a string."),new dg(t,pg)}toString(){return".key"}}const mg=new gg;class yg{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class _g{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:_g.RED,this.left=null!=r?r:vg.EMPTY_NODE,this.right=null!=i?i:vg.EMPTY_NODE}copy(e,t,n,r,i){return new _g(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return vg.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return vg.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,_g.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,_g.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}_g.RED=!0,_g.BLACK=!1;class vg{constructor(e,t=vg.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new vg(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,_g.BLACK,null,null))}remove(e){return new vg(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,_g.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new yg(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new yg(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new yg(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new yg(this.root_,null,this.comparator_,!0,e)}}function wg(e,t){return lp(e.name,t.name)}function bg(e,t){return lp(e,t)}let Ig;vg.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new _g(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Eg=function(e){return"number"==typeof e?"number:"+mp(e):"string:"+e},Tg=function(t){if(t.isLeafNode()){const n=t.val();e("string"==typeof n||"number"==typeof n||"object"==typeof n&&O(n,".sv"),"Priority must be a string or number.")}else e(t===Ig||t.isEmpty(),"priority of unexpected type.");e(t===Ig||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Cg,kg,Sg;class xg{static set __childrenNodeConstructor(e){Cg=e}static get __childrenNodeConstructor(){return Cg}constructor(t,n=xg.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=n,this.lazyHash_=null,e(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Tg(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new xg(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:xg.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return tg(e)?this:".priority"===Gp(e)?this.priorityNode_:xg.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:xg.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(t,n){const r=Gp(t);return null===r?n:n.isEmpty()&&".priority"!==r?this:(e(".priority"!==r||1===Qp(t),".priority must be the last token in a path"),this.updateImmediateChild(r,xg.__childrenNodeConstructor.EMPTY_NODE.updateChild(Yp(t),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Eg(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?mp(this.value_):this.value_,this.lazyHash_=Jf(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===xg.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof xg.__childrenNodeConstructor?-1:(e(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const n=typeof t.value_,r=typeof this.value_,i=xg.VALUE_TYPE_ORDER.indexOf(n),s=xg.VALUE_TYPE_ORDER.indexOf(r);return e(i>=0,"Unknown leaf type: "+n),e(s>=0,"Unknown leaf type: "+r),i===s?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}xg.VALUE_TYPE_ORDER=["object","boolean","number","string"];const Ag=new class extends fg{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?lp(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return dg.MIN}maxPost(){return new dg(up,new xg("[PRIORITY-POST]",Sg))}makePost(e,t){const n=kg(e);return new dg(t,new xg("[PRIORITY-POST]",n))}toString(){return".priority"}},Ng=Math.log(2);class Rg{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Ng,10)),this.current_=this.count-1;const n=(r=this.count,parseInt(Array(r+1).join("1"),2));var r;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Pg=function(e,t,n,r){e.sort(t);const i=function(t,r){const s=r-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new _g(a,o.node,_g.BLACK,null,null);{const c=parseInt(s/2,10)+t,u=i(t,c),l=i(c+1,r);return o=e[c],a=n?n(o):o,new _g(a,o.node,_g.BLACK,u,l)}},s=function(t){let r=null,s=null,o=e.length;const a=function(t,r){const s=o-t,a=o;o-=t;const u=i(s+1,a),l=e[s],h=n?n(l):l;c(new _g(h,l.node,r,null,u))},c=function(e){r?(r.left=e,r=e):(s=e,r=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,_g.BLACK):(a(r,_g.BLACK),a(r,_g.RED))}return s}(new Rg(e.length));return new vg(r||t,s)};let Dg;const Og={};class Lg{static get Default(){return e(Og&&Ag,"ChildrenNode.ts has not been loaded"),Dg=Dg||new Lg({".priority":Og},{".priority":Ag}),Dg}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=L(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof vg?t:null}hasIndex(e){return O(this.indexSet_,e.toString())}addIndex(t,n){e(t!==mg,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let i=!1;const s=n.getIterator(dg.Wrap);let o,a=s.getNext();for(;a;)i=i||t.isDefinedOn(a.node),r.push(a),a=s.getNext();o=i?Pg(r,t.getCompare()):Og;const c=t.toString(),u=Object.assign({},this.indexSet_);u[c]=t;const l=Object.assign({},this.indexes_);return l[c]=o,new Lg(l,u)}addToIndexes(t,n){const r=F(this.indexes_,(r,i)=>{const s=L(this.indexSet_,i);if(e(s,"Missing index implementation for "+i),r===Og){if(s.isDefinedOn(t.node)){const e=[],r=n.getIterator(dg.Wrap);let i=r.getNext();for(;i;)i.name!==t.name&&e.push(i),i=r.getNext();return e.push(t),Pg(e,s.getCompare())}return Og}{const e=n.get(t.name);let i=r;return e&&(i=i.remove(new dg(t.name,e))),i.insert(t,t.node)}});return new Lg(r,this.indexSet_)}removeFromIndexes(e,t){const n=F(this.indexes_,n=>{if(n===Og)return n;{const r=t.get(e.name);return r?n.remove(new dg(e.name,r)):n}});return new Lg(n,this.indexSet_)}}let Mg;class Fg{static get EMPTY_NODE(){return Mg||(Mg=new Fg(new vg(bg),null,Lg.Default))}constructor(t,n,r){this.children_=t,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Tg(this.priorityNode_),this.children_.isEmpty()&&e(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Mg}updatePriority(e){return this.children_.isEmpty()?this:new Fg(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?Mg:t}}getChild(e){const t=Gp(e);return null===t?this:this.getImmediateChild(t).getChild(Yp(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(t,n){if(e(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);{const e=new dg(t,n);let r,i;n.isEmpty()?(r=this.children_.remove(t),i=this.indexMap_.removeFromIndexes(e,this.children_)):(r=this.children_.insert(t,n),i=this.indexMap_.addToIndexes(e,this.children_));const s=r.isEmpty()?Mg:this.priorityNode_;return new Fg(r,s,i)}}updateChild(t,n){const r=Gp(t);if(null===r)return n;{e(".priority"!==Gp(t)||1===Qp(t),".priority must be the last token in a path");const i=this.getImmediateChild(r).updateChild(Yp(t),n);return this.updateImmediateChild(r,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,r=0,i=!0;if(this.forEachChild(Ag,(s,o)=>{t[s]=o.val(e),n++,i&&Fg.INTEGER_REGEXP_.test(s)?r=Math.max(r,Number(s)):i=!1}),!e&&i&&r<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+Eg(this.getPriority().val())+":"),this.forEachChild(Ag,(t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":Jf(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new dg(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new dg(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new dg(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{const n=this.children_.getIteratorFrom(e.name,dg.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{const n=this.children_.getReverseIteratorFrom(e.name,dg.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Ug?-1:0}withIndex(e){if(e===mg||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Fg(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===mg||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(Ag),n=t.getIterator(Ag);let r=e.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=e.getNext(),i=n.getNext()}return null===r&&null===i}return!1}return!1}}resolveIndex_(e){return e===mg?null:this.indexMap_.get(e.toString())}}Fg.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const Ug=new class extends Fg{constructor(){super(new vg(bg),Fg.EMPTY_NODE,Lg.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Fg.EMPTY_NODE}isEmpty(){return!1}};function Vg(t,n=null){if(null===t)return Fg.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(n=t[".priority"]),e(null===n||"string"==typeof n||"number"==typeof n||"object"==typeof n&&".sv"in n,"Invalid priority type found: "+typeof n),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new xg(t,Vg(n));if(t instanceof Array){let e=Fg.EMPTY_NODE;return gp(t,(n,r)=>{if(O(t,n)&&"."!==n.substring(0,1)){const t=Vg(r);!t.isLeafNode()&&t.isEmpty()||(e=e.updateImmediateChild(n,t))}}),e.updatePriority(Vg(n))}{const e=[];let r=!1;if(gp(t,(t,n)=>{if("."!==t.substring(0,1)){const i=Vg(n);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),e.push(new dg(t,i)))}}),0===e.length)return Fg.EMPTY_NODE;const i=Pg(e,wg,e=>e.name,bg);if(r){const t=Pg(e,Ag.getCompare());return new Fg(i,Vg(n),new Lg({".priority":t},{".priority":Ag}))}return new Fg(i,Vg(n),Lg.Default)}}Object.defineProperties(dg,{MIN:{value:new dg(cp,Fg.EMPTY_NODE)},MAX:{value:new dg(up,Ug)}}),gg.__EMPTY_NODE=Fg.EMPTY_NODE,xg.__childrenNodeConstructor=Fg,Ig=Ug,Sg=Ug,function(e){kg=e}(Vg);class jg extends fg{constructor(t){super(),this.indexPath_=t,e(!tg(t)&&".priority"!==Gp(t),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?lp(e.name,t.name):i}makePost(e,t){const n=Vg(e),r=Fg.EMPTY_NODE.updateChild(this.indexPath_,n);return new dg(t,r)}maxPost(){const e=Fg.EMPTY_NODE.updateChild(this.indexPath_,Ug);return new dg(up,e)}toString(){return Jp(this.indexPath_,0).join("/")}}const qg=new class extends fg{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?lp(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return dg.MIN}maxPost(){return dg.MAX}makePost(e,t){const n=Vg(e);return new dg(t,n)}toString(){return".value"}};function $g(e){return{type:"value",snapshotNode:e}}function Bg(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function zg(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Wg(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class Hg{constructor(e){this.index_=e}updateChild(t,n,r,i,s,o){e(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=t.getImmediateChild(n);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()?t:(null!=o&&(r.isEmpty()?t.hasChild(n)?o.trackChildChange(zg(n,a)):e(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Bg(n,r)):o.trackChildChange(Wg(n,r,a))),t.isLeafNode()&&r.isEmpty()?t:t.updateImmediateChild(n,r).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Ag,(e,r)=>{t.hasChild(e)||n.trackChildChange(zg(e,r))}),t.isLeafNode()||t.forEachChild(Ag,(t,r)=>{if(e.hasChild(t)){const i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(Wg(t,r,i))}else n.trackChildChange(Bg(t,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Fg.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Kg{constructor(e){this.indexedFilter_=new Hg(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Kg.getStartPost_(e),this.endPost_=Kg.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,i,s){return this.matches(new dg(t,n))||(n=Fg.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=Fg.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(Fg.EMPTY_NODE);const i=this;return t.forEachChild(Ag,(e,t)=>{i.matches(new dg(e,t))||(r=r.updateImmediateChild(e,Fg.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class Gg{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new Kg(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new dg(t,n))||(n=Fg.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=Fg.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=Fg.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;r=r.updateImmediateChild(t.name,t.node),n++}}}else{let e;r=t.withIndex(this.index_),r=r.updatePriority(Fg.EMPTY_NODE),e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:r=r.updateImmediateChild(t.name,Fg.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,n,r,i,s){let o;if(this.reverse_){const e=this.index_.getCompare();o=(t,n)=>e(n,t)}else o=this.index_.getCompare();const a=t;e(a.numChildren()===this.limit_,"");const c=new dg(n,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),l=this.rangedFilter_.matches(c);if(a.hasChild(n)){const e=a.getImmediateChild(n);let t=i.getChildAfterChild(this.index_,u,this.reverse_);for(;null!=t&&(t.name===n||a.hasChild(t.name));)t=i.getChildAfterChild(this.index_,t,this.reverse_);const h=null==t?1:o(t,c);if(l&&!r.isEmpty()&&h>=0)return null!=s&&s.trackChildChange(Wg(n,r,e)),a.updateImmediateChild(n,r);{null!=s&&s.trackChildChange(zg(n,e));const r=a.updateImmediateChild(n,Fg.EMPTY_NODE);return null!=t&&this.rangedFilter_.matches(t)?(null!=s&&s.trackChildChange(Bg(t.name,t.node)),r.updateImmediateChild(t.name,t.node)):r}}return r.isEmpty()?t:l&&o(u,c)>=0?(null!=s&&(s.trackChildChange(zg(u.name,u.node)),s.trackChildChange(Bg(n,r))),a.updateImmediateChild(n,r).updateImmediateChild(u.name,Fg.EMPTY_NODE)):t}}class Qg{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ag}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return e(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return e(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:cp}hasEnd(){return this.endSet_}getIndexEndValue(){return e(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return e(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:up}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return e(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ag}copy(){const e=new Qg;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Yg(t){const n={};if(t.isDefault())return n;let r;if(t.index_===Ag?r="$priority":t.index_===qg?r="$value":t.index_===mg?r="$key":(e(t.index_ instanceof jg,"Unrecognized index type!"),r=t.index_.toString()),n.orderBy=P(r),t.startSet_){const e=t.startAfterSet_?"startAfter":"startAt";n[e]=P(t.indexStartValue_),t.startNameSet_&&(n[e]+=","+P(t.indexStartName_))}if(t.endSet_){const e=t.endBeforeSet_?"endBefore":"endAt";n[e]=P(t.indexEndValue_),t.endNameSet_&&(n[e]+=","+P(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?n.limitToFirst=t.limit_:n.limitToLast=t.limit_),n}function Xg(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==Ag&&(t.i=e.index_.toString()),t}class Jg extends Bp{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(t,n){return void 0!==n?"tag$"+n:(e(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=rp("p:rest:"),this.listens_={}}listen(e,t,n,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const s=Jg.getListenId_(e,n),o={};this.listens_[s]=o;const a=Yg(e._queryParams);this.restRequest_(i+".json",a,(e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),L(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}})}unlisten(e,t){const n=Jg.getListenId_(e,t);delete this.listens_[n]}get(e){const t=Yg(e._queryParams),n=e._path.toString(),r=new y;return this.restRequest_(n+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(new Error(i))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+j(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=R(o.responseText)}catch(e){op("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&op("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class Zg{constructor(){this.rootNode_=Fg.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function em(){return{value:null,children:new Map}}function tm(e,t,n){if(tg(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const r=Gp(t);e.children.has(r)||e.children.set(r,em()),tm(e.children.get(r),t=Yp(t),n)}}function nm(e,t){if(tg(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{const n=e.value;return e.value=null,n.forEachChild(Ag,(t,n)=>{tm(e,new Hp(t),n)}),nm(e,t)}}if(e.children.size>0){const n=Gp(t);return t=Yp(t),e.children.has(n)&&nm(e.children.get(n),t)&&e.children.delete(n),0===e.children.size}return!0}function rm(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((e,n)=>{t(n,e)})}(e,(e,r)=>{rm(r,new Hp(t.toString()+"/"+e),n)})}class im{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&gp(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class sm{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new im(e);const n=1e4+2e4*Math.random();wp(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;gp(e,(e,r)=>{r>0&&O(this.statsToReport_,e)&&(t[e]=r,n=!0)}),n&&this.server_.reportStats(t),wp(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var om,am;function cm(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(am=om||(om={}))[am.OVERWRITE=0]="OVERWRITE",am[am.MERGE=1]="MERGE",am[am.ACK_USER_WRITE=2]="ACK_USER_WRITE",am[am.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class um{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=om.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(t){if(tg(this.path)){if(null!=this.affectedTree.value)return e(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new Hp(t));return new um(Kp(),e,this.revert)}}return e(Gp(this.path)===t,"operationForChild called for unrelated child."),new um(Yp(this.path),this.affectedTree,this.revert)}}class lm{constructor(e,t){this.source=e,this.path=t,this.type=om.LISTEN_COMPLETE}operationForChild(e){return tg(this.path)?new lm(this.source,Kp()):new lm(this.source,Yp(this.path))}}class hm{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=om.OVERWRITE}operationForChild(e){return tg(this.path)?new hm(this.source,Kp(),this.snap.getImmediateChild(e)):new hm(this.source,Yp(this.path),this.snap)}}class dm{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=om.MERGE}operationForChild(t){if(tg(this.path)){const e=this.children.subtree(new Hp(t));return e.isEmpty()?null:e.value?new hm(this.source,Kp(),e.value):new dm(this.source,Kp(),e)}return e(Gp(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new dm(this.source,Yp(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class fm{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(tg(e))return this.isFullyInitialized()&&!this.filtered_;const t=Gp(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class pm{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function gm(e,n,r,i,s,o){const a=i.filter(e=>e.type===r);a.sort((n,r)=>function(e,n,r){if(null==n.childName||null==r.childName)throw t("Should only compare child_ events.");const i=new dg(n.childName,n.snapshotNode),s=new dg(r.childName,r.snapshotNode);return e.index_.compare(i,s)}(e,n,r)),a.forEach(t=>{const r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,t,o);s.forEach(i=>{i.respondsTo(t.type)&&n.push(i.createEvent(r,e.query_))})})}function mm(e,t){return{eventCache:e,serverCache:t}}function ym(e,t,n,r){return mm(new fm(t,n,r),e.serverCache)}function _m(e,t,n,r){return mm(e.eventCache,new fm(t,n,r))}function vm(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function wm(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let bm;class Im{static fromObject(e){let t=new Im(null);return gp(e,(e,n)=>{t=t.set(new Hp(e),n)}),t}constructor(e,t=(()=>(bm||(bm=new vg(hp)),bm))()){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Kp(),value:this.value};if(tg(e))return null;{const n=Gp(e),r=this.children.get(n);if(null!==r){const i=r.findRootMostMatchingPathAndValue(Yp(e),t);return null!=i?{path:eg(new Hp(n),i.path),value:i.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(tg(e))return this;{const t=Gp(e),n=this.children.get(t);return null!==n?n.subtree(Yp(e)):new Im(null)}}set(e,t){if(tg(e))return new Im(t,this.children);{const n=Gp(e),r=(this.children.get(n)||new Im(null)).set(Yp(e),t),i=this.children.insert(n,r);return new Im(this.value,i)}}remove(e){if(tg(e))return this.children.isEmpty()?new Im(null):new Im(null,this.children);{const t=Gp(e),n=this.children.get(t);if(n){const r=n.remove(Yp(e));let i;return i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty()?new Im(null):new Im(this.value,i)}return this}}get(e){if(tg(e))return this.value;{const t=Gp(e),n=this.children.get(t);return n?n.get(Yp(e)):null}}setTree(e,t){if(tg(e))return t;{const n=Gp(e),r=(this.children.get(n)||new Im(null)).setTree(Yp(e),t);let i;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new Im(this.value,i)}}fold(e){return this.fold_(Kp(),e)}fold_(e,t){const n={};return this.children.inorderTraversal((r,i)=>{n[r]=i.fold_(eg(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,Kp(),t)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(tg(e))return null;{const r=Gp(e),i=this.children.get(r);return i?i.findOnPath_(Yp(e),eg(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Kp(),t)}foreachOnPath_(e,t,n){if(tg(e))return this;{this.value&&n(t,this.value);const r=Gp(e),i=this.children.get(r);return i?i.foreachOnPath_(Yp(e),eg(t,r),n):new Im(null)}}foreach(e){this.foreach_(Kp(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(eg(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class Em{constructor(e){this.writeTree_=e}static empty(){return new Em(new Im(null))}}function Tm(e,t,n){if(tg(t))return new Em(new Im(n));{const r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){const i=r.path;let s=r.value;const o=ng(i,t);return s=s.updateChild(o,n),new Em(e.writeTree_.set(i,s))}{const r=new Im(n),i=e.writeTree_.setTree(t,r);return new Em(i)}}}function Cm(e,t,n){let r=e;return gp(n,(e,n)=>{r=Tm(r,eg(t,e),n)}),r}function km(e,t){if(tg(t))return Em.empty();{const n=e.writeTree_.setTree(t,new Im(null));return new Em(n)}}function Sm(e,t){return null!=xm(e,t)}function xm(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(ng(n.path,t)):null}function Am(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Ag,(e,n)=>{t.push(new dg(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new dg(e,n.value))}),t}function Nm(e,t){if(tg(t))return e;{const n=xm(e,t);return new Em(null!=n?new Im(n):e.writeTree_.subtree(t))}}function Rm(e){return e.writeTree_.isEmpty()}function Pm(e,t){return Dm(Kp(),e.writeTree_,t)}function Dm(t,n,r){if(null!=n.value)return r.updateChild(t,n.value);{let i=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?(e(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):r=Dm(eg(t,n),s,r)}),r.getChild(t).isEmpty()||null===i||(r=r.updateChild(eg(t,".priority"),i)),r}}function Om(e,t){return Wm(t,e)}function Lm(e,t){if(e.snap)return sg(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&sg(eg(e.path,n),t))return!0;return!1}function Mm(e){return e.visible}function Fm(e,n,r){let i=Em.empty();for(let s=0;s<e.length;++s){const o=e[s];if(n(o)){const e=o.path;let n;if(o.snap)sg(r,e)?(n=ng(r,e),i=Tm(i,n,o.snap)):sg(e,r)&&(n=ng(e,r),i=Tm(i,Kp(),o.snap.getChild(n)));else{if(!o.children)throw t("WriteRecord should have .snap or .children");if(sg(r,e))n=ng(r,e),i=Cm(i,n,o.children);else if(sg(e,r))if(n=ng(e,r),tg(n))i=Cm(i,Kp(),o.children);else{const e=L(o.children,Gp(n));if(e){const t=e.getChild(Yp(n));i=Tm(i,Kp(),t)}}}}}return i}function Um(e,t,n,r,i){if(r||i){const s=Nm(e.visibleWrites,t);if(!i&&Rm(s))return n;if(i||null!=n||Sm(s,Kp())){const s=function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(sg(e.path,t)||sg(t,e.path))};return Pm(Fm(e.allWrites,s,t),n||Fg.EMPTY_NODE)}return null}{const r=xm(e.visibleWrites,t);if(null!=r)return r;{const r=Nm(e.visibleWrites,t);return Rm(r)?n:null!=n||Sm(r,Kp())?Pm(r,n||Fg.EMPTY_NODE):null}}}function Vm(e,t,n,r){return Um(e.writeTree,e.treePath,t,n,r)}function jm(e,t){return function(e,t,n){let r=Fg.EMPTY_NODE;const i=xm(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(Ag,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const i=Nm(e.visibleWrites,t);return n.forEachChild(Ag,(e,t)=>{const n=Pm(Nm(i,new Hp(e)),t);r=r.updateImmediateChild(e,n)}),Am(i).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return Am(Nm(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function qm(t,n,r,i){return function(t,n,r,i,s){e(i||s,"Either existingEventSnap or existingServerSnap must exist");const o=eg(n,r);if(Sm(t.visibleWrites,o))return null;{const e=Nm(t.visibleWrites,o);return Rm(e)?s.getChild(r):Pm(e,s.getChild(r))}}(t.writeTree,t.treePath,n,r,i)}function $m(e,t){return function(e,t){return xm(e.visibleWrites,t)}(e.writeTree,eg(e.treePath,t))}function Bm(e,t,n){return function(e,t,n,r){const i=eg(t,n),s=xm(e.visibleWrites,i);return null!=s?s:r.isCompleteForChild(n)?Pm(Nm(e.visibleWrites,i),r.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function zm(e,t){return Wm(eg(e.treePath,t),e.writeTree)}function Wm(e,t){return{treePath:e,writeTree:t}}class Hm{constructor(){this.changeMap=new Map}trackChildChange(n){const r=n.type,i=n.childName;e("child_added"===r||"child_changed"===r||"child_removed"===r,"Only child changes supported for tracking"),e(".priority"!==i,"Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const e=s.type;if("child_added"===r&&"child_removed"===e)this.changeMap.set(i,Wg(i,n.snapshotNode,s.snapshotNode));else if("child_removed"===r&&"child_added"===e)this.changeMap.delete(i);else if("child_removed"===r&&"child_changed"===e)this.changeMap.set(i,zg(i,s.oldSnap));else if("child_changed"===r&&"child_added"===e)this.changeMap.set(i,Bg(i,n.snapshotNode));else{if("child_changed"!==r||"child_changed"!==e)throw t("Illegal combination of changes: "+n+" occurred after "+s);this.changeMap.set(i,Wg(i,n.snapshotNode,s.oldSnap))}}else this.changeMap.set(i,n)}getChanges(){return Array.from(this.changeMap.values())}}const Km=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Gm{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new fm(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Bm(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:wm(this.viewCache_),i=function(e,t,n,r,i,s){return function(e,t,n,r,i,s,o){let a;const c=Nm(e.visibleWrites,t),u=xm(c,Kp());if(null!=u)a=u;else{if(null==n)return[];a=Pm(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let c=n.getNext();for(;c&&e.length<i;)0!==t(c,r)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,r,i,s)}(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]}}function Qm(t,n,r,i,s,o){const a=n.eventCache;if(null!=$m(i,r))return n;{let c,u;if(tg(r))if(e(n.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),n.serverCache.isFiltered()){const e=wm(n),r=jm(i,e instanceof Fg?e:Fg.EMPTY_NODE);c=t.filter.updateFullNode(n.eventCache.getNode(),r,o)}else{const e=Vm(i,wm(n));c=t.filter.updateFullNode(n.eventCache.getNode(),e,o)}else{const l=Gp(r);if(".priority"===l){e(1===Qp(r),"Can't have a priority with additional path components");const s=a.getNode();u=n.serverCache.getNode();const o=qm(i,r,s,u);c=null!=o?t.filter.updatePriority(s,o):a.getNode()}else{const e=Yp(r);let h;if(a.isCompleteForChild(l)){u=n.serverCache.getNode();const t=qm(i,r,a.getNode(),u);h=null!=t?a.getNode().getImmediateChild(l).updateChild(e,t):a.getNode().getImmediateChild(l)}else h=Bm(i,l,n.serverCache);c=null!=h?t.filter.updateChild(a.getNode(),l,h,e,s,o):a.getNode()}}return ym(n,c,a.isFullyInitialized()||tg(r),t.filter.filtersNodes())}}function Ym(e,t,n,r,i,s,o,a){const c=t.serverCache;let u;const l=o?e.filter:e.filter.getIndexedFilter();if(tg(n))u=l.updateFullNode(c.getNode(),r,null);else if(l.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,r);u=l.updateFullNode(c.getNode(),e,null)}else{const e=Gp(n);if(!c.isCompleteForPath(n)&&Qp(n)>1)return t;const i=Yp(n),s=c.getNode().getImmediateChild(e).updateChild(i,r);u=".priority"===e?l.updatePriority(c.getNode(),s):l.updateChild(c.getNode(),e,s,i,Km,null)}const h=_m(t,u,c.isFullyInitialized()||tg(n),l.filtersNodes());return Qm(e,h,n,i,new Gm(i,h,s),a)}function Xm(e,t,n,r,i,s,o){const a=t.eventCache;let c,u;const l=new Gm(i,t,s);if(tg(n))u=e.filter.updateFullNode(t.eventCache.getNode(),r,o),c=ym(t,u,!0,e.filter.filtersNodes());else{const i=Gp(n);if(".priority"===i)u=e.filter.updatePriority(t.eventCache.getNode(),r),c=ym(t,u,a.isFullyInitialized(),a.isFiltered());else{const s=Yp(n),u=a.getNode().getImmediateChild(i);let h;if(tg(s))h=r;else{const e=l.getCompleteChild(i);h=null!=e?".priority"===Xp(s)&&e.getChild(Zp(s)).isEmpty()?e:e.updateChild(s,r):Fg.EMPTY_NODE}c=u.equals(h)?t:ym(t,e.filter.updateChild(a.getNode(),i,h,s,l,o),a.isFullyInitialized(),e.filter.filtersNodes())}}return c}function Jm(e,t){return e.eventCache.isCompleteForChild(t)}function Zm(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function ey(e,t,n,r,i,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,u=t;c=tg(n)?r:new Im(null).setTree(n,r);const l=t.serverCache.getNode();return c.children.inorderTraversal((n,r)=>{if(l.hasChild(n)){const c=Zm(0,t.serverCache.getNode().getImmediateChild(n),r);u=Ym(e,u,new Hp(n),c,i,s,o,a)}}),c.children.inorderTraversal((n,r)=>{const c=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!l.hasChild(n)&&!c){const c=Zm(0,t.serverCache.getNode().getImmediateChild(n),r);u=Ym(e,u,new Hp(n),c,i,s,o,a)}}),u}class ty{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new Hg(n.getIndex()),i=(s=n).loadsAllData()?new Hg(s.getIndex()):s.hasLimit()?new Gg(s):new Kg(s);var s;this.processor_=function(e){return{filter:e}}(i);const o=t.serverCache,a=t.eventCache,c=r.updateFullNode(Fg.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Fg.EMPTY_NODE,a.getNode(),null),l=new fm(c,o.isFullyInitialized(),r.filtersNodes()),h=new fm(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=mm(h,l),this.eventGenerator_=new pm(this.query_)}get query(){return this.query_}}function ny(e,t){const n=wm(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!tg(t)&&!n.getImmediateChild(Gp(t)).isEmpty())?n.getChild(t):null}function ry(e){return 0===e.eventRegistrations_.length}function iy(t,n,r){const i=[];if(r){e(null==n,"A cancel should cancel all event registrations.");const s=t.query._path;t.eventRegistrations_.forEach(e=>{const t=e.createCancelEvent(r,s);t&&i.push(t)})}if(n){let e=[];for(let r=0;r<t.eventRegistrations_.length;++r){const i=t.eventRegistrations_[r];if(i.matches(n)){if(n.hasAnyCallback()){e=e.concat(t.eventRegistrations_.slice(r+1));break}}else e.push(i)}t.eventRegistrations_=e}else t.eventRegistrations_=[];return i}function sy(n,r,i,s){r.type===om.MERGE&&null!==r.source.queryId&&(e(wm(n.viewCache_),"We should always have a full cache before handling merges"),e(vm(n.viewCache_),"Missing event cache, even though we have a server cache"));const o=n.viewCache_,a=function(n,r,i,s,o){const a=new Hm;let c,u;if(i.type===om.OVERWRITE){const t=i;t.source.fromUser?c=Xm(n,r,t.path,t.snap,s,o,a):(e(t.source.fromServer,"Unknown source."),u=t.source.tagged||r.serverCache.isFiltered()&&!tg(t.path),c=Ym(n,r,t.path,t.snap,s,o,u,a))}else if(i.type===om.MERGE){const t=i;t.source.fromUser?c=function(e,t,n,r,i,s,o){let a=t;return r.foreach((r,c)=>{const u=eg(n,r);Jm(t,Gp(u))&&(a=Xm(e,a,u,c,i,s,o))}),r.foreach((r,c)=>{const u=eg(n,r);Jm(t,Gp(u))||(a=Xm(e,a,u,c,i,s,o))}),a}(n,r,t.path,t.children,s,o,a):(e(t.source.fromServer,"Unknown source."),u=t.source.tagged||r.serverCache.isFiltered(),c=ey(n,r,t.path,t.children,s,o,u,a))}else if(i.type===om.ACK_USER_WRITE){const t=i;c=t.revert?function(t,n,r,i,s,o){let a;if(null!=$m(i,r))return n;{const c=new Gm(i,n,s),u=n.eventCache.getNode();let l;if(tg(r)||".priority"===Gp(r)){let r;if(n.serverCache.isFullyInitialized())r=Vm(i,wm(n));else{const t=n.serverCache.getNode();e(t instanceof Fg,"serverChildren would be complete if leaf node"),r=jm(i,t)}l=t.filter.updateFullNode(u,r,o)}else{const e=Gp(r);let s=Bm(i,e,n.serverCache);null==s&&n.serverCache.isCompleteForChild(e)&&(s=u.getImmediateChild(e)),l=null!=s?t.filter.updateChild(u,e,s,Yp(r),c,o):n.eventCache.getNode().hasChild(e)?t.filter.updateChild(u,e,Fg.EMPTY_NODE,Yp(r),c,o):u,l.isEmpty()&&n.serverCache.isFullyInitialized()&&(a=Vm(i,wm(n)),a.isLeafNode()&&(l=t.filter.updateFullNode(l,a,o)))}return a=n.serverCache.isFullyInitialized()||null!=$m(i,Kp()),ym(n,l,a,t.filter.filtersNodes())}}(n,r,t.path,s,o,a):function(e,t,n,r,i,s,o){if(null!=$m(i,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=r.value){if(tg(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return Ym(e,t,n,c.getNode().getChild(n),i,s,a,o);if(tg(n)){let r=new Im(null);return c.getNode().forEachChild(mg,(e,t)=>{r=r.set(new Hp(e),t)}),ey(e,t,n,r,i,s,a,o)}return t}{let u=new Im(null);return r.foreach((e,t)=>{const r=eg(n,e);c.isCompleteForPath(r)&&(u=u.set(e,c.getNode().getChild(r)))}),ey(e,t,n,u,i,s,a,o)}}(n,r,t.path,t.affectedTree,s,o,a)}else{if(i.type!==om.LISTEN_COMPLETE)throw t("Unknown operation type: "+i.type);c=function(e,t,n,r,i){const s=t.serverCache;return Qm(e,_m(t,s.getNode(),s.isFullyInitialized()||tg(n),s.isFiltered()),n,r,Km,i)}(n,r,i.path,s,a)}const l=a.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=vm(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push($g(vm(t)))}}(r,c,l),{viewCache:c,changes:l}}(n.processor_,o,r,i,s);var c,u;return c=n.processor_,u=a.viewCache,e(u.eventCache.getNode().isIndexed(c.filter.getIndex()),"Event snap not indexed"),e(u.serverCache.getNode().isIndexed(c.filter.getIndex()),"Server snap not indexed"),e(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=a.viewCache,oy(n,a.changes,a.viewCache.eventCache.getNode(),null)}function oy(e,t,n,r){const i=r?[r]:e.eventRegistrations_;return function(e,t,n,r){const i=[],s=[];return t.forEach(t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))}),gm(e,i,"child_removed",t,r,n),gm(e,i,"child_added",t,r,n),gm(e,i,"child_moved",s,r,n),gm(e,i,"child_changed",t,r,n),gm(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,i)}let ay,cy;class uy{constructor(){this.views=new Map}}function ly(t,n,r,i){const s=n.source.queryId;if(null!==s){const o=t.views.get(s);return e(null!=o,"SyncTree gave us an op for an invalid query."),sy(o,n,r,i)}{let e=[];for(const s of t.views.values())e=e.concat(sy(s,n,r,i));return e}}function hy(e,t,n,r,i){const s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=Vm(n,i?r:null),s=!1;e?s=!0:r instanceof Fg?(e=jm(n,r),s=!1):(e=Fg.EMPTY_NODE,s=!1);const o=mm(new fm(e,s,!1),new fm(r,i,!1));return new ty(t,o)}return o}function dy(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function fy(e,t){let n=null;for(const r of e.views.values())n=n||ny(r,t);return n}function py(e,t){if(t._queryParams.loadsAllData())return yy(e);{const n=t._queryIdentifier;return e.views.get(n)}}function gy(e,t){return null!=py(e,t)}function my(e){return null!=yy(e)}function yy(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let _y=1;class vy{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Im(null),this.pendingWriteTree_={visibleWrites:Em.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function wy(t,n,r,i,s){return function(t,n,r,i,s){e(i>t.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),t.allWrites.push({path:n,snap:r,writeId:i,visible:s}),s&&(t.visibleWrites=Tm(t.visibleWrites,n,r)),t.lastWriteId=i}(t.pendingWriteTree_,n,r,i,s),s?Sy(t,new hm({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},n,r)):[]}function by(t,n,r=!1){const i=function(e,t){for(let n=0;n<e.allWrites.length;n++){const r=e.allWrites[n];if(r.writeId===t)return r}return null}(t.pendingWriteTree_,n);if(function(t,n){const r=t.allWrites.findIndex(e=>e.writeId===n);e(r>=0,"removeWrite called with nonexistent writeId.");const i=t.allWrites[r];t.allWrites.splice(r,1);let s=i.visible,o=!1,a=t.allWrites.length-1;for(;s&&a>=0;){const e=t.allWrites[a];e.visible&&(a>=r&&Lm(e,i.path)?s=!1:sg(i.path,e.path)&&(o=!0)),a--}return!!s&&(o?(function(e){e.visibleWrites=Fm(e.allWrites,Mm,Kp()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(t),!0):(i.snap?t.visibleWrites=km(t.visibleWrites,i.path):gp(i.children,e=>{t.visibleWrites=km(t.visibleWrites,eg(i.path,e))}),!0))}(t.pendingWriteTree_,n)){let e=new Im(null);return null!=i.snap?e=e.set(Kp(),!0):gp(i.children,t=>{e=e.set(new Hp(t),!0)}),Sy(t,new um(i.path,e,r))}return[]}function Iy(e,t,n){return Sy(e,new hm({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Ey(t,n,r,i,s=!1){const o=n._path,a=t.syncPointTree_.get(o);let c=[];if(a&&("default"===n._queryIdentifier||gy(a,n))){const u=function(t,n,r,i){const s=n._queryIdentifier,o=[];let a=[];const c=my(t);if("default"===s)for(const[e,n]of t.views.entries())a=a.concat(iy(n,r,i)),ry(n)&&(t.views.delete(e),n.query._queryParams.loadsAllData()||o.push(n.query));else{const e=t.views.get(s);e&&(a=a.concat(iy(e,r,i)),ry(e)&&(t.views.delete(s),e.query._queryParams.loadsAllData()||o.push(e.query)))}return c&&!my(t)&&o.push(new(e(ay,"Reference.ts has not been loaded"),ay)(n._repo,n._path)),{removed:o,events:a}}(a,n,r,i);0===a.views.size&&(t.syncPointTree_=t.syncPointTree_.remove(o));const l=u.removed;if(c=u.events,!s){const e=-1!==l.findIndex(e=>e._queryParams.loadsAllData()),r=t.syncPointTree_.findOnPath(o,(e,t)=>my(t));if(e&&!r){const e=t.syncPointTree_.subtree(o);if(!e.isEmpty()){const n=function(e){return e.fold((e,t,n)=>{if(t&&my(t))return[yy(t)];{let e=[];return t&&(e=dy(t)),gp(n,(t,n)=>{e=e.concat(n)}),e}})}(e);for(let e=0;e<n.length;++e){const r=n[e],i=r.query,s=Ny(t,r);t.listenProvider_.startListening(My(i),Ry(t,i),s.hashFn,s.onComplete)}}}if(!r&&l.length>0&&!i)if(e){const e=null;t.listenProvider_.stopListening(My(n),e)}else l.forEach(e=>{const n=t.queryToTagMap.get(Py(e));t.listenProvider_.stopListening(My(e),n)})}!function(e,t){for(let n=0;n<t.length;++n){const r=t[n];if(!r._queryParams.loadsAllData()){const t=Py(r),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(t,l)}return c}function Ty(e,t,n,r){const i=Dy(e,r);if(null!=i){const r=Oy(i),s=r.path,o=r.queryId,a=ng(s,t);return Ly(e,s,new hm(cm(o),a,n))}return[]}function Cy(t,n,r,i=!1){const s=n._path;let o=null,a=!1;t.syncPointTree_.foreachOnPath(s,(e,t)=>{const n=ng(e,s);o=o||fy(t,n),a=a||my(t)});let c,u=t.syncPointTree_.get(s);u?(a=a||my(u),o=o||fy(u,Kp())):(u=new uy,t.syncPointTree_=t.syncPointTree_.set(s,u)),null!=o?c=!0:(c=!1,o=Fg.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((e,t)=>{const n=fy(t,Kp());n&&(o=o.updateImmediateChild(e,n))}));const l=gy(u,n);if(!l&&!n._queryParams.loadsAllData()){const r=Py(n);e(!t.queryToTagMap.has(r),"View does not exist, but we have a tag");const i=_y++;t.queryToTagMap.set(r,i),t.tagToQueryMap.set(i,r)}let h=function(e,t,n,r,i,s){const o=hy(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){const n=e.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Ag,(e,t)=>{r.push(Bg(e,t))}),n.isFullyInitialized()&&r.push($g(n.getNode())),oy(e,r,n.getNode(),t)}(o,n)}(u,n,r,Om(t.pendingWriteTree_,s),o,c);if(!l&&!a&&!i){const r=py(u,n);h=h.concat(function(t,n,r){const i=n._path,s=Ry(t,n),o=Ny(t,r),a=t.listenProvider_.startListening(My(n),s,o.hashFn,o.onComplete),c=t.syncPointTree_.subtree(i);if(s)e(!my(c.value),"If we're adding a query, it shouldn't be shadowed");else{const e=c.fold((e,t,n)=>{if(!tg(e)&&t&&my(t))return[yy(t).query];{let e=[];return t&&(e=e.concat(dy(t).map(e=>e.query))),gp(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<e.length;++n){const r=e[n];t.listenProvider_.stopListening(My(r),Ry(t,r))}}return a}(t,n,r))}return h}function ky(e,t,n){const r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,n)=>{const r=fy(n,ng(e,t));if(r)return r});return Um(r,t,i,n,!0)}function Sy(e,t){return xy(t,e.syncPointTree_,null,Om(e.pendingWriteTree_,Kp()))}function xy(e,t,n,r){if(tg(e.path))return Ay(e,t,n,r);{const i=t.get(Kp());null==n&&null!=i&&(n=fy(i,Kp()));let s=[];const o=Gp(e.path),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){const e=n?n.getImmediateChild(o):null,t=zm(r,o);s=s.concat(xy(a,c,e,t))}return i&&(s=s.concat(ly(i,e,r,n))),s}}function Ay(e,t,n,r){const i=t.get(Kp());null==n&&null!=i&&(n=fy(i,Kp()));let s=[];return t.children.inorderTraversal((t,i)=>{const o=n?n.getImmediateChild(t):null,a=zm(r,t),c=e.operationForChild(t);c&&(s=s.concat(Ay(c,i,o,a)))}),i&&(s=s.concat(ly(i,e,r,n))),s}function Ny(e,t){const n=t.query,r=Ry(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||Fg.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return r?function(e,t,n){const r=Dy(e,n);if(r){const n=Oy(r),i=n.path,s=n.queryId,o=ng(i,t);return Ly(e,i,new lm(cm(s),o))}return[]}(e,n._path,r):function(e,t){return Sy(e,new lm({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const r=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(t,n);return Ey(e,n,null,r)}}}}function Ry(e,t){const n=Py(t);return e.queryToTagMap.get(n)}function Py(e){return e._path.toString()+"$"+e._queryIdentifier}function Dy(e,t){return e.tagToQueryMap.get(t)}function Oy(t){const n=t.indexOf("$");return e(-1!==n&&n<t.length-1,"Bad queryKey."),{queryId:t.substr(n+1),path:new Hp(t.substr(0,n))}}function Ly(t,n,r){const i=t.syncPointTree_.get(n);return e(i,"Missing sync point for query tag that we're tracking"),ly(i,r,Om(t.pendingWriteTree_,n),null)}function My(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(e(cy,"Reference.ts has not been loaded"),cy)(t._repo,t._path):t}class Fy{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Fy(t)}node(){return this.node_}}class Uy{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=eg(this.path_,e);return new Uy(this.syncTree_,t)}node(){return ky(this.syncTree_,this.path_)}}const Vy=function(t,n,r){return t&&"object"==typeof t?(e(".sv"in t,"Unexpected leaf node or priority contents"),"string"==typeof t[".sv"]?jy(t[".sv"],n,r):"object"==typeof t[".sv"]?qy(t[".sv"],n):void e(!1,"Unexpected server value: "+JSON.stringify(t,null,2))):t},jy=function(t,n,r){if("timestamp"===t)return r.timestamp;e(!1,"Unexpected server value: "+t)},qy=function(t,n,r){t.hasOwnProperty("increment")||e(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const i=t.increment;"number"!=typeof i&&e(!1,"Unexpected increment value: "+i);const s=n.node();if(e(null!=s,"Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const o=s.getValue();return"number"!=typeof o?i:o+i},$y=function(e,t,n){return By(e,new Fy(t),n)};function By(e,t,n){const r=e.getPriority().val(),i=Vy(r,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const r=e,s=Vy(r.getValue(),t,n);return s!==r.getValue()||i!==r.getPriority().val()?new xg(s,Vg(i)):e}{const r=e;return s=r,i!==r.getPriority().val()&&(s=s.updatePriority(new xg(i))),r.forEachChild(Ag,(e,r)=>{const i=By(r,t.getImmediateChild(e),n);i!==r&&(s=s.updateImmediateChild(e,i))}),s}}class zy{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Wy(e,t){let n=t instanceof Hp?t:new Hp(t),r=e,i=Gp(n);for(;null!==i;){const e=L(r.node.children,i)||{children:{},childCount:0};r=new zy(i,r,e),n=Yp(n),i=Gp(n)}return r}function Hy(e){return e.node.value}function Ky(e,t){e.node.value=t,Jy(e)}function Gy(e){return e.node.childCount>0}function Qy(e,t){gp(e.node.children,(n,r)=>{t(new zy(n,e,r))})}function Yy(e,t,n,r){n&&!r&&t(e),Qy(e,e=>{Yy(e,t,!0,r)}),n&&r&&t(e)}function Xy(e){return new Hp(null===e.parent?e.name:Xy(e.parent)+"/"+e.name)}function Jy(e){null!==e.parent&&function(e,t,n){const r=function(e){return void 0===Hy(e)&&!Gy(e)}(n),i=O(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,Jy(e)):r||i||(e.node.children[t]=n.node,e.node.childCount++,Jy(e))}(e.parent,e.name,e)}const Zy=/[\[\].#$\/\u0000-\u001F\u007F]/,e_=/[\[\].#$\u0000-\u001F\u007F]/,t_=10485760,n_=function(e){return"string"==typeof e&&0!==e.length&&!Zy.test(e)},r_=function(e){return"string"==typeof e&&0!==e.length&&!e_.test(e)},i_=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!ap(e)||e&&"object"==typeof e&&O(e,".sv")},s_=function(e,t,n,r){r&&void 0===t||o_(H(e,"value"),t,n)},o_=function(e,t,n){const r=n instanceof Hp?new og(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+cg(r));if("function"==typeof t)throw new Error(e+"contains a function "+cg(r)+" with contents = "+t.toString());if(ap(t))throw new Error(e+"contains "+t.toString()+" "+cg(r));if("string"==typeof t&&t.length>t_/3&&K(t)>t_)throw new Error(e+"contains a string greater than "+t_+" utf8 bytes "+cg(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,i=!1;if(gp(t,(t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!n_(t)))throw new Error(e+" contains an invalid key ("+t+") "+cg(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=K(t),ag(e)}(r,t),o_(e,s,r),function(e){const t=e.parts_.pop();e.byteLength_-=K(t),e.parts_.length>0&&(e.byteLength_-=1)}(r)}),n&&i)throw new Error(e+' contains ".value" child '+cg(r)+" in addition to actual children.")}},a_=function(e,t,n,r){if(!(r&&void 0===n||r_(n)))throw new Error(H(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},c_=function(e,t){if(".info"===Gp(t))throw new Error(e+" failed = Can't modify data under /.info/")};class u_{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function l_(e,t){let n=null;for(let r=0;r<t.length;r++){const i=t[r],s=i.getPath();null===n||ig(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(i)}n&&e.eventLists_.push(n)}function h_(e,t,n){l_(e,n),f_(e,e=>ig(e,t))}function d_(e,t,n){l_(e,n),f_(e,e=>sg(e,t)||sg(t,e))}function f_(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){const i=e.eventLists_[r];i&&(t(i.path)?(p_(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}function p_(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const r=n.getEventRunner();ep&&np("event: "+n.toString()),vp(r)}}}class g_{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new u_,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=em(),this.transactionQueueTree_=new zy,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function m_(e,t,n){if(e.stats_=Op(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Jg(e.repoInfo_,(t,n,r,i)=>{v_(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>w_(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{P(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new hg(e.repoInfo_,t,(t,n,r,i)=>{v_(e,t,n,r,i)},t=>{w_(e,t)},t=>{!function(e,t){gp(t,(t,n)=>{b_(e,t,n)})}(e,t)},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(t){const n=t.toString();return Dp[n]||(Dp[n]=new sm(e.stats_,e.server_)),Dp[n]}(e.repoInfo_),e.infoData_=new Zg,e.infoSyncTree_=new vy({startListening:(t,n,r,i)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=Iy(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),b_(e,"connected",!1),e.serverSyncTree_=new vy({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,(n,r)=>{const s=i(n,r);d_(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function y_(e){const t=e.infoData_.getNode(new Hp(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function __(e){return(t=(t={timestamp:y_(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function v_(e,t,n,r,i){e.dataUpdateCount++;const s=new Hp(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i)if(r){const t=F(n,e=>Vg(e));o=function(e,t,n,r){const i=Dy(e,r);if(i){const r=Oy(i),s=r.path,o=r.queryId,a=ng(s,t),c=Im.fromObject(n);return Ly(e,s,new dm(cm(o),a,c))}return[]}(e.serverSyncTree_,s,t,i)}else{const t=Vg(n);o=Ty(e.serverSyncTree_,s,t,i)}else if(r){const t=F(n,e=>Vg(e));o=function(e,t,n){const r=Im.fromObject(n);return Sy(e,new dm({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,s,t)}else{const t=Vg(n);o=Iy(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=N_(e,s)),d_(e.eventQueue_,a,o)}function w_(e,t){b_(e,"connected",t),!1===t&&function(e){k_(e,"onDisconnectEvents");const t=__(e),n=em();rm(e.onDisconnect_,Kp(),(r,i)=>{const s=function(e,t,n,r){return By(t,new Uy(n,e),r)}(r,i,e.serverSyncTree_,t);tm(n,r,s)});let r=[];rm(n,Kp(),(t,n)=>{r=r.concat(Iy(e.serverSyncTree_,t,n));const i=L_(e,t);N_(e,i)}),e.onDisconnect_=em(),d_(e.eventQueue_,Kp(),r)}(e)}function b_(e,t,n){const r=new Hp("/.info/"+t),i=Vg(n);e.infoData_.updateSnapshot(r,i);const s=Iy(e.infoSyncTree_,r,i);d_(e.eventQueue_,r,s)}function I_(e){return e.nextWriteId_++}function E_(e,t,n){e.server_.onDisconnectCancel(t.toString(),(r,i)=>{"ok"===r&&nm(e.onDisconnect_,t),S_(0,n,r,i)})}function T_(e,t,n,r){const i=Vg(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),(n,s)=>{"ok"===n&&tm(e.onDisconnect_,t,i),S_(0,r,n,s)})}function C_(e,t,n){let r;r=".info"===Gp(t._path)?Ey(e.infoSyncTree_,t,n):Ey(e.serverSyncTree_,t,n),h_(e.eventQueue_,t._path,r)}function k_(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),np(n,...t)}function S_(e,t,n,r){t&&vp(()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let i=e;r&&(i+=": "+r);const s=new Error(i);s.code=e,t(s)}})}function x_(e,t,n){return ky(e.serverSyncTree_,t,n)||Fg.EMPTY_NODE}function A_(t,n=t.transactionQueueTree_){if(n||O_(t,n),Hy(n)){const r=P_(t,n);e(r.length>0,"Sending zero length transaction queue"),r.every(e=>0===e.status)&&function(t,n,r){const i=r.map(e=>e.currentWriteId),s=x_(t,n,i);let o=s;const a=s.hash();for(let t=0;t<r.length;t++){const i=r[t];e(0===i.status,"tryToSendTransactionQueue_: items in queue should all be run."),i.status=1,i.retryCount++;const s=ng(n,i.path);o=o.updateChild(s,i.currentOutputSnapshotRaw)}const c=o.val(!0),u=n;t.server_.put(u.toString(),c,e=>{k_(t,"transaction put response",{path:u.toString(),status:e});let i=[];if("ok"===e){const e=[];for(let n=0;n<r.length;n++)r[n].status=2,i=i.concat(by(t.serverSyncTree_,r[n].currentWriteId)),r[n].onComplete&&e.push(()=>r[n].onComplete(null,!0,r[n].currentOutputSnapshotResolved)),r[n].unwatcher();O_(t,Wy(t.transactionQueueTree_,n)),A_(t,t.transactionQueueTree_),d_(t.eventQueue_,n,i);for(let t=0;t<e.length;t++)vp(e[t])}else{if("datastale"===e)for(let e=0;e<r.length;e++)3===r[e].status?r[e].status=4:r[e].status=0;else{op("transaction at "+u.toString()+" failed: "+e);for(let t=0;t<r.length;t++)r[t].status=4,r[t].abortReason=e}N_(t,n)}},a)}(t,Xy(n),r)}else Gy(n)&&Qy(n,e=>{A_(t,e)})}function N_(t,n){const r=R_(t,n),i=Xy(r);return function(t,n,r){if(0===n.length)return;const i=[];let s=[];const o=n.filter(e=>0===e.status),a=o.map(e=>e.currentWriteId);for(let o=0;o<n.length;o++){const c=n[o],u=ng(r,c.path);let l,h=!1;if(e(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),4===c.status)h=!0,l=c.abortReason,s=s.concat(by(t.serverSyncTree_,c.currentWriteId,!0));else if(0===c.status)if(c.retryCount>=25)h=!0,l="maxretry",s=s.concat(by(t.serverSyncTree_,c.currentWriteId,!0));else{const e=x_(t,c.path,a);c.currentInputSnapshot=e;const r=n[o].update(e.val());if(void 0!==r){o_("transaction failed: Data returned ",r,c.path);let n=Vg(r);"object"==typeof r&&null!=r&&O(r,".priority")||(n=n.updatePriority(e.getPriority()));const i=c.currentWriteId,o=__(t),u=$y(n,e,o);c.currentOutputSnapshotRaw=n,c.currentOutputSnapshotResolved=u,c.currentWriteId=I_(t),a.splice(a.indexOf(i),1),s=s.concat(wy(t.serverSyncTree_,c.path,u,c.currentWriteId,c.applyLocally)),s=s.concat(by(t.serverSyncTree_,i,!0))}else h=!0,l="nodata",s=s.concat(by(t.serverSyncTree_,c.currentWriteId,!0))}d_(t.eventQueue_,r,s),s=[],h&&(n[o].status=2,function(e){setTimeout(e,Math.floor(0))}(n[o].unwatcher),n[o].onComplete&&("nodata"===l?i.push(()=>n[o].onComplete(null,!1,n[o].currentInputSnapshot)):i.push(()=>n[o].onComplete(new Error(l),!1,null))))}O_(t,t.transactionQueueTree_);for(let e=0;e<i.length;e++)vp(i[e]);A_(t,t.transactionQueueTree_)}(t,P_(t,r),i),i}function R_(e,t){let n,r=e.transactionQueueTree_;for(n=Gp(t);null!==n&&void 0===Hy(r);)r=Wy(r,n),n=Gp(t=Yp(t));return r}function P_(e,t){const n=[];return D_(e,t,n),n.sort((e,t)=>e.order-t.order),n}function D_(e,t,n){const r=Hy(t);if(r)for(let e=0;e<r.length;e++)n.push(r[e]);Qy(t,t=>{D_(e,t,n)})}function O_(e,t){const n=Hy(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Ky(t,n.length>0?n:void 0)}Qy(t,t=>{O_(e,t)})}function L_(e,t){const n=Xy(R_(e,t)),r=Wy(e.transactionQueueTree_,t);return function(e,t){let n=e.parent;for(;null!==n;){if(t(n))return!0;n=n.parent}}(r,t=>{M_(e,t)}),M_(e,r),Yy(r,t=>{M_(e,t)}),n}function M_(t,n){const r=Hy(n);if(r){const i=[];let s=[],o=-1;for(let n=0;n<r.length;n++)3===r[n].status||(1===r[n].status?(e(o===n-1,"All SENT items should be at beginning of queue."),o=n,r[n].status=3,r[n].abortReason="set"):(e(0===r[n].status,"Unexpected transaction status in abort"),r[n].unwatcher(),s=s.concat(by(t.serverSyncTree_,r[n].currentWriteId,!0)),r[n].onComplete&&i.push(r[n].onComplete.bind(null,new Error("set"),!1,null))));-1===o?Ky(n,void 0):r.length=o+1,d_(t.eventQueue_,Xy(n),s);for(let e=0;e<i.length;e++)vp(i[e])}}const F_=function(e,t){const n=U_(e),r=n.namespace;"firebase.com"===n.domain&&sp(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||sp("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&op("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new Ap(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new Hp(n.pathString)}},U_=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",c=443;if("string"==typeof e){let u=e.indexOf("//");u>=0&&(a=e.substring(0,u-1),e=e.substring(u+2));let l=e.indexOf("/");-1===l&&(l=e.length);let h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(l,h)),l<h&&(i=function(e){let t="";const n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let r=n[e];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(e){}t+="/"+r}return t}(e.substring(l,h)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):op(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,h)));u=t.indexOf(":"),u>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(u+1),10)):u=t.length;const f=t.slice(0,u);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:c,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}},V_="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",j_=function(){let t=0;const n=[];return function(r){const i=r===t;let s;t=r;const o=new Array(8);for(s=7;s>=0;s--)o[s]=V_.charAt(r%64),r=Math.floor(r/64);e(0===r,"Cannot push at time == 0");let a=o.join("");if(i){for(s=11;s>=0&&63===n[s];s--)n[s]=0;n[s]++}else for(s=0;s<12;s++)n[s]=Math.floor(64*Math.random());for(s=0;s<12;s++)a+=V_.charAt(n[s]);return e(20===a.length,"nextPushId: Length should be 20."),a}}();class q_{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+P(this.snapshot.exportVal())}}class $_{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class B_{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(t){return e(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class z_{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new y;return E_(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){c_("OnDisconnect.remove",this._path);const e=new y;return T_(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){c_("OnDisconnect.set",this._path),s_("OnDisconnect.set",e,this._path,!1);const t=new y;return T_(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){c_("OnDisconnect.setWithPriority",this._path),s_("OnDisconnect.setWithPriority",e,this._path,!1),function(e,t,n){if(!n||void 0!==t){if(ap(t))throw new Error(H(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!i_(t))throw new Error(H(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}("OnDisconnect.setWithPriority",t,!1);const n=new y;return function(e,t,n,r,i){const s=Vg(n,r);e.server_.onDisconnectPut(t.toString(),s.val(!0),(n,r)=>{"ok"===n&&tm(e.onDisconnect_,t,s),S_(0,i,n,r)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){c_("OnDisconnect.update",this._path),function(e,t,n,r){if(r&&void 0===t)return;const i=H(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];gp(t,(e,t)=>{const r=new Hp(e);if(o_(i,t,eg(n,r)),".priority"===Xp(r)&&!i_(t))throw new Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(r)}),function(e,t){let n,r;for(n=0;n<t.length;n++){r=t[n];const i=Jp(r);for(let t=0;t<i.length;t++)if(".priority"===i[t]&&t===i.length-1);else if(!n_(i[t]))throw new Error(e+"contains an invalid key ("+i[t]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(rg);let i=null;for(n=0;n<t.length;n++){if(r=t[n],null!==i&&sg(i,r))throw new Error(e+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}}(i,s)}("OnDisconnect.update",e,this._path,!1);const t=new y;return function(e,t,n,r){if(M(n))return np("onDisconnect().update() called with empty data.  Don't do anything."),void S_(0,r,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,(i,s)=>{"ok"===i&&gp(n,(n,r)=>{const i=Vg(r);tm(e.onDisconnect_,eg(t,n),i)}),S_(0,r,i,s)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class W_{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return tg(this._path)?null:Xp(this._path)}get ref(){return new H_(this._repo,this._path)}get _queryIdentifier(){const e=Xg(this._queryParams),t=fp(e);return"{}"===t?"default":t}get _queryObject(){return Xg(this._queryParams)}isEqual(e){if(!((e=G(e))instanceof W_))return!1;const t=this._repo===e._repo,n=ig(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class H_ extends W_{constructor(e,t){super(e,t,new Qg,!1)}get parent(){const e=Zp(this._path);return null===e?null:new H_(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class K_{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Hp(e),n=Q_(this.ref,e);return new K_(this._node.getChild(t),n,Ag)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,n)=>e(new K_(n,Q_(this.ref,t),Ag)))}hasChild(e){const t=new Hp(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function G_(e,t){return(e=G(e))._checkNotDeleted("ref"),void 0!==t?Q_(e._root,t):e._root}function Q_(e,t){var n;return null===Gp((e=G(e))._path)?((n=t)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),a_("child","path",n,false)):a_("child","path",t,!1),new H_(e._repo,eg(e._path,t))}function Y_(e,t){e=G(e),c_("set",e._path),s_("set",t,e._path,!1);const n=new y;return function(e,t,n,r,i){k_(e,"set",{path:t.toString(),value:n,priority:r});const s=__(e),o=Vg(n,r),a=ky(e.serverSyncTree_,t),c=$y(o,a,s),u=I_(e),l=wy(e.serverSyncTree_,t,c,u,!0);l_(e.eventQueue_,l),e.server_.put(t.toString(),o.val(!0),(n,r)=>{const s="ok"===n;s||op("set at "+t+" failed: "+n);const o=by(e.serverSyncTree_,u,!s);d_(e.eventQueue_,t,o),S_(0,i,n,r)});const h=L_(e,t);N_(e,h),d_(e.eventQueue_,h,[])}(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function X_(e){e=G(e);const t=new B_(()=>{}),n=new J_(t);return function(e,t,n){const r=function(e,t){const n=t._path;let r=null;e.syncPointTree_.foreachOnPath(n,(e,t)=>{const i=ng(e,n);r=r||fy(t,i)});let i=e.syncPointTree_.get(n);i?r=r||fy(i,Kp()):(i=new uy,e.syncPointTree_=e.syncPointTree_.set(n,i));const s=null!=r,o=s?new fm(r,!0,!1):null;return vm(hy(i,t,Om(e.pendingWriteTree_,t._path),s?o.getNode():Fg.EMPTY_NODE,s).viewCache_)}(e.serverSyncTree_,t);return null!=r?Promise.resolve(r):e.server_.get(t).then(r=>{const i=Vg(r).withIndex(t._queryParams.getIndex());let s;if(Cy(e.serverSyncTree_,t,n,!0),t._queryParams.loadsAllData())s=Iy(e.serverSyncTree_,t._path,i);else{const n=Ry(e.serverSyncTree_,t);s=Ty(e.serverSyncTree_,t._path,i,n)}return d_(e.eventQueue_,t._path,s),Ey(e.serverSyncTree_,t,n,null,!0),i},n=>(k_(e,"get for query "+P(t)+" failed: "+n),Promise.reject(new Error(n))))}(e._repo,e,n).then(t=>new K_(t,new H_(e._repo,e._path),e._queryParams.getIndex()))}class J_{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new q_("value",this,new K_(e.snapshotNode,new H_(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new $_(this,e,t):null}matches(e){return e instanceof J_&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Z_{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new $_(this,e,t):null}createEvent(t,n){e(null!=t.childName,"Child events should have a childName.");const r=Q_(new H_(n._repo,n._path),t.childName),i=n._queryParams.getIndex();return new q_(t.type,this,new K_(t.snapshotNode,r,i),t.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Z_&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function ev(e,t,n,r){return function(e,t,n,r,i){let s;if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){const t=n,r=(n,r)=>{C_(e._repo,e,a),t(n,r)};r.userCallback=n.userCallback,r.context=n.context,n=r}const o=new B_(n,s||void 0),a="value"===t?new J_(o):new Z_(t,o);return function(e,t,n){let r;r=".info"===Gp(t._path)?Cy(e.infoSyncTree_,t,n):Cy(e.serverSyncTree_,t,n),h_(e.eventQueue_,t._path,r)}(e._repo,e,a),()=>C_(e._repo,e,a)}(e,"value",t,n,r)}!function(t){e(!ay,"__referenceConstructor has already been defined"),ay=t}(H_),function(t){e(!cy,"__referenceConstructor has already been defined"),cy=t}(H_);const tv={};function nv(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||sp("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),np("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a,c=F_(s,i),u=c.repoInfo;"undefined"!=typeof process&&process.env&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,s=`http://${a}?ns=${u.namespace}`,c=F_(s,i),u=c.repoInfo):o=!c.repoInfo.secure;const l=i&&o?new Ep(Ep.OWNER):new Ip(e.name,e.options,t);(function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!n_(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),r_(e)}(n))throw new Error(H(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",c),tg(c.path)||sp("Database URL must point to the root of a Firebase Database (not including a child path).");const h=function(e,t,n,r){let i=tv[t.name];i||(i={},tv[t.name]=i);let s=i[e.toURLString()];return s&&sp("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new g_(e,false,n,r),i[e.toURLString()]=s,s}(u,e,l,new bp(e,n));return new rv(h,e)}class rv{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(m_(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new H_(this._repo,Kp())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=tv[t];n&&n[e.key]===e||sp(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&sp("Cannot call "+e+" on a deleted database.")}}hg.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},hg.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},zf=ut,it(new Q("database",(e,{instanceIdentifier:t})=>nv(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),dt($f,Bf,void 0),dt($f,Bf,"esm2017");const iv={apiKey:"AIzaSyCOsNLLxNDckFUIXOfOaMphlr6WlSRBxqA",authDomain:"chatonline-42b5a.firebaseapp.com",projectId:"chatonline-42b5a",storageBucket:"chatonline-42b5a.firebasestorage.app",messagingSenderId:"823959172627",appId:"1:823959172627:web:76ad14c35304661fac71e6",measurementId:"G-7LT3965R88",databaseURL:"https://chatonline-42b5a-default-rtdb.europe-west1.firebasedatabase.app"};try{const e=lt(iv);window.auth=function(e=ht()){const t=st(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=st(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(U(n.getOptions(),null!=t?t:{}))return e;St(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:bi,persistence:[Vr,Ir,Tr]}),r=m("authTokenSyncURL");if(r&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=(i=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Ci)return;const r=null==t?void 0:t.token;ki!==r&&(ki=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});!function(e,t,n){G(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e){G(e).onIdTokenChanged(e=>t(e),void 0,void 0)}(n)}}var i;const s=f("auth");return s&&function(e,t,n){const r=Ln(e);Pt(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=Hn(t),{host:o,port:a}=function(e){const t=Hn(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Kn(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Kn(t)}}}(t),c=null===a?"":`:${a}`,u={url:`${s}//${o}${c}/`},l=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator)return Pt(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void Pt(U(u,r.config.emulator)&&U(l,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=u,r.emulatorConfig=l,r.settings.appVerificationDisabledForTesting=!0,_(o)?(v(`${s}//${o}${c}`),E("Auth",!0)):i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${s}`),n}(e),window.db=function(e){const t="object"==typeof e?e:ht(),n="string"==typeof e?e:ko,r=st(t,"firestore").getImmediate({identifier:n});if(!r._initialized){const e=p("firestore");e&&function(e,t,n,r={}){var i;e=bd(e,Cd);const s=_(t),o=e._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:e._getEmulatorOptions()}),c=`${t}:${n}`;s&&(v(`https://${c}`),E("Firestore",!0)),o.host!==Id&&o.host!==c&&Xi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u=Object.assign(Object.assign({},o),{host:c,ssl:s,emulatorOptions:r});if(!U(u,a)&&(e._setSettings(u),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Wi.MOCK_USER;else{t=w(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new is(rs.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Wi(s)}e._authCredentials=new cs(new os(t,n))}}(r,...e)}return r}(e),window.rtdb=function(e=ht(),t){const n=st(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=p("database");e&&function(e,t,n,r={}){(e=G(e))._checkNotDeleted("useEmulator");const i=`${t}:${n}`,s=e._repoInternal;if(e._instanceStarted){if(i===e._repoInternal.repoInfo_.host&&U(r,s.repoInfo_.emulatorOptions))return;sp("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)r.mockUserToken&&sp('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Ep(Ep.OWNER);else if(r.mockUserToken){const t="string"==typeof r.mockUserToken?r.mockUserToken:w(r.mockUserToken,e.app.options.projectId);o=new Ep(t)}_(t)&&(v(t),E("Database",!0)),function(e,t,n,r){const i=t.lastIndexOf(":"),s=_(t.substring(0,i));e.repoInfo_=new Ap(t,s,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(e.authTokenProvider_=r)}(s,i,r,o)}(n,...e)}return n}(e)}catch(ip){console.error("Firebase initialization failed:",ip),alert("Ошибка инициализации Firebase: "+ip.message)}let sv=null,ov=null;function av(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}async function cv(e){const t=Nd(db,"users",sv.uid),n=await Df(t),r=n.data().lastAction?.[e]||0;if(Date.now()-r<5e3)throw new Error("Слишком частые действия, подождите 5 секунд");await Ff(t,{[`lastAction.${e}`]:Date.now()})}async function uv(e="all"){try{let t;if("friends"===e&&sv){const e=await Lf(ff(Ad(window.db,"friends"),gf("status","==","accepted"),gf("userId1","==",sv.uid))),n=await Lf(ff(Ad(window.db,"friends"),gf("status","==","accepted"),gf("userId2","==",sv.uid))),r=[...e.docs.map(e=>e.data().userId2),...n.docs.map(e=>e.data().userId1)];if(0===r.length)return void(document.getElementById("content").innerHTML='\n                    <div class="bg-white dark:bg-gray-900 p-4 rounded-lg shadow">\n                    <div class="mb-4">\n                        <button onclick="window.loadFeed(\'all\')" class="bg-blue-500 text-white px-4 py-2 rounded mr-2">Все</button>\n                        <button onclick="window.loadFeed(\'friends\')" class="bg-gray-300 dark:bg-gray-700 text-black dark:text-white px-4 py-2 rounded">Друзья</button>\n                    </div>\n                    <p class="text-gray-500 dark:text-gray-400">Пусто</p>\n                    </div>\n                ');t=ff(Ad(window.db,"posts"),gf("author","in",r),_f("timestamp","desc"),wf(10))}else t=ff(Ad(window.db,"posts"),_f("timestamp","desc"),wf(10));const n=await Lf(t);ov=n.docs[n.docs.length-1];const r=await Promise.all(n.docs.map(async e=>{const t=e.data(),n=await Df(Nd(window.db,"users",t.author)),r=await Lf(ff(Ad(window.db,"posts",e.id,"comments"),_f("timestamp","asc"),wf(3))),i=await Promise.all(r.docs.map(async e=>{const t=await Df(Nd(db,"users",e.data().author));return{id:e.id,...e.data(),username:t.exists()?t.data().username:"Аноним"}}));return{id:e.id,...t,authorName:n.exists()?n.data().username:"Аноним",authorAvatar:n.exists()&&n.data().avatar||"https://picsum.photos/32",comments:i}}));document.getElementById("content").innerHTML=`\n            <div class="bg-white dark:bg-gray-900 p-4 rounded-lg shadow">\n            <div class="mb-4">\n                <button onclick="window.loadFeed('all')" class="bg-${"all"===e?"blue-500 text-white":"gray-300 dark:bg-gray-700 text-black dark:text-white"} px-4 py-2 rounded mr-2">Все</button>\n                <button onclick="window.loadFeed('friends')" class="bg-${"friends"===e?"blue-500 text-white":"gray-300 dark:bg-gray-700 text-black dark:text-white"} px-4 py-2 rounded">Друзья</button>\n            </div>\n            <div id="posts" class="space-y-4">\n                ${r.map(e=>`\n                <div class="post bg-gray-50 dark:bg-gray-700 p-4 rounded fade-in">\n                    <div class="flex items-center mb-2">\n                    <img src="${e.authorAvatar}" class="w-8 h-8 rounded-full cursor-pointer" onclick="window.loadProfile('${e.author}')">\n                    <h4 class="ml-2 font-semibold cursor-pointer text-gray-900 dark:text-white" onclick="window.loadProfile('${e.author}')">${e.authorName}</h4>\n                    </div>\n                    <p class="text-gray-800 dark:text-gray-200">${av(e.text)}</p>\n                    <div class="flex items-center space-x-4 mt-2">\n                    <button onclick="window.toggleLike('${e.id}')" class="flex items-center space-x-1 text-gray-600 dark:text-gray-300 hover:text-red-500">\n                        <svg class="w-5 h-5" fill="${e.likes?.includes(sv.uid)?"red":"none"}" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>\n                        </svg>\n                        <span>${e.likes?.length||0}</span>\n                    </button>\n                    </div>\n                    <div class="mt-2 space-y-2">\n                    ${e.comments.map(t=>`\n                        <div class="text-sm text-gray-600 dark:text-gray-300">\n                        <span class="font-semibold">${t.username}</span>: ${av(t.text)}\n                        ${t.author===sv.uid?`<button onclick="window.deleteComment('${e.id}', '${t.id}')" class="text-red-500 hover:text-red-600 ml-2 text-xs">Удалить</button>`:""}\n                        </div>\n                    `).join("")}\n                    <form onsubmit="event.preventDefault(); window.addComment('${e.id}', document.getElementById('comment-${e.id}').value)">\n                        <input id="comment-${e.id}" maxlength="200" placeholder="Комментарий..." class="w-full p-2 border rounded bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white">\n                        <button type="submit" class="bg-blue-500 text-white px-4 py-1 rounded hover:bg-blue-600 mt-1">Отправить</button>\n                    </form>\n                    </div>\n                    <div class="flex justify-between items-center mt-2">\n                    <small class="text-gray-500 dark:text-gray-400">${e.timestamp?.toDate().toLocaleString()}</small>\n                    ${e.author===sv.uid?`\n                        <button onclick="window.deletePost('${e.id}')" class="text-red-500 hover:text-red-700">Удалить</button>\n                    `:""}\n                    </div>\n                </div>\n                `).join("")}\n            </div>\n            <button id="load-more" onclick="window.loadMorePosts('${e}')" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mt-4 w-full">Загрузить еще</button>\n            </div>\n        `,r.length<10&&(document.getElementById("load-more").style.display="none")}catch(e){console.error("Feed load failed:",e),alert(`Ошибка загрузки ленты: ${e.message}`)}}G(window.auth).onAuthStateChanged(e=>{sv=e;const t=document.getElementById("nav-links"),n=document.getElementById("logout-btn");if(e){t.style.display="block",n.style.display="flex";const r=G_(window.rtdb,`presence/${e.uid}`);Y_(r,{online:!0,lastSeen:Date.now()}).catch(e=>{console.error("Failed to set Realtime Database presence:",e)}),function(e){return e=G(e),new z_(e._repo,e._path)}(r).set({online:!1,lastSeen:Date.now()}).catch(e=>{console.error("Failed to set onDisconnect:",e)}),Mf(Nd(db,"presence",e.uid),{online:!0,lastSeen:qf()},{merge:!0}).catch(e=>{console.error("Failed to set Firestore presence:",e)}),window.showSection("feed")}else t.style.display="none",n.style.display="none",document.getElementById("content").innerHTML='\n    <div class="auth-form max-w-md mx-auto bg-white dark:bg-gray-900 p-6 rounded-lg shadow-lg">\n        <h2 class="text-2xl font-bold mb-4 text-gray-900 dark:text-white">Вход</h2>\n        <form onsubmit="event.preventDefault(); window.login(document.getElementById(\'loginEmail\').value, document.getElementById(\'loginPassword\').value)">\n        <input id="loginEmail" type="email" placeholder="Email" required class="w-full mb-2 p-2 border rounded bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white">\n        <input id="loginPassword" type="password" placeholder="Пароль" required class="w-full mb-2 p-2 border rounded bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white">\n        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full">Войти</button>\n        </form>\n        <h2 class="text-2xl font-bold mt-6 mb-4 text-gray-900 dark:text-white">Регистрация</h2>\n        <form onsubmit="event.preventDefault(); window.register(document.getElementById(\'registerEmail\').value, document.getElementById(\'registerPassword\').value, document.getElementById(\'registerUsername\').value)">\n        <input id="registerUsername" type="text" placeholder="Имя пользователя" maxlength="20" required class="w-full mb-2 p-2 border rounded bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white">\n        <input id="registerEmail" type="email" placeholder="Email" required class="w-full mb-2 p-2 border rounded bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white">\n        <input id="registerPassword" type="password" placeholder="Пароль" required class="w-full mb-2 p-2 border rounded bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white">\n        <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-700 w-full">Зарегистрироваться</button>\n        </form>\n    </div>\n    '},void 0,void 0),window.showSection=function(e){switch(document.getElementById("content").innerHTML='<div class="loading-spinner"></div>',e){case"feed":window.loadFeed();break;case"profile":window.loadProfile(sv.uid);break;case"search":!async function(){let e;document.getElementById("content").innerHTML='\n    <div class="relative">\n        <form onsubmit="event.preventDefault(); window.handleSearch(document.getElementById(\'searchInput\').value)">\n        <input id="searchInput" type="text" placeholder="Имя пользователя" class="w-full p-2 border rounded bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white">\n        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mt-2">Поиск</button>\n        </form>\n        <div id="searchResults" class="autocomplete absolute w-full bg-white dark:bg-gray-900 shadow-lg rounded-lg mt-1 z-10"></div>\n    </div>\n    ',document.getElementById("searchInput").addEventListener("input",function(){clearTimeout(e),e=setTimeout(()=>handleSearch(this.value,!0),300)})}();break;case"chats":window.loadChats();break;case"friends":window.loadFriends();break;case"settings":Df(Nd(db,"users",sv.uid)).then(e=>{const t=e.exists()?e.data():{messagingPrivacy:"everyone"};document.getElementById("content").innerHTML=`\n        <div class="auth-form max-w-md mx-auto bg-white dark:bg-gray-900 p-6 rounded-lg shadow-lg">\n        <h2 class="text-2xl font-bold mb-4 text-gray-900 dark:text-white">Настройки</h2>\n        <form onsubmit="event.preventDefault(); window.changePassword(document.getElementById('newPassword').value)">\n            <input id="newPassword" type="password" placeholder="Новый пароль" class="w-full p-2 border rounded bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white">\n            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mt-2 w-full">Сменить пароль</button>\n        </form>\n        <form onsubmit="event.preventDefault(); window.updateMessagingPrivacy(document.getElementById('messagingPrivacy').value)" class="mt-4">\n            <label for="messagingPrivacy" class="block mb-2 text-gray-900 dark:text-white">Кто может писать:</label>\n            <select id="messagingPrivacy" class="w-full p-2 border rounded bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white">\n            <option value="everyone" ${"everyone"===t.messagingPrivacy?"selected":""}>Все</option>\n            <option value="friends" ${"friends"===t.messagingPrivacy?"selected":""}>Только друзья</option>\n            </select>\n            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mt-2 w-full">Сохранить</button>\n        </form>\n        \n        </div>\n    `}).catch(e=>{console.error("Settings load failed:",e),alert(`Ошибка загрузки настроек: ${e.message}`)})}},window.login=async function(e,t){try{await function(e,t,n){return ot(e.app)?Promise.reject(Nt(e)):async function(e,t){return mr(Ln(e),t)}(G(e),ir.credential(t,n)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&yr(e),t})}(window.auth,e,t)}catch(e){console.error("Login failed:",e),alert(`Ошибка входа: ${e.message}`)}},window.register=async function(e,t,n){try{if(n.length>20)throw new Error("Имя пользователя слишком длинное (макс. 20 символов)");const{user:r}=await async function(e,t,n){if(ot(e.app))return Promise.reject(Nt(e));const r=Ln(e),i=Wn(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",hr,"EMAIL_PASSWORD_PROVIDER"),s=await i.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&yr(e),t}),o=await dr._fromIdTokenResponse(r,"signIn",s);return await r._updateCurrentUser(o.user),o}(window.auth,e,t);n=av(n),await Mf(Nd(db,"users",r.uid),{username:n,email:e,createdAt:qf(),messagingPrivacy:"everyone",bio:"",avatar:"",profileBackground:""}),await Mf(Nd(db,"presence",r.uid),{online:!0,lastSeen:qf()})}catch(e){console.error("Registration failed:",e),alert(`Ошибка регистрации: ${e.message}`)}},window.logout=async function(){try{const t=sv;if(t&&t.uid){await Mf(Nd(db,"presence",t.uid),{online:!1,lastSeen:qf()},{merge:!0}).catch(e=>{console.error("Failed to set offline presence on logout:",e)});const e=G_(window.rtdb,`presence/${t.uid}`);await Y_(e,{online:!1,lastSeen:Date.now()}).catch(e=>{console.error("Failed to set offline Realtime Database presence on logout:",e)})}await(e=window.auth,G(e).signOut()),window.showSection("auth")}catch(e){console.error("Logout failed:",e),alert(`Ошибка выхода: ${e.message}`)}var e},window.loadFeed=uv,window.loadMorePosts=async function(e){try{let t;if("friends"===e){const e=await Lf(ff(Ad(window.db,"friends"),gf("status","==","accepted"),gf("userId1","==",sv.uid))),n=await Lf(ff(Ad(window.db,"friends"),gf("status","==","accepted"),gf("userId2","==",sv.uid))),r=[...e.docs.map(e=>e.data().userId2),...n.docs.map(e=>e.data().userId1)];if(0===r.length)return;t=ff(Ad(window.db,"posts"),gf("author","in",r),_f("timestamp","desc"),If(ov),wf(10))}else t=ff(Ad(window.db,"posts"),_f("timestamp","desc"),If(ov),wf(10));const n=await Lf(t);ov=n.docs[n.docs.length-1];const r=await Promise.all(n.docs.map(async e=>{const t=e.data(),n=await Df(Nd(window.db,"users",t.author)),r=await Lf(ff(Ad(window.db,"posts",e.id,"comments"),_f("timestamp","asc"),wf(3))),i=await Promise.all(r.docs.map(async e=>{const t=await Df(Nd(db,"users",e.data().author));return{id:e.id,...e.data(),username:t.exists()?t.data().username:"Аноним"}}));return{id:e.id,...t,authorName:n.exists()?n.data().username:"Аноним",authorAvatar:n.exists()&&n.data().avatar||"https://picsum.photos/32",comments:i}}));document.getElementById("posts").innerHTML+=r.map(e=>`\n            <div class="post bg-gray-50 dark:bg-gray-700 p-4 rounded fade-in">\n            <div class="flex items-center mb-2">\n                <img src="${e.authorAvatar}" class="w-8 h-8 rounded-full cursor-pointer" onclick="window.loadProfile('${e.author}')">\n                <h4 class="ml-2 font-semibold cursor-pointer text-gray-900 dark:text-white" onclick="window.loadProfile('${e.author}')">${e.authorName}</h4>\n            </div>\n            <p class="text-gray-800 dark:text-gray-200">${av(e.text)}</p>\n            <div class="flex items-center space-x-4 mt-2">\n                <button onclick="window.toggleLike('${e.id}')" class="flex items-center space-x-1 text-gray-600 dark:text-gray-300 hover:text-red-500">\n                <svg class="w-5 h-5" fill="${e.likes?.includes(sv.uid)?"red":"none"}" stroke="currentColor" viewBox="0 0 24 24">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>\n                </svg>\n                <span>${e.likes?.length||0}</span>\n                </button>\n            </div>\n            <div class="mt-2 space-y-2">\n                ${e.comments.map(t=>`\n                <div class="text-sm text-gray-600 dark:text-gray-300">\n                    <span class="font-semibold">${t.username}</span>: ${av(t.text)}\n                    ${t.author===sv.uid?`<button onclick="window.deleteComment('${e.id}', '${t.id}')" class="text-red-500 hover:text-red-600 ml-2 text-xs">Удалить</button>`:""}\n                </div>\n                `).join("")}\n                <form onsubmit="event.preventDefault(); window.addComment('${e.id}', document.getElementById('comment-${e.id}').value)">\n                <input id="comment-${e.id}" maxlength="200" placeholder="Комментарий..." class="w-full p-2 border rounded bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white">\n                <button type="submit" class="bg-blue-500 text-white px-4 py-1 rounded hover:bg-blue-600 mt-1">Отправить</button>\n                </form>\n            </div>\n            <div class="flex justify-between items-center mt-2">\n                <small class="text-gray-500 dark:text-gray-400">${e.timestamp?.toDate().toLocaleString()}</small>\n                ${e.author===sv.uid?`\n                <button onclick="window.deletePost('${e.id}')" class="text-red-500 hover:text-red-700">Удалить</button>\n                `:""}\n            </div>\n            </div>\n        `).join(""),r.length<10&&(document.getElementById("load-more").style.display="none")}catch(e){console.error("Load more posts failed:",e),alert(`Ошибка загрузки постов: ${e.message}`)}},window.toggleLike=async function(e){try{await cv("like");const t=Nd(db,"posts",e),n=(await Df(t)).data().likes||[];n.includes(sv.uid)?await Ff(t,{likes:n.filter(e=>e!==sv.uid)}):await Ff(t,{likes:[...n,sv.uid]}),uv()}catch(e){console.error("Toggle like failed:",e),alert(`Ошибка: ${e.message}`)}},window.addComment=async function(e,t){try{if(!t.trim())return;if(t.length>200)throw new Error("Комментарий слишком длинный (макс. 200 символов)");await cv("comment"),await Vf(Ad(db,"posts",e,"comments"),{text:t,author:sv.uid,timestamp:qf()}),document.getElementById(`comment-${e}`).value="",uv()}catch(e){console.error("Add comment failed:",e),alert(`Ошибка: ${e.message}`)}},window.deleteComment=async function(e,t){try{await Uf(Nd(db,"posts",e,"comments",t)),uv()}catch(e){console.error("Delete comment failed:",e),alert(`Ошибка: ${e.message}`)}},window.loadProfile=async function(e){try{const t=await Df(Nd(db,"users",e));if(!t.exists())throw new Error("Пользователь не найден");const n=await Lf(ff(Ad(db,"posts"),gf("author","==",e),_f("timestamp","desc"))),r=await Lf(ff(Ad(db,"friends"),gf("userId1","==",e),gf("status","==","accepted"))),i=await Lf(ff(Ad(db,"friends"),gf("userId2","==",e),gf("status","==","accepted"))),s=new Set;r.docs.forEach(e=>s.add(e.data().userId2)),i.docs.forEach(e=>s.add(e.data().userId1));const o=s.size;let a=null;sv&&sv.uid!==e&&(a=await Df(Nd(db,"friends",`${sv.uid}_${e}`)),a.exists()||(a=await Df(Nd(db,"friends",`${e}_${sv.uid}`))));const c=G_(window.rtdb,`presence/${e}`),u=await X_(c).catch(t=>(console.error("Failed to read Realtime presence for",e,":",t),null)),l=u&&u.exists()?u.val():{online:!1},h=t.data(),d=a&&a.exists()?a.data().status:null,f=a&&a.exists()?a.id:null,p=await Promise.all(n.docs.map(async e=>{const t=e.data(),n=await Lf(ff(Ad(db,"posts",e.id,"comments"),_f("timestamp","asc"),wf(3))),r=await Promise.all(n.docs.map(async e=>{const t=await Df(Nd(db,"users",e.data().author));return{id:e.id,...e.data(),username:t.exists()?t.data().username:"Аноним"}}));return{id:e.id,...t,comments:r}}));document.getElementById("content").innerHTML=`\n            <div class="bg-white dark:bg-gray-900 p-6 rounded-lg shadow" style="background-image: url('${h.profileBackground||""}'); background-size: cover; background-position: center;">\n            <div class="flex items-center mb-4">\n                <img src="${h.avatar||"https://picsum.photos/64"}" class="w-16 h-16 rounded-full">\n                <div class="ml-4">\n                <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">${av(h.username)}</h2>\n                <span class="w-3 h-3 rounded-full ${l.online?"bg-green-500":"bg-gray-500"} inline-block"></span>\n                <span class="text-gray-500 dark:text-gray-400 ml-2">${l.online?"В сети":"Не в сети"}</span>\n                </div>\n            </div>\n            <div class="mb-4 text-gray-600 dark:text-gray-300">\n                <span>Постов: ${n.size}</span> | <span>Друзей: ${o}</span>\n            </div>\n            ${e===sv.uid?`\n                <form onsubmit="event.preventDefault(); window.updateProfile(document.getElementById('username').value, document.getElementById('bio').value, document.getElementById('avatar').value, document.getElementById('profileBackground').value)" class="mb-4">\n                <input id="username" type="text" placeholder="Имя пользователя" value="${av(h.username)||""}" maxlength="20" class="w-full p-2 border rounded bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white">\n                <textarea id="bio" placeholder="О себе" maxlength="200" class="w-full p-2 border rounded mt-2 bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white">${av(h.bio)||""}</textarea>\n                <input id="avatar" type="url" placeholder="URL аватара" value="${h.avatar||""}" class="w-full p-2 border rounded mt-2 bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white">\n                <input id="profileBackground" type="url" placeholder="URL фонового изображения" value="${h.profileBackground||""}" class="w-full p-2 border rounded mt-2 bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white">\n                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mt-2">Обновить профиль</button>\n                </form>\n                <form onsubmit="event.preventDefault(); window.addPost(document.getElementById('postText').value)" class="mb-4">\n                <textarea id="postText" placeholder="Что нового?" maxlength="500" required class="w-full p-2 border rounded bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white"></textarea>\n                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mt-2">Опубликовать</button>\n                </form>\n            `:sv?`\n                <div class="mb-4 flex space-x-2">\n                ${"accepted"===d?`\n                    <button onclick="window.removeFriend('${e}', '${f}')" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Удалить из друзей</button>\n                `:"pending"===d&&f===`${sv.uid}_${e}`?'\n                    <button class="bg-gray-500 text-white px-4 py-2 rounded" disabled>Запрос отправлен</button>\n                ':"pending"===d&&f===`${e}_${sv.uid}`?`\n                    <button onclick="window.acceptFriendRequest('${e}', '${f}')" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-700">Принять запрос</button>\n                    <button onclick="window.declineFriendRequest('${e}', '${f}')" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 ml-2">Отклонить</button>\n                `:`\n                    <button onclick="window.addFriend('${e}')" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Добавить в друзья</button>\n                `}\n                <button onclick="window.startChat('${e}')" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-700">Написать</button>\n                </div>\n            `:""}\n            <div class="space-y-4 mt-4">\n                ${p.map(t=>`\n                <div class="post bg-gray-50 dark:bg-gray-700 p-4 rounded fade-in">\n                    <p class="text-gray-800 dark:text-gray-200">${av(t.text)}</p>\n                    <div class="flex items-center space-x-4 mt-2">\n                    <button onclick="window.toggleLike('${t.id}')" class="flex items-center space-x-1 text-gray-600 dark:text-gray-300 hover:text-red-500">\n                        <svg class="w-5 h-5" fill="${t.likes?.includes(sv.uid)?"red":"none"}" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>\n                        </svg>\n                        <span>${t.likes?.length||0}</span>\n                    </button>\n                    </div>\n                    <div class="mt-2 space-y-2">\n                    ${t.comments.map(e=>`\n                        <div class="text-sm text-gray-600 dark:text-gray-300">\n                        <span class="font-semibold">${e.username}</span>: ${av(e.text)}\n                        ${e.author===sv.uid?`<button onclick="window.deleteComment('${t.id}', '${e.id}')" class="text-red-500 hover:text-red-600 ml-2 text-xs">Удалить</button>`:""}\n                        </div>\n                    `).join("")}\n                    <form onsubmit="event.preventDefault(); window.addComment('${t.id}', document.getElementById('comment-${t.id}').value)">\n                        <input id="comment-${t.id}" maxlength="200" placeholder="Комментарий..." class="w-full p-2 border rounded bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white">\n                        <button type="submit" class="bg-blue-500 text-white px-4 py-1 rounded hover:bg-blue-600 mt-1">Отправить</button>\n                    </form>\n                    </div>\n                    <div class="flex justify-between items-center mt-2">\n                    <small class="text-gray-500 dark:text-gray-400">${t.timestamp?.toDate().toLocaleString()}</small>\n                    ${e===sv.uid?`\n                        <button onclick="window.deletePost('${t.id}')" class="text-red-500 hover:text-red-700">Удалить</button>\n                    `:""}\n                    </div>\n                </div>\n                `).join("")}\n            </div>\n            </div>\n        `}catch(t){console.error("Profile load failed:",t,"UID:",e),alert(`Ошибка загрузки профиля: ${t.message}`),window.showSection("feed")}},window.addPost=async function(e){try{if(e.length>500)throw new Error("Пост слишком длинный (макс. 500 символов)");await cv("post"),await Vf(Ad(window.db,"posts"),{text:e,author:sv.uid,timestamp:qf(),likes:[]}),window.loadProfile(sv.uid)}catch(e){console.error("Post creation failed:",e),alert(`Ошибка публикации: ${e.message}`)}},window.deletePost=async function(e){try{await Uf(Nd(window.db,"posts",e)),window.loadProfile(sv.uid)}catch(e){console.error("Post deletion failed:",e),alert(`Ошибка удаления записи: ${e.message}`)}},window.handleSearch=async function(e,t=!1){try{const n=await Lf(ff(Ad(window.db,"users"),gf("username",">=",e),gf("username","<=",e+""),wf(t?5:20))),r=document.getElementById("searchResults");r.innerHTML=await Promise.all(n.docs.map(async e=>{const t=e.data(),n=await Df(Nd(db,"presence",e.id)),r=n.exists()?n.data():{online:!1};return`\n            <div class="bg-white dark:bg-gray-900 p-4 rounded-lg shadow mb-2 flex justify-between items-center fade-in">\n                <div class="flex items-center">\n                <img src="${t.avatar||"https://picsum.photos/32"}" class="w-8 h-8 rounded-full">\n                <span class="ml-2 cursor-pointer text-gray-900 dark:text-white" onclick="window.loadProfile('${e.id}')">${av(t.username)}</span>\n                <span class="w-2 h-2 rounded-full ${r.online?"bg-green-500":"bg-gray-500"} ml-2"></span>\n                </div>\n                <button onclick="window.startChat('${e.id}')" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-700">Написать</button>\n            </div>\n            `})).then(e=>e.join("")),t||r.classList.remove("autocomplete","absolute","w-full","shadow-lg","rounded-lg","mt-1","z-10")}catch(e){console.error("Search failed:",e),alert(`Ошибка поиска: ${e.message}`)}},window.startChat=async function(e){try{await cv("chat");const t=sv.uid;if(!t||!e)throw new Error("Некорректные ID пользователей");const n=await Df(Nd(window.db,"users",e));if(!n.exists())throw new Error("Пользователь не найден");if("friends"===(n.data().messagingPrivacy||"everyone")){const n=await Df(Nd(window.db,"friends",`${t}_${e}`)),r=await Df(Nd(window.db,"friends",`${e}_${t}`));if(!n.exists()&&!r.exists()||n.exists()&&"accepted"!==n.data().status||r.exists()&&"accepted"!==r.data().status)throw new Error("Вы можете писать только друзьям этого пользователя")}const r=(await Lf(ff(Ad(window.db,"chats"),gf("participants","array-contains",t)))).docs.find(t=>{const n=t.data().participants;return Array.isArray(n)&&n.includes(e)});if(r)return openChat(r.id);const i=await Vf(Ad(window.db,"chats"),{participants:[t,e],createdAt:qf(),lastMessage:null});await Y_(G_(window.rtdb,`chats/${i.id}/participants`),{[t]:!0,[e]:!0}),openChat(i.id)}catch(e){console.error("Chat creation failed:",e),alert(`Ошибка создания чата: ${e.message}`),window.showSection("search")}},window.loadChats=async function(){try{const e=await Lf(ff(Ad(db,"chats"),gf("participants","array-contains",sv.uid))),t=(await Promise.all(e.docs.map(async e=>{const t=e.data();if(!t.participants||!Array.isArray(t.participants))return console.warn(`Invalid participants in chat ${e.id}:`,t.participants),null;const n=t.participants.find(e=>e!==sv.uid);if(!n)return console.warn(`No target user found in chat ${e.id}`),null;const r=await Df(Nd(db,"users",n)),i=await Df(Nd(db,"presence",n)),s=i.exists()?i.data():{online:!1};return{id:e.id,username:r.exists()?r.data().username:"Неизвестный",lastMessage:t.lastMessage,targetUserId:n,targetUserAvatar:r.exists()&&r.data().avatar||"https://picsum.photos/40",online:s.online}}))).filter(e=>null!==e);document.getElementById("content").innerHTML=`\n            <div class="chat-list space-y-2">\n            ${0===t.length?'<p class="text-gray-500 dark:text-gray-400">Пусто</p>':t.map(e=>`\n                <div onclick="window.openChat('${e.id}')" class="p-4 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg cursor-pointer fade-in">\n                <div class="flex items-center">\n                    <img src="${e.targetUserAvatar}" class="w-10 h-10 rounded-full">\n                    <div class="ml-3">\n                    <h3 class="font-semibold text-gray-900 dark:text-white">${e.username}</h3>\n                    ${e.lastMessage?.text?`<p class="text-gray-600 dark:text-gray-300 truncate">${e.lastMessage.text}</p>`:""}\n                    <span class="w-2 h-2 rounded-full ${e.online?"bg-green-500":"bg-gray-500"} inline-block"></span>\n                    </div>\n                </div>\n                </div>\n            `).join("")}\n            </div>\n        `}catch(e){console.error("Chats load failed:",e),alert(`Ошибка загрузки чатов: ${e.message}`)}},window.openChat=async function(e){try{const t=await Df(Nd(db,"chats",e));if(!t.exists())throw new Error("Чат не найден");const n=t.data();if(!n.participants.includes(sv.uid))throw new Error("Нет доступа к чату");const r=n.participants.find(e=>e!==sv.uid),i=await Df(Nd(db,"users",r)),s=await Df(Nd(db,"presence",r)),o=s.exists()?s.data():{online:!1};document.getElementById("content").innerHTML=`\n            <div class="chat bg-white dark:bg-gray-900 p-4 rounded-lg shadow">\n            <div class="flex items-center mb-4">\n                <img src="${i.exists()&&i.data().avatar||"https://picsum.photos/40"}" class="w-10 h-10 rounded-full">\n                <h2 class="ml-3 text-xl font-semibold text-gray-900 dark:text-white">${i.exists()?i.data().username:"Неизвестный"}</h2>\n                <span class="w-2 h-2 rounded-full ${o.online?"bg-green-500":"bg-gray-500"} ml-2"></span>\n            </div>\n            <div class="messages space-y-2 max-h-96 overflow-y-auto"></div>\n            <form onsubmit="event.preventDefault(); window.sendMessage('${e}', document.getElementById('message').value)" class="mt-4 flex">\n                <input id="message" maxlength="500" placeholder="Сообщение..." required class="flex-1 p-2 border rounded-l bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white">\n                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-r hover:bg-blue-600">Отправить</button>\n            </form>\n            </div>\n        `,ev(G_(window.rtdb,`chats/${e}/messages`),t=>{const n=document.querySelector(".messages");if(n){const r=t.val()||{};n.innerHTML=Object.entries(r).map(([t,n])=>`\n                    <div class="${n.sender===sv.uid?"text-right":"text-left"}">\n                    <div class="inline-block p-2 rounded-lg ${n.sender===sv.uid?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 dark:text-white"}">\n                        ${av(n.text)}\n                        ${n.sender===sv.uid?`<button onclick="window.deleteMessage('${e}', '${t}')" class="text-red-300 hover:text-red-100 ml-2 text-xs">Удалить</button>`:""}\n                    </div>\n                    <small class="block text-gray-500 dark:text-gray-400">${new Date(n.timestamp).toLocaleString()}</small>\n                    </div>\n                `).join(""),n.scrollTop=n.scrollHeight}else console.warn("Messages div not found")},e=>{console.error("onValue error:",e)})}catch(e){console.error("Chat open failed:",e),alert(`Ошибка открытия чата: ${e.message}`),window.showSection("chats")}},window.sendMessage=async function(e,t){try{if(!t.trim())throw new Error("Сообщение не может быть пустым");const n=G_(window.rtdb,`chats/${e}/messages`);await function(e,t){e=G(e),c_("push",e._path),s_("push",t,e._path,!0);const n=y_(e._repo),r=j_(n),i=Q_(e,r),s=Q_(e,r);let o;return o=null!=t?Y_(s,t).then(()=>s):Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}(n,{text:t.trim(),sender:sv.uid,timestamp:Date.now(),read:!1}),await Ff(Nd(db,"chats",e),{lastMessage:{text:t.trim(),sender:sv.uid,timestamp:qf()}}),document.getElementById("message").value=""}catch(e){console.error("Message sending failed:",e),alert(`Ошибка отправки сообщения: ${e.message}`)}},window.deleteMessage=async function(e,t){try{const n=G_(window.rtdb,`chats/${e}/messages/${t}`);await function(e){return c_("remove",e._path),Y_(e,null)}(n)}catch(e){console.error("Message deletion failed:",e),alert(`Ошибка удаления сообщения: ${e.message}`)}},window.addFriend=async function(e){try{if(await cv("friend_request"),sv.uid===e)throw new Error("Нельзя добавить себя в друзья");const t=`${sv.uid}_${e}`;if((await Df(Nd(window.db,"friends",t))).exists())throw new Error("Запрос уже отправлен или пользователь в друзьях");await Mf(Nd(window.db,"friends",t),{userId1:sv.uid,userId2:e,status:"pending",createdAt:qf()}),window.loadProfile(e)}catch(e){console.error("Add friend failed:",e),alert(`Ошибка добавления друга: ${e.message}`)}},window.removeFriend=async function(e,t){try{await Uf(Nd(db,"friends",t)),window.loadProfile(e)}catch(e){console.error("Remove friend failed:",e),alert(`Ошибка удаления друга: ${e.message}`)}},window.acceptFriendRequest=async function(e,t){try{await Ff(Nd(window.db,"friends",t),{status:"accepted"}),window.loadProfile(e)}catch(e){console.error("Accept friend request failed:",e),alert(`Ошибка принятия запроса: ${e.message}`)}},window.declineFriendRequest=async function(e,t){try{await Uf(Nd(window.db,"friends",t)),window.loadProfile(e)}catch(e){console.error("Decline friend request failed:",e),alert(`Ошибка отклонения запроса: ${e.message}`)}},window.loadFriends=async function(){try{const e=await Lf(ff(Ad(db,"friends"),gf("userId1","==",sv.uid),gf("status","==","accepted"))),t=await Lf(ff(Ad(db,"friends"),gf("userId2","==",sv.uid),gf("status","==","accepted"))),n=await Lf(ff(Ad(db,"friends"),gf("userId1","==",sv.uid),gf("status","==","pending"))),r=await Lf(ff(Ad(db,"friends"),gf("userId2","==",sv.uid),gf("status","==","pending"))),i=new Set,s=await Promise.all([...e.docs,...t.docs].map(async e=>{const t=e.data(),n=t.userId1===sv.uid?t.userId2:t.userId1;if(i.has(n))return null;i.add(n);const r=await Df(Nd(db,"users",n)),s=await Df(Nd(db,"presence",n)),o=s.exists()?s.data():{online:!1};return{id:n,username:r.exists()?r.data().username:"Неизвестный",avatar:r.exists()&&r.data().avatar||"https://picsum.photos/32",online:o.online,docId:e.id}})).then(e=>e.filter(e=>null!==e)),o=await Promise.all(n.docs.map(async e=>{const t=e.data().userId2,n=await Df(Nd(db,"users",t));return{id:t,username:n.exists()?n.data().username:"Неизвестный",avatar:n.exists()&&n.data().avatar||"https://picsum.photos/32",docId:e.id}})),a=await Promise.all(r.docs.map(async e=>{const t=e.data().userId1,n=await Df(Nd(db,"users",t));return{id:t,username:n.exists()?n.data().username:"Неизвестный",avatar:n.exists()&&n.data().avatar||"https://picsum.photos/32",docId:e.id}}));document.getElementById("content").innerHTML=`\n            <div class="friends-list space-y-4 bg-white dark:bg-gray-900 p-4 rounded-lg shadow">\n            <h2 class="text-xl font-bold text-gray-900 dark:text-white">Друзья</h2>\n            <div class="space-y-2">\n                ${0===s.length?'<p class="text-gray-500 dark:text-gray-400">Нет друзей</p>':s.map(e=>`\n                <div class="p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg flex justify-between items-center fade-in">\n                    <div class="flex items-center">\n                    <img src="${e.avatar}" class="w-8 h-8 rounded-full">\n                    <span class="ml-2 cursor-pointer text-gray-900 dark:text-white" onclick="window.loadProfile('${e.id}')">${av(e.username)}</span>\n                    <span class="w-2 h-2 rounded-full ${e.online?"bg-green-500":"bg-gray-500"} ml-2"></span>\n                    </div>\n                    <button onclick="window.removeFriend('${e.id}', '${e.docId}')" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">Удалить</button>\n                </div>\n                `).join("")}\n            </div>\n            <h2 class="text-xl font-bold text-gray-900 dark:text-white mt-4">Отправленные заявки</h2>\n            <div class="space-y-2">\n                ${0===o.length?'<p class="text-gray-500 dark:text-gray-400">Нет отправленных заявок</p>':o.map(e=>`\n                <div class="p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg flex justify-between items-center fade-in">\n                    <div class="flex items-center">\n                    <img src="${e.avatar}" class="w-8 h-8 rounded-full">\n                    <span class="ml-2 cursor-pointer text-gray-900 dark:text-white" onclick="window.loadProfile('${e.id}')">${av(e.username)}</span>\n                    </div>\n                    <button class="bg-gray-500 text-white px-2 py-1 rounded" disabled>Ожидание</button>\n                </div>\n                `).join("")}\n            </div>\n            <h2 class="text-xl font-bold text-gray-900 dark:text-white mt-4">Полученные заявки</h2>\n            <div class="space-y-2">\n                ${0===a.length?'<p class="text-gray-500 dark:text-gray-400">Нет полученных заявок</p>':a.map(e=>`\n                <div class="p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg flex justify-between items-center fade-in">\n                    <div class="flex items-center">\n                    <img src="${e.avatar}" class="w-8 h-8 rounded-full">\n                    <span class="ml-2 cursor-pointer text-gray-900 dark:text-white" onclick="window.loadProfile('${e.id}')">${av(e.username)}</span>\n                    </div>\n                    <div>\n                    <button onclick="window.acceptFriendRequest('${e.id}', '${e.docId}')" class="bg-green-500 text-white px-2 py-1 rounded hover:bg-green-700 mr-2">Принять</button>\n                    <button onclick="window.declineFriendRequest('${e.id}', '${e.docId}')" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">Отклонить</button>\n                    </div>\n                </div>\n                `).join("")}\n            </div>\n            </div>\n        `}catch(e){console.error("Friends load failed:",e),alert(`Ошибка загрузки друзей: ${e.message}`)}},window.updateProfile=async function(e,t,n,r){try{if(!e||e.length>20)throw new Error("Имя пользователя должно быть от 1 до 20 символов");if(t.length>200)throw new Error("Биография не должна превышать 200 символов");if(n&&!isValidUrl(n))throw new Error("Некорректный URL аватара");if(r&&!isValidUrl(r))throw new Error("Некорректный URL фонового изображения");const i={username:e,bio:t,avatar:n||"",profileBackground:r||""};await Ff(Nd(db,"users",sv.uid),i),alert("Профиль обновлен"),window.loadProfile(sv.uid)}catch(e){console.error("Profile update failed:",e),alert(`Ошибка обновления профиля: ${e.message}`)}},window.changePassword=async function(e){try{await cv("password_change"),await function(e,t){return async function(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await an(e,async function(e,t){return Wt(e,"POST","/v1/accounts:update",t)}(r,i));await e._updateTokensIfNecessary(s,!0)}(G(e),null,t)}(sv,e),alert("Пароль успешно изменен"),window.showSection("settings")}catch(e){console.error("Password change failed:",e),alert(`Ошибка смены пароля: ${e.message}`)}},window.updateMessagingPrivacy=async function(e){try{await Ff(Nd(window.db,"users",sv.uid),{messagingPrivacy:e}),alert("Настройки приватности обновлены"),window.showSection("settings")}catch(e){console.error("Messaging privacy update failed:",e),alert(`Ошибка обновления настроек приватности: ${e.message}`)}}})()})();